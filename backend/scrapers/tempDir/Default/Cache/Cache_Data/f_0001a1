{"version":3,"sources":["node_modules/browser-pack/_prelude.js","build/index.js","build/lib/TmPixel.js","build/lib/VendorService.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"fanbuilder.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","/**\n * Created by brett.hale on 9/9/15.\n */\n//options:\n// dataLayer:reference to dataLayer defaults to digitalData\n// environment: akamai env to use [local,dev,qa,prod]\n// getVar: reference to getVar function\n// rules: array of rules to formulate the endpoint\n// [{testRegex:/regex/,testField:'pageName',urlTemplate:'<%baseUrl%>/<%environment%>/event/e_<%data.eventID%>'}]\nmodule.exports = require('./lib/VendorService');\n","//****** TM Pixel ******//\nmodule.exports = function (scope) {\n\n    var settings = scope.config.divolte;\n    var params = {};\n    var callbacks = [function () {\n        scope.log('Divolte Library Loaded')\n    }];\n\n    if (typeof settings.onLoad === 'function') {\n        callbacks.push(settings.onLoad);\n    }\n\n    var url = document.location.protocol + (settings.isStaging ? '//d.t-x.io/divolte.js' : '//d.t-x.io/divolte.js');\n\n    scope.log('Loading Divolte Library');\n\n    if (typeof window.requirejs !== 'undefined' && typeof window.require === 'function') {\n        window.require.config({shim:{divolte:{exports:'divolte'}},paths:{divolte: settings.url}});\n        scope.log('requirejs loading...', 'Divolte:');\n        window.require(['divolte'], function (d) {\n            window.divolte = d;\n            scope.log('requirejs finished loading.', 'Divolte:');\n            handleLibLoad(d);\n        });\n    } else {\n        loadScript();\n    }\n\n    function toArray (target) {\n\n        if (typeof target === 'object' && typeof target.push === 'function') {\n            return target;\n        } else if (typeof target === 'object') {\n            return [target];\n        }\n\n        if (typeof target === 'string') {\n            return target.split(',');\n        } else {\n            return [];\n        }\n\n    }\n\n    /**\n     * Send becomes TMPixel.push\n     * @param data\n     */\n    function send (data) {\n        scope.log('Sending called:' + data.event + ' -- ' + JSON.stringify(data.data), 'Divolte: ');\n        var divolte = window['divolte'] || window['module'] && window['module']['exports'];\n        if (divolte && divolte.signal) {\n            var topics = [];\n            if (settings.topics) topics = toArray(settings.topics);\n\n            if (data.data.topics) {\n                data.data.topics = toArray(data.data.topics).concat(topics);\n                data.data.topics = scope.uniq(data.data.topics);\n            } else {\n                data.data.topics = topics;\n            }\n\n            /**\n             * Include all params from page load call\n             */\n            if (data.sendAll) {\n                data.data = scope.merge(params, data.data);\n            }\n\n\n            scope.log('Sending with params:' + data.event + ' -- ' + JSON.stringify(data.data), 'Divolte: ');\n\n            if(settings.suppressCall) return;\n\n            divolte.signal(data.event, data.data);\n            scope.log('Sent Successfully', 'Divolte: ');\n\n        } else {\n            scope.log('ERROR: Divolte did not load', 'Divolte: ');\n        }\n\n    }\n\n    function clearQueue () {\n        scope.log('Clearing Queue {window.TmPixel}', 'Divolte: ');\n        var queue = window.TmPixel || [];\n        if (queue && queue.length>0) {\n            queue.forEach(function (item,index) {\n                send(item);\n            });\n        }\n\n        window.TmPixel = {push:send};\n    }\n\n    /**\n     * You should make all necessary change to overrides and settings before calling scope.\n     */\n    scope.trackPageView = function () {\n        settings = scope.config.divolte;\n        params = {};\n        buildData(params);\n        scope.log('TrackPageView - Merged Settings: ' + JSON.stringify(settings), 'Divolte: ');\n        send({event:'page_load', data:params});\n    };\n\n    function handleLibLoad () {\n        callbacks.forEach(function (onloadCallback) {\n            if (typeof onloadCallback === 'function') {\n\n                try {\n                    onloadCallback();\n                } catch (e) {\n                    scope.log('Callback Error ' + e.message, 'Divolte: ');\n                }\n            }\n        });\n\n        x = true;\n        if (settings.autoTrack === false) {\n            scope.log('Manual Tracking Required - Queue ignored', 'Divolte: ');\n            return;\n        }\n\n        if (typeof settings.autoTrack === 'undefined' || settings.autoTrack === true || settings.autoTrack === 'events') {\n            /**\n             * AutoTrack page view only when undefined (mimic default true behavior) or explicitly set to true\n             */\n            if (settings.autoTrack !== 'events') {\n                scope.log('AutoTrack Enabled - Sending Initial PageView', 'Divolte: ');\n                scope.trackPageView();\n            } else {\n                buildData(params);\n                scope.log('AutoTrack Events Only - No PageTrack Sent', 'Divolte: ');\n            }\n            /**\n             * All of these cases we want to clear the queue.\n             */\n            clearQueue();\n\n        } else if (settings.autoTrack === false) {\n\n            scope.trackEvent = send;\n\n        } else {\n            scope.log('Error configuring autoTrack setting, accptable values are [true, false, \\'events\\']');\n        }\n\n    }\n\n    function loadScript() {\n\n        scope.log('Loading Divolte Script', 'Divolte: ');\n        var x = false,\n            p, s = document.createElement('script');\n        s.type = 'text/javascript';\n        s.async = 1;\n        s.src = url;\n        s.onload = s.onreadystatechange = function () {\n            scope.log('Finished Loading Divolte Script', 'Divolte: ');\n            if (!x && (!this.readyState || this.readyState == 'complete')) {\n                handleLibLoad();\n            }\n        };\n        p = document.getElementsByTagName('script')[0];\n        p.parentNode.insertBefore(s, p);\n\n    }\n\n    function extractDomainName (pageName) {\n        return pageName.replace(/\\:.*$/g,'');\n    }\n\n    function collectData(map, params) {\n\n        var value = null;\n\n        if (map.data) {\n            // check if nested schema exists and collect data recursively\n            if (typeof map.data === 'object') {\n\n                var nestedParams = {};\n                map.data.forEach && map.data.forEach(function (item, ind) {\n\n                    collectData(item, nestedParams);\n\n                });\n\n                if (Object.keys(nestedParams).length > 1) {\n\n                    if (typeof map.transform === 'function') {\n                        nestedParams = map.transform(nestedParams);\n                    }\n\n                    params[map.key] = nestedParams;\n                }\n\n            } else {\n                value = scope.getValue(map.data, map.dataObj);\n                if (value !== undefined && value !== null && value !== '') {\n\n                    if (typeof map.transform === 'function') {\n                        value = map.transform(value);\n                    }\n\n                    if (value !== undefined && value !== null && value !== '') {\n                        params[map.key] = value;\n                    }\n                }\n            }\n        }\n\n    }\n\n    function unwrapQuery(value) {\n        return value.join(',');\n    }\n\n    /**\n     * @type {*[]}\n     * key: maps to divolte schema\n     * data: what to look for in digitalData or dataObj if provided\n     * dataObj: optional - if not digitalData where to look for the data needed\n     *\n     * todo: add type validation for divolte schema\n     */\n    scope.schema = [\n        {key:'browserId',data:'BID', dataObj: scope.cookies},\n        {key:'memberId',data:'MID', dataObj: scope.cookies},\n        {key:'marketId',data:'MARKET_ID', dataObj: scope.cookies},\n        {key:'sessionId',data:'SID', dataObj: scope.cookies},\n        {key:'sessionIdTM',data:'TMSID', dataObj: scope.cookies},\n        {key:'pageType',data:'page.pageInfo.pageType'},\n        {key:'pageName',data:'page.pageInfo.pageName'},\n        {key:'domain',data:'page.pageInfo.pageName', transform: extractDomainName},\n        {key:'eventId',data:'page.attributes.eventID'},\n        {key:'eventDate',data:'page.attributes.eventDate'},\n        {key:'majorCategoryId',data:'page.attributes.primaryCategoryID'},\n        {key:'minorCategoryId',data:'page.attributes.secondaryCategoryID'},\n        {key:'artistId',data:'page.attributes.artistID'},\n        {key:'orderTicketQuantity',data:'transaction.attributes.ticketQuantity'},\n        {key:'orderTotal',data:'transaction.total.transactionTotal'},\n        {key:'orderId',data:'transaction.transactionID'},\n        {key:'orderConfirmationCode',data:''},\n        {key:'orderFaceValueTotal',data:'transaction.total.basePrice'},\n        {key:'orderFeeTotal',data:'transaction.total.feesTotal'},\n        {key:'searchQuery',data:'page.pageInfo.onsiteSearchTerm'},\n        {key:'searchPageNumber',data:''},\n        {key:'tmLink',data:'tmLink',dataObj:scope.urlParams, transform: unwrapQuery},\n        {key:'majorCategoryId', data:'page.category.primaryCategoryID'},\n        {key:'minorCategoryId', data:'page.category.subCategory1ID'},\n        {key:'fanbuilder', transform: toArray, data: [\n            {key: 'userId', data: 'mc_eid', dataObj: scope.urlParams, transform: unwrapQuery},\n            {key: 'campaignId', data: 'mc_cid', dataObj: scope.urlParams, transform: unwrapQuery},\n            {key: 'provider', data: 'mc_cid', dataObj: scope.urlParams, transform: (function(value){return value[0] && 'MAILCHIMP' || null;})}\n        ]},\n        {key:'utm', transform: toArray, data: [\n            {key:'source', data: 'utm_source', dataObj: scope.urlParams, transform: unwrapQuery},\n            {key:'medium', data: 'utm_medium', dataObj: scope.urlParams, transform: unwrapQuery},\n            {key:'term', data: 'utm_term', dataObj: scope.urlParams, transform: unwrapQuery},\n            {key:'content', data: 'utm_content', dataObj: scope.urlParams, transform: unwrapQuery},\n            {key:'campaign', data: 'utm_campaign', dataObj: scope.urlParams, transform: unwrapQuery}\n        ]},\n        {key:'cfc', data:'cfc'}\n    ];\n\n    function buildData (params) {\n        scope.log('Building Data', 'Divolte: ');\n        if (settings.isStaging) {\n            params.isStagingEnvironment = true;\n        }\n\n        var schema = scope.schema;\n\n        /**\n         * This allows implementors to extend the schema without releasing fanbuilder.js\n         */\n        if(settings.additionalPageLoadParams){\n            schema = schema.concat(settings.additionalPageLoadParams);\n        }\n\n        for (var i = 0; i<schema.length; i++) {\n            collectData(schema[i], params);\n        }\n        scope.log('Params: ' + JSON.stringify(params), 'Divolte: ');\n\n\n    }\n\n};\n//****** End TM Pixel ******//\n","var TmPixel = require('./TmPixel');\n\nmodule.exports = VendorService;\n\nfunction VendorService(options, overrides) {\n    const htmlSingleQuote = '\\\\\\x27';\n    var self = this;\n\n    self.cookies   = self.readAllCookies();\n    self.urlParams = self.getUrlParams();\n    self.storeMap  = {\n        basePrice:        'transaction.total.basePrice',\n        transactionID:    'transaction.transactionID',\n        ticketQuantity:   'transaction.attributes.ticketQuantity',\n        orderID:          '',\n        confirmationID:   '',\n        orderDate:        '',\n        orderTime:        '',\n        ticketType:       'transaction.attributes.ticketType',\n        pageName:         'page.pageInfo.pageName',\n        promoterID:       'page.pageInfo.promoterID',\n        state:            'page.attributes.state',\n        zip:              'page.attributes.zip',\n        country:          'page.attributes.country',\n        value:            'transaction.profile.address.stateProvince',\n        billingZip:       'transaction.profile.address.postalCode',\n        billingState:     'transaction.profile.address.stateProvince',\n        billingCountry:   'transaction.profile.address.country',\n        dmaID:            '',\n        eventDate:        'page.attributes.eventDate',\n        eventTime:        'page.attributes.eventTime',\n        eventName:        'page.attributes.eventName',\n        eventID:          'page.attributes.eventID',\n        artistName:       'page.attributes.artistName',\n        artistID:         'page.attributes.artistID',\n        venueName:        'page.attributes.venueName',\n        venueID:          'page.attributes.venueID',\n        majorCatgoryID:   'page.category.primaryCategoryID',\n        majorCatgoryName: 'page.category.primaryCategory',\n        minorCatgoryID:   'page.category.subCategoryID',\n        minorCatgoryName: 'page.category.subCategory',\n        teamID:           'page.attributes.teamID',\n        currency:         'transaction.total.currency',\n        sessionID:        '',\n        cfc:              'cfc'\n    };\n\n    self.config         = options || {};\n    self.config.version = '2.0.25';\n    self.overrides      = overrides || {};\n\n    if ( self.config.dataLayerObject ) {\n        self.config.data = self.getValue(self.config.dataLayerObject, window);\n    }\n\n    if ( self.config.divolte && self.config.divolte.enabled ) {\n        self.tmPixel = new TmPixel(self);\n    }\n\n    self.trackPage = function (skipUpdate) {\n\n        if(!skipUpdate) {\n            if ( self.config.dataLayerObject ) {\n                self.config.data = self.getValue(self.config.dataLayerObject, window);\n            }\n        }\n\n        if ( self.config.data ) {\n\n            self.config.data.pageUrl = window.location.href;\n            self.config.data.pageReferrer = document.referrer;\n            self.config.data.random  = Math.random() * 100000000000000000;\n            self.config.data.pageTitle = window.document.title.replace(/\\x27/g, htmlSingleQuote) || '';\n\n            self.handlePixels(self.config.divolte && self.config.divolte.enabled && self.config.logPixels);\n        }\n    };\n\n    if ( self.config.autoFirePixels !== false ) {\n        self.trackPage(true);\n    }\n\n    return self;\n}\n\nVendorService.prototype.addGA2CustomDimensions = function (ga, trackerName, customVariables) {\n    var self = this;\n\n    if (typeof customVariables !== 'undefined') {\n        for (var key in customVariables) {\n            ga(trackerName + '.set', key, self.getValue(customVariables[key]));\n        }\n    }\n}\n\nVendorService.prototype.addSlashes = function(str)\n{\n    return (str + '').replace(/[\\\\\"']/g, '\\\\$&').replace(/\\u0000/g, '\\\\0');\n};\nVendorService.prototype.ajax = function(url){\n\n    var self = this;\n    var isMS8or9 = window.XDomainRequest && (window.navigator.userAgent.match(/Trident\\/5\\./) || window.navigator.userAgent.match(/Trident\\/4\\./));\n    var xmlhttp,requestThen,callbacks = [];\n\n    if(isMS8or9){\n        xmlhttp = new XDomainRequest();\n        xmlhttp.onsuccess = function(){\n            for(var i=0;i<callbacks.length;i++){\n                var fns = callbacks.shift();\n                if(typeof fns.success === 'function'){\n                    fns.success(JSON.parse(xmlhttp.responseText));\n                }\n            }\n        };\n        xmlhttp.onerror = function(){\n            for(var i=0;i<callbacks.length;i++){\n                var fns = callbacks.shift();\n                if(typeof fns.error === 'function'){\n                    fns.error(xmlhttp.responseText);\n                }\n            }\n        };\n        requestThen = function(success,error){\n            callbacks.push({success:success,error:error})\n        };\n    }else{\n        xmlhttp = new XMLHttpRequest();\n\n        xmlhttp.onreadystatechange = function () {\n            if (xmlhttp.readyState == (XMLHttpRequest.DONE || 4)) {\n                for(var i=0;i<callbacks.length;i++){\n                    var fns = callbacks.shift();\n                    if(xmlhttp.status == 200 && typeof fns.success === 'function' && xmlhttp.responseText.length > 0){\n                        fns.success(JSON.parse(xmlhttp.responseText));\n                    }else if(xmlhttp.status !== 200 && typeof fns.error === 'function'){\n                        fns.error(xmlhttp.responseText);\n                    }\n                }\n\n            }\n        };\n\n        requestThen = function(success,error){\n            if(xmlhttp.readyState == (XMLHttpRequest.DONE || 4)){\n                var callback = xmlhttp.status == 200 ? success : error;\n                if(typeof callback === 'function')callback(xmlhttp.responseText);\n            }else{\n                callbacks.push({success:success,error:error})\n            }\n        };\n    }\n\n    try{\n        xmlhttp.open(\"GET\", url, true);\n        xmlhttp.send();\n    }catch(e){\n            self.log('Pixel Service: Ajax Error for url: ' + url);\n    }\n\n\n    return {\n        then:requestThen\n    };\n\n};\nVendorService.prototype.clone = function(from, to)\n{\n    if (from == null || typeof from != \"object\") return from;\n    if (from.constructor != Object && from.constructor != Array) return from;\n    if (from.constructor == Date || from.constructor == RegExp || from.constructor == Function ||\n        from.constructor == String || from.constructor == Number || from.constructor == Boolean)\n        return new from.constructor(from);\n\n    to = to || new from.constructor();\n\n    for (var name in from)\n    {\n        to[name] = typeof to[name] == \"undefined\" ? this.clone(from[name], null) : to[name];\n    }\n\n    return to;\n};\nVendorService.prototype.createElem = function(type,url,id,cb) {\n    var elem = document.createElement(type);\n    elem.src = url;\n    elem.width = 1;\n    elem.height = 1;\n    elem.setAttribute('style','display:none');\n    if(typeof id === 'string')elem.id = id;\n    elem.setAttribute('frameborder',0);\n    if(typeof cb === 'function'){\n        elem.onload = cb;\n    }\n    document.body.appendChild(elem);\n\n};\nVendorService.prototype.createIframeWithContent = function(id, html, cb) {\n    var self = this;\n\n    var iframe           = document.createElement('iframe');\n    iframe.style.cssText = 'width:1px; height:1px; display:none;';\n    iframe.frameborder   = 0;\n    iframe.id            = id + \"\";\n    iframe.width         = 1;\n    iframe.height        = 1;\n\n    if(typeof cb === 'function'){\n        iframe.onload = cb;\n    }\n\n    document.body.appendChild(iframe);\n    var doc = ( iframe.contentWindow || iframe.contentDocument );\n    if ( doc.document ) {\n        doc = doc.document;\n    }\n    doc.open();\n    doc.write(html);\n    doc.close();\n\n};\n\n\n\nVendorService.prototype.embedInScriptTag = function(pixelCodes) {\n    var html = '<script>';\n    pixelCodes.forEach(function (pixelCode) {\n        html += !!pixelCode ? pixelCode : '';\n    })\n    html += '</script>';\n\n    return html;\n}\nVendorService.prototype.fetchPixels = function(callback){\n    var self = this;\n\n    var url = self.getPixelFileEndpoint();\n    if(self.config.baseUrl){\n        self.config.environment = self.config.environment || 'local/';\n        if(url) {\n            self.ajax('https://' + url)\n                .then(function(results){\n                callback(null, results);\n            },function(data){\n                    callback(data)\n                });\n        }\n    } else {\n        self.log('No baseUrl set in config to retrieve pixels');\n    }\n\n};\nvar ticketmasterAffiliation = 'Ticketmaster';\n\nVendorService.prototype.generateGA4HtmlScriptTag = function (tag) {\n  var self = this;\n\n  var eCommerceProducts;\n  var productData = self.getValue('productDataJson', self.config.data);\n  var productItems = [];\n  var trackingId = tag.trackingId.replace(/\\s/g, '');\n  var pageTitle = self.getValue('pageTitle', self.config.data);\n\n  try {\n    eCommerceProducts = JSON.parse(productData);\n  } catch (e) {\n    eCommerceProducts = [];\n  }\n\n  var html = generateOpeningHtmlPart(self, trackingId, pageTitle, tag.customVariables);\n\n  if (isAConversionPage(self, eCommerceProducts.length)) {\n    html += generateConversionPageHtmlContent(self, eCommerceProducts, productItems, tag.customVariables);\n  } else if (isAnEventDetailPage(eCommerceProducts.length)) {\n    html += generateEventDetailPageHtmlContent(self, eCommerceProducts, productItems, tag.customVariables);\n  }\n\n  html += generateClosingHtmlPart();\n  return html;\n}\n\nvar isAConversionPage = function (vendorService, eCommerceProductsSize) {\n  return vendorService.getValue('transaction.transactionID', vendorService.config.data) && eCommerceProductsSize;\n}\n\nvar isAnEventDetailPage = function (eCommerceProductsSize) {\n  return eCommerceProductsSize === 1;\n}\n\nvar getCustomDimensionValues = function (service, customDimensions) {\n  var customDimensionsValues = {};\n  for (var key in customDimensions) {\n    customDimensionsValues[key] = service.getValue(customDimensions[key]);\n  }\n  return customDimensionsValues;\n}\n\nvar getFormattedCustomDimensionsForHtml = function (service, customDimensions) {\n  var formattedCustomDimensions = '';\n  if (customDimensions && Object.keys(customDimensions).length > 0) {\n    formattedCustomDimensions += ',';\n    formattedCustomDimensions += JSON.stringify(getCustomDimensionValues(service, customDimensions))\n        .replace(/\"([^\"]+)\":/g, '$1:')\n        .replace(/[{}]/g, '')\n        .replace(/\"/g, \"'\");\n  }\n\n  return formattedCustomDimensions;\n}\n\nvar generateEventDetailPageHtmlContent = function (service, eCommerceProducts, productItems, customDimensions) {\n  var product = eCommerceProducts[0];\n  var category = product.category.split('/');\n  var primaryCategory = category[0] || '';\n  var subCategory = category.length > 1 ? category[1] : '';\n  var customDimensionValues = getCustomDimensionValues(service, customDimensions);\n  var productItem = Object.assign(customDimensionValues, {\n    affiliation: ticketmasterAffiliation,\n    item_id: product.id,\n    item_name: product.name,\n    item_brand: product.brand,\n    item_category: primaryCategory,\n    item_category2: subCategory\n  });\n\n  productItems.push(productItem);\n\n  var eventDetailPageHtml = 'tmGtag(\\'event\\', \\'view_item\\', {';\n  eventDetailPageHtml += 'send_to: t,';\n  eventDetailPageHtml += 'items: ' + JSON.stringify(productItems);\n  eventDetailPageHtml += getFormattedCustomDimensionsForHtml(service, customDimensions);\n  eventDetailPageHtml += '});';\n\n  return eventDetailPageHtml;\n}\n\nvar generateConversionPageHtmlContent = function (service, eCommerceProducts, productItems, customDimensions) {\n  eCommerceProducts.forEach(function (product) {\n    var category = product.category.split('/');\n    var primaryCategory = category[0] || '';\n    var subCategory = category.length > 1 ? category[1] : '';\n    var customDimensionsValues = getCustomDimensionValues(service, customDimensions);\n    var productItem = Object.assign(customDimensionsValues, {\n      affiliation: ticketmasterAffiliation,\n      item_id: product.id,\n      item_name: product.name,\n      item_brand: product.brand,\n      item_category: primaryCategory,\n      item_category2: subCategory,\n      item_variant: product.variant,\n      quantity: product.quantity,\n      price: product.price\n    });\n\n    productItems.push(productItem);\n  });\n\n  var conversionHtml = 'tmGtag(\\'event\\', \\'purchase\\', {';\n  conversionHtml += 'send_to: t,';\n  conversionHtml += 'currency: \\'' + service.getValue('transaction.total.currency', service.config.data) + '\\',';\n  conversionHtml += 'transaction_id: \\'' + service.getValue('transaction.transactionID', service.config.data) + '\\',';\n  conversionHtml += 'value: \\'' + service.getValue('transaction.total.basePrice', service.config.data) + '\\',';\n  conversionHtml += 'items: ' + JSON.stringify(productItems);\n  conversionHtml += getFormattedCustomDimensionsForHtml(service, customDimensions);\n  conversionHtml += '});';\n\n  return conversionHtml;\n}\n\nvar generateOpeningHtmlPart = function (service, trackingId, pageTitle, customDimensions) {\n  var openingHtml = '<script>var t = \\'' + trackingId + '\\', ';\n  openingHtml += 'gts = function (i,d){var e=d.createElement(\\'script\\'),m=d.getElementsByTagName(\\'script\\')[0];e.src=\\'https://www.googletagmanager.com/gtag/js?id=\\'+i+\\'&l=tmdl\\';m.parentNode.insertBefore(e,m)};';\n  openingHtml += 'gts(t,document);';\n  openingHtml += 'window.tmdl = window.tmdl || [];';\n  openingHtml += 'function tmGtag(){tmdl.push(arguments);}';\n  openingHtml += 'tmGtag(\\'js\\', new Date());';\n  // Enhanced measurement bug\n  openingHtml += 'tmGtag(\\'config\\', t, {send_page_view: false});';\n  // Bug:  Enhanced Measurement has an unpredictable delay for page_view when configured in GA4 client account (out of our control)\n  // It's waiting/looking for scrolls, etc. Here we trigger page_view manually to ensure it goes out before ga-disable is set\n  openingHtml += 'tmGtag(\\'event\\', \\'page_view\\', {send_to: t, page_title: \\'' + pageTitle + '\\'' + getFormattedCustomDimensionsForHtml(service, customDimensions) + '});';\n\n  return openingHtml;\n}\n\nvar generateClosingHtmlPart = function () {\n  return '</script>';\n}\n\nVendorService.prototype.generateTiktokHtmlScriptTag = function(tag) {\n    var self = this;\n    const pageType = getPageType(self);\n    if(pageType !== PageTypes.Unsupported)\n        return self.embedInScriptTag([generatePixelInstallationCode(tag.pixelId), generatePixelEventCode(self, tag, pageType)])\n    else\n        return null;\n}\n\nconst generatePixelInstallationCode = function(pixelId) {\n    var installationCode = '!(function (w, d, t) {';\n    installationCode += 'w.TiktokAnalyticsObject = t;';\n    installationCode += 'var ttq = (w[t] = w[t] || []);';\n    installationCode += '(ttq.methods = [';\n    installationCode += '\"page\",';\n    installationCode += '\"track\",';\n    installationCode += '\"identify\",';\n    installationCode += '\"instances\",';\n    installationCode += '\"debug\",';\n    installationCode += '\"on\",';\n    installationCode += '\"off\",';\n    installationCode += '\"once\",';\n    installationCode += '\"ready\",';\n    installationCode += '\"alias\",';\n    installationCode += '\"group\",';\n    installationCode += '\"enableCookie\",';\n    installationCode += '\"disableCookie\",';\n    installationCode += ']),';\n    installationCode += '(ttq.setAndDefer = function (t, e) {';\n    installationCode += 't[e] = function () {';\n    installationCode += 't.push([e].concat(Array.prototype.slice.call(arguments, 0)));';\n    installationCode += '};';\n    installationCode += '});';\n    installationCode += 'for (var i = 0; i < ttq.methods.length; i++)';\n    installationCode += 'ttq.setAndDefer(ttq, ttq.methods[i]);';\n    installationCode += '(ttq.instance = function (t) {';\n    installationCode += 'for (var e = ttq._i[t] || [], n = 0; n < ttq.methods.length; n++)';\n    installationCode += 'ttq.setAndDefer(e, ttq.methods[n]);';\n    installationCode += 'return e;';\n    installationCode += '}),';\n    installationCode += '(ttq.load = function (e, n) {';\n    installationCode += 'var i = \"https://analytics.tiktok.com/i18n/pixel/events.js\";';\n    installationCode += '(ttq._i = ttq._i || {}),';\n    installationCode += '(ttq._i[e] = []),';\n    installationCode += '(ttq._i[e]._u = i),';\n    installationCode += '(ttq._t = ttq._t || {}),';\n    installationCode += '(ttq._t[e] = +new Date()),';\n    installationCode += '(ttq._o = ttq._o || {}),';\n    installationCode += '(ttq._o[e] = n || {}),';\n    installationCode += '(ttq._partner = ttq._partner || \"Ticketmaster\");';\n    installationCode += 'var o = document.createElement(\"script\");';\n    installationCode += '(o.type = \"text/javascript\"),';\n    installationCode += '(o.async = !0),';\n    installationCode += '(o.src = i + \"?sdkid=\" + e + \"&lib=\" + t);';\n    installationCode += 'var a = document.getElementsByTagName(\"script\")[0];';\n    installationCode += 'a.parentNode.insertBefore(o, a);';\n    installationCode += '});';\n    installationCode += 'ttq.load(\"' + pixelId + '\");';\n    installationCode += 'ttq.page();';\n    installationCode += '})(window, document, \"ttq\");';\n\n    return installationCode;\n}\n\nconst generatePixelEventCode = function(vendorService, tag, pageType) {\n    var eventCode = 'setTimeout(function() {';\n    eventCode +=  'if( !window.ttq ){return;}';\n\n    eventCode += generatePageTypeHtmlPart(vendorService, tag.pixelId, pageType);\n\n    eventCode += '}, 500);';\n    return eventCode;\n}\n\nconst PageTypes = {\n    Venue: \"venue page\",\n    Artist: \"artist page\",\n    EventDetail: \"event detail page\",\n    Confirmation: \"confirmation page\",\n    Unsupported: \"\"\n};\n\nvar getPageType = function(vendorService) {\n    const venueId = vendorService.getValue('page.attributes.venueID', vendorService.config.data);\n    const artistId = vendorService.getValue('page.attributes.artistID', vendorService.config.data);\n    const eventId = vendorService.getValue('page.attributes.eventID', vendorService.config.data);\n    const orderId = vendorService.getValue('transaction.transactionID', vendorService.config.data);\n\n    if (!!venueId && !artistId && !eventId && !orderId)\n        return PageTypes.Venue;\n    else if (!!artistId && !venueId && !eventId && !orderId)\n        return PageTypes.Artist;\n    else if (!!eventId && !orderId)\n        return PageTypes.EventDetail;\n    else if (!!orderId)\n        return PageTypes.Confirmation;\n    else\n        return PageTypes.Unsupported;\n}\n\nvar generatePageTypeHtmlPart = function(vendorService, pixelId, pageType) {\n    switch(pageType) {\n        case PageTypes.Venue:\n            return generateVenuePageHtmlPart(vendorService, pixelId);\n        case PageTypes.Artist:\n            return generateArtistPageHtmlPart(vendorService, pixelId);\n        case PageTypes.EventDetail:\n            return generateEventDetailPageHtmlPart(vendorService, pixelId);\n        case PageTypes.Confirmation:\n            return generateConfirmationPageHtmlPart(vendorService, pixelId);\n    }\n}\n\nconst generateVenuePageHtmlPart = function(vendorService, pixelId) {\n    return 'ttq.instance(\\''+ pixelId +'\\').track(\\'ViewContent\\',{content_category:\\''+ vendorService.getValue('page.attributes.venueName') +'\\'});';\n}\n\nconst generateArtistPageHtmlPart = function(vendorService, pixelId) {\n    return 'ttq.instance(\\''+ pixelId +'\\').track(\\'ViewContent\\',{content_category:\\''+ vendorService.getValue('page.attributes.artistName') +'\\'});';\n}\n\nconst generateEventDetailPageHtmlPart = function(vendorService, pixelId) {\n    return 'ttq.instance(\\''+ pixelId +'\\').track(\\'ViewContent\\', {  content_category:\\''+ vendorService.getValue('page.attributes.artistName') +'\\',  content_name: \\''+ vendorService.getValue('page.attributes.eventName') +'\\',  content_id: \\''+ vendorService.getValue('page.attributes.eventID') +'\\',  content_type: \\'product\\' });';\n}\n\nconst generateConfirmationPageHtmlPart = function(vendorService, pixelId) {\n    var confirmationPageCode = 'ttq.instance(\\''+ pixelId +'\\').track(\\'CompletePayment\\', {';\n    confirmationPageCode += 'content_category:\\''+ vendorService.getValue('page.attributes.artistName') +'\\',';\n    confirmationPageCode += 'content_name: \\''+ vendorService.getValue('page.attributes.eventName') +'\\',';\n    confirmationPageCode += 'content_id: \\''+ vendorService.getValue('page.attributes.eventID') +'\\',';\n    confirmationPageCode += 'content_type: \\'product\\',';\n    confirmationPageCode += 'value:\\''+ vendorService.getValue('transaction.total.basePrice') +'\\',';\n    confirmationPageCode += 'currency:\\''+ vendorService.getValue('transaction.total.currency') +'\\',';\n    confirmationPageCode += 'quantity:\\''+ vendorService.getValue('transaction.attributes.ticketQuantity') +'\\'});';\n\n    return confirmationPageCode;\n}\n\n\nVendorService.prototype.readAllCookies = function() {\n    var pairs = document.cookie.split(\";\");\n    var cookies = {};\n    for (var i=0; i<pairs.length; i++){\n        var pair = pairs[i].split(\"=\");\n        cookies[pair[0].replace(/ /g,'')] = decodeURIComponent(pair[1]);\n    }\n    return cookies;\n};\nVendorService.prototype.getPixelFileEndpoint = function(){\n    var self = this;\n    var rules = self.config.rules;\n    var urlToBuild = '';\n\n    for(var i = 0; i < rules.length; i++){\n        var currentRule = rules[i];\n        if(!currentRule.testField || !currentRule.testRegex){\n            continue;\n        }\n        if(currentRule.testRegex.test(self.getValue(currentRule.testField,self.config)) && currentRule.urlTemplate){\n            var pieces = currentRule.urlTemplate.match(/<%([^%>]+)%>/g) || [];\n            urlToBuild = currentRule.urlTemplate+'';\n            for(var j = 0; j < pieces.length; j++){\n                //data.eventID or baseUrl\n                var value='',\n                store=self.config,\n                dataPoint = pieces[j].replace('<%','').replace('%>','');\n                if(/^config\\./.test(dataPoint)){\n                    dataPoint = dataPoint.replace(/^config\\./,'');\n                }else\n                if(/^data\\./.test(dataPoint)){\n                    dataPoint = dataPoint.replace(/^data\\./,'');\n                    store = self.config.data;\n                }else\n                if(/^currentRule\\./.test(dataPoint)){\n                    dataPoint = dataPoint.replace(/^currentRule\\./,'');\n                    store = currentRule;\n                }\n\n                value = self.getValue(dataPoint,store);\n                if(typeof value !== 'number' && typeof value !== 'string')value = '';\n\n                urlToBuild = urlToBuild.replace(pieces[j],value);\n\n            }\n            break;\n        }\n\n    }\n\n    return urlToBuild || false;\n\n};\nVendorService.prototype.getScript = function(url,id,appendTo,cb){\n    var self = this;\n    try{\n        newScript = document.createElement('script');\n        newScript.type = 'text/javascript';\n        newScript.src = url;\n        newScript.async = true;\n        if(typeof id === 'string')newScript.id = id;\n        if(typeof cb === 'function'){\n            newScript.onload = cb;\n        }\n        if(appendTo){\n            appendTo.appendChild(newScript);\n        }else{\n            document.getElementsByTagName('head')[0].appendChild(newScript);\n        }\n    }catch(e){\n        if(self.config.debug === true && typeof console !== 'undefined' && typeof tags[0] !== 'undefined'){\n            console.log('Pixel Service: Script Loading Failed:' + url);\n        }\n    }\n\n};\n\n\nVendorService.prototype.getUrlParams = function (location) {\n    location = location || document.location;\n    var qd = {};\n    location.search.substr(1).split(\"&\").forEach(function (item) {\n        var k = item.split(\"=\")[0]\n            , v = decodeURIComponent(item.split(\"=\")[1]);\n        (k in qd) ? qd[k].push(v) : qd[k] = [v];\n    });\n    return qd;\n};\nVendorService.prototype.getValue = function (path, obj) {\n    var self = this;\n    if (typeof self.overrides[path] !== 'undefined') {\n        self.log('Pixel Service: Override found for path: ' + path);\n        var override = self.overrides[path];\n        if (typeof override === 'function') {\n            return override();\n        } else {\n            //it's a constant\n            return self.overrides[path];\n        }\n    }\n\n    var toNumeric = ['ticketQuantity', 'basePrice', 'feesTotal', 'transactionTotal'];\n    obj = obj || self.config.data;\n    for (var i = 0, path = path.split('.'), len = path.length; i < len; i++) {\n        if (typeof obj[path[i]] !== 'undefined') {\n            if (typeof obj[path[i]] === 'function') {\n                obj = obj[path[i]]();\n            } else {\n                if (toNumeric.indexOf(path[i]) > -1 && !obj[path[i]]) {\n                    obj = 0;\n                } else {\n                    obj = obj[path[i]];\n                }\n            }\n        } else {\n            obj = \"\";\n            break;\n        }\n    }\n    return obj;\n};\n/**\n * Return current lib version\n */\nVendorService.prototype.log = function () {\n    var self = this;\n    return self.config.version;\n\n};\nVendorService.prototype.handleError = function(msg){\n    return function(data){\n        if(typeof console !== 'undefined'){\n            console.error('ERROR: %s', msg, data);\n        }\n    };\n};\nVendorService.prototype.handlePixels = function(logPixels)\n{\n    var self = this;\n    self.pixelProcessProgress = [];\n    self.fb3 = self.pixelProcessProgress;\n    self.fetchPixels(function (err, results) {\n\n        if(err) {\n            self.handleError('Failed to retrieve tags from CDN')(err);\n            self.pixelProcessProgress.push({summary: 'Failed to retrieve tags from CDN', msg:err});\n            return;\n        } else if (results && results.length && results.length > 0) {\n            self.pixelProcessProgress.push({summary: 'Fetched Pixels Successfully', msg: 'Found ' + results.length, page: self.getValue('page.pageInfo.pageName') });\n        } else {\n            self.log('No Tags to Process');\n            return;\n        }\n\n        self.processTags(results, function (err) {\n\n            if(err) {\n                self.handleError('Failed to process tags')(err);\n                self.pixelProcessProgress.push({summary: 'Failed to process tags', msg:err});\n                return;\n            } else {\n                self.pixelProcessProgress.push({summary: 'Sorted tags successfully', page: self.getValue('page.pageInfo.pageName')});\n            }\n\n            self.processPixels(false, function (err, status){\n\n                var data = {pixels: status};\n                if(err) {\n                    self.handleError('Failed to process pixels')(err);\n                    self.pixelProcessProgress.push({summary: 'Failed to process ALL pixels sucessfully', pixelsAttempted: results.length, pixelErrors: err.length , errors:err, page: self.getValue('page.pageInfo.pageName')});\n                    data.hasPixelErrors = true;\n                } else {\n                    self.pixelProcessProgress.push({summary: 'Processed Pixels Successfully', page: self.getValue('page.pageInfo.pageName')});\n                }\n\n                if (logPixels) {\n                    window.TmPixel = window.TmPixel || [];\n                    window.TmPixel.push({event: 'pixellogs', data: data, sendAll: true});\n                }\n\n            });\n        });\n    });\n};\n/**\n * Log to console\n * @param msg\n * @param prefix\n */\nVendorService.prototype.log = function (msg, prefix) {\n    var self = this;\n    prefix = prefix || 'Pixel Service: ';\n    if (self.config.debug === true && typeof console !== 'undefined') {\n        console.log(prefix + msg);\n    }\n};\n/**\n * Merge\n * @param defMap -- source obj\n * @param overrides -- target obj, values will override the source obj.\n * @returns {{}}\n */\nVendorService.prototype.merge = function(defMap, overrides){\n    var keys = Object.keys(defMap).concat(Object.keys(overrides)),\n        copy = {};\n    keys.forEach(function (key, index) {\n        var primary = overrides[key], secondary = defMap[key];\n        if (primary !== undefined && primary !== null && primary !== '') {\n            copy[key] = primary;\n        } else if (secondary !== undefined && secondary !== null && secondary !== '') {\n            copy[key] = secondary;\n        }\n\n    });\n    return copy;\n};\nVendorService.prototype.processPixels = function(sendToDivolte, callback){\n    var self = this;\n    var status = [];\n    var hasErrors = [];\n    for(var i = 0,keys=Object.keys(self.sortedTags);i<keys.length;i++){\n        var service = keys[i];\n        self.log('Trying to find method: ' + service);\n\n        if(typeof self[service] === 'function'){\n            var tags = self.sortedTags[service];\n            for ( var j = 0; j < tags.length; j++ ) {\n                var record = { id: tags[j].id, type: tags[j].type, endDate: tags[j].endDate, beginDate: tags[j].beginDate, domains: tags[j].domains};\n                try {\n                    self[service](tags[j], j);\n                } catch ( e ) {\n                    record.error = e.message;\n                    hasErrors.push({error: e.message, pixel: record });\n                    self.log('Failed to run method for service/pixelId: ' + service + '/' + tags[j].id);\n                }\n                status.push(record);\n            }\n        }\n    }\n\n    self.pixelHistory = self.pixelHistory || [];\n    self.pixelHistory = self.pixelHistory.concat(status);\n    callback(hasErrors.length>0 ? hasErrors : null, status);\n\n};\nVendorService.prototype.processTags = function (results, callback) {\n    var self     = this;\n\n    var sortedTags     = {};\n    var now            = new Date().getTime(),\n        domain         = self.getValue('page.pageInfo.domain', self.config.data),\n        isConfirmation = /Checkout: Confirmation/.test(self.getValue('page.pageInfo.pageName')),\n        pageSubtype    = self.getValue('transaction.attributes.inventoryType') || 'primary';\n\n    for ( var i = 0; i < results.length; i++ ) {\n\n        if ( typeof results[i].types === 'undefined' ) {  //if there are no types, we can assume it's TM\n\n            var defaultCaseDomains = false;\n            if ( typeof results[i].domains === 'undefined' || results[i].domains.length < 1 ) {\n                results[i].domains = [];\n                if ( ['US_DESKTOP', 'CA_DESKTOP', 'US_MOBILE', 'CA_MOBILE'].indexOf(domain) !== -1 ) {\n                    defaultCaseDomains = true;\n                }\n            }\n\n            var fireBasedOnPageSubtype = true; //by default, we don't worry about primary/resale subtypes\n            if ( isConfirmation ) {\n                //no subtypes: this is an older pixel from before subtypes were supported, so just fire away\n                if ( typeof results[i].pageSubtypes === 'undefined' || results[i].pageSubtypes.length < 1 ) {\n                    fireBasedOnPageSubtype = true;\n                }\n                //subtypes exist: in this case, if the page subtype of the current confirmation page is not in the list, don't fire the pixel\n                else if ( results[i].pageSubtypes.indexOf(pageSubtype.toUpperCase()) === -1 ) {\n                    fireBasedOnPageSubtype = false;\n                }\n            }\n\n            //when to fire a pixel\n            if ( results[i].enabled !== false && \t\t\t\t\t\t\t\t\t\t//pixel is enabled\n                 (results[i].endDate == null || now < results[i].endDate) && \t\t\t\t\t\t\t\t\t\t//now is between the begin and end dates\n                 now > results[i].beginDate &&\n                 (results[i].domains.indexOf(domain) > -1 || defaultCaseDomains) && \t//you are on the correct domain\n                 (fireBasedOnPageSubtype)\t\t\t\t\t\t\t\t\t\t\t// the primary/resale targeting matches correctly (logic for this is above)\n            ) {\n                var key = self.toCamelCase(results[i].slug);\n                if ( typeof sortedTags[key] === 'undefined' ) {\n                    sortedTags[key] = [];\n                }\n                sortedTags[key].push(results[i]);\n            }\n        }\n\n        //case of account manager\n        else if ( typeof results[i].types !== 'undefined' ) {\n            var correctPage = false;\n            var pageName    = domain = self.getValue('page.pageInfo.pageName', self.config.data);\n            var pageType = null;\n\n            if (!(/: Checkout$/.test(pageName) || /: Billing$/.test(pageName))) {\n                if (/^((?!(Buy|Confirmation)).)*$/.test(pageName)) {\n                    pageType = 'LANDING';\n                }\n                if (/^((?!Confirmation).)*Buy((?!Confirmation).)*$/.test(pageName)) {\n                    pageType = 'PURCHASING';\n                }\n                if (/Buy: Confirmation/.test(pageName)) {\n                    pageType = 'CONFIRMATION';\n                }\n            }\n\n            if ( results[i].types.indexOf(pageType) !== -1 ) {\n                correctPage = true;\n            }\n\n            if ( results[i].enabled !== false && (results[i].endDate == null || now < results[i].endDate) && now > results[i].beginDate && correctPage ) {\n                var key = self.toCamelCase(results[i].slug);\n                if ( typeof sortedTags[key] === 'undefined' ) {\n                    sortedTags[key] = [];\n                }\n                sortedTags[key].push(results[i]);\n            }\n        }\n    }\n\n    self.sortedTags = sortedTags;\n    callback();\n\n};\nVendorService.prototype.setValue = function(path,value,obj){\n    obj = obj || {};\n    path=path.split('.');\n    for (var i=0, len=path.length; i<len; i++){\n        obj[path[i]] = obj[path[i]] || {};\n        if(i===len-1){\n            obj[path[i]] = value;\n            break;\n        }else{\n            obj = obj[path[i]];\n        }\n\n    }\n\n    return obj;\n};\nVendorService.prototype.toCamelCase = function(myString){\n    return myString.replace(/-([a-z])/g, function (g) { return g[1].toUpperCase(); });\n};\nVendorService.prototype.toFloat = function(num, numDefault){\n    var parsedBase = parseFloat(num);\n    if(!isNaN(parsedBase) && typeof parsedBase === 'number') {\n        return parsedBase.toFixed(2);\n    } else {\n        return numDefault || 0.00;\n    }\n};\n/**\n * Uniq\n * @param array to uniq\n * @returns uniq array\n */\nVendorService.prototype.uniq = function(array){\n    return array.filter(\n        function (a) { return !this[a] ? this[a] = true : false; }, {}\n    );\n};\n\nVendorService.prototype.adroll = function(i, index){\n    var self = this;\n\n        var iframe = document.createElement('iframe');\n        iframe.style.cssText = 'width:1px; height:1px; display:none;';\n        iframe.frameborder = 0;\n        var html = '<script type=\"text/javascript\">';\n        html += 'adroll_adv_id=\"' + i.advertisableId;\n        html += '\";adroll_pix_id=\"' + i.adrollPixelId;\n        html += '\";(function () {';\n        html += 'var oldonload = window.onload;';\n        html += 'window.onload = function () {';\n        html += '__adroll_loaded = true;';\n        html += 'var scr = document.createElement(\"script\");';\n        html += 'var host = ((\"https:\" == document.location.protocol) ? \"https://s.adroll.com\" : \"http://a.adroll.com\");';\n        html += 'scr.setAttribute(\\'async\\', \\'true\\');';\n        html += 'scr.type = \"text/javascript\";';\n        html += 'scr.src = host + \"/j/roundtrip.js\";';\n        html += '((document.getElementsByTagName(\\'head\\') || [null])[0] || document.getElementsByTagName(\\'script\\')[0].parentNode).appendChild(scr);';\n        html += 'if (oldonload) {oldonload()}';\n        html +=  '};}());</script>';\n\n        if(i.segmentName){\n            html += '<script type=\"text/javascript\">';\n            html += 'adroll_segments = \"' + i.segmentName +'\"';\n            html += ';</script>';\n        }\n\n        if (self.getValue('transaction.transactionID',self.config.data)) {\n            html += '<script type=\"text/javascript\">';\n            html += 'adroll_conversion_value =' + self.getValue('transaction.total.basePrice',self.config.data);\n            html += ';adroll_currency = \"' + (self.getValue('transaction.total.currency') || 'USD');\n            html += '\";</script>';\n        }\n\n        if (i.customVariables) {\n            var cust = {};\n            var u = i.customVariables;\n            for (var i in u) {\n                if (u.hasOwnProperty(i)) {\n                    cust[i] = self.getValue(u[i],self.config.data);\n                }\n            }\n\n            html += '<script type=\"text/javascript\">';\n            html += 'adroll_custom_data = ';\n            html += JSON.stringify(cust);\n            html += '</script>';\n\n        }\n\n        document.body.appendChild(iframe);\n        var doc = (iframe.contentWindow || iframe.contentDocument);\n\t\tif (doc.document)doc = doc.document;\n    \tdoc.open();\n        doc.write(html);\n        doc.close();\n\n\n};\n\nVendorService.prototype.bingV2 = function (tag, index) {\n    var self = this;\n\n        var iframe = document.createElement('iframe');\n        iframe.style.cssText = 'width:1px; height:1px; display:none;';\n        iframe.frameborder = 0;\n        iframe.id = tag.id;\n        var html = '<script type=\"text/javascript\">';\n         html += '(function(w,d,t,r,u){var f,n,i;w[u]=w[u]||[] ,f=function(){var o={ti:\"' + tag.tagId + '\"}; o.q=w[u],w[u]=new UET(o),w[u].push(\"pageLoad\")} ,n=d.createElement(t),n.src=r,n.async=1,n.onload=n .onreadystatechange=function() {var s=this.readyState;s &&s!==\"loaded\"&& s!==\"complete\"||(f(),n.onload=n. onreadystatechange=null)},i= d.getElementsByTagName(t)[0],i. parentNode.insertBefore(n,i)})(window,document,\"script\",\" //bat.bing.com/bat.js\",\"uetq\"); ';\n        html += 'window.uetq = window.uetq || [];';\n\n        if (self.getValue('transaction.transactionID',self.config.data)) {\n            html += 'window.uetq.push(\"event\", \"\", {\"revenue_value\": ' + self.getValue('transaction.total.basePrice') + ', \"currency\": \"' + self.getValue('transaction.total.currency') + '\"}); ';\n        }\n\n        html +=  '</script>';\n\n        document.body.appendChild(iframe);\n        var doc = (iframe.contentWindow || iframe.contentDocument);\n\t\tif (doc.document)doc = doc.document;\n    \tdoc.open();\n        doc.write(html);\n        doc.close();\n};\n\nVendorService.prototype.bing = function (tag, index) {\n    var self = this;\n\n            var tagId = tag.tagId;\n\n            (function (w, d, t, r, u) {\n                var f, n, i;\n                w[u] = w[u] || [], f = function () {\n                    var o = {ti: tagId};\n                    o.q = w[u], w[u] = new UET(o), w[u].push(\"pageLoad\")\n                }, n = d.createElement(t), n.src = r, n.async = 1, n.onload =\n                    n.onreadystatechange = function () {\n                        var s = this.readyState;\n                        s && s !== \"loaded\" && s !== \"complete\" || (f(), n.onload =\n                            n.onreadystatechange = null)\n                    }\n                    , i = d.getElementsByTagName(t)[0], i.parentNode.insertBefore(n, i)\n            })(window, document, \"script\", \"//bat.bing.com/bat.js\", \"uetq\");\n\n};\nVendorService.prototype.centro = function(tag, index) {\n\tvar self = this;\n\n    var src = self.getValue('transaction.transactionID') ? '//clickserv.pixel.ad/conv/' + tag.conversionId + '/' + self.getValue('transaction.total.basePrice')\n        : ('//centro.pixel.ad/iap/' + tag.conversionId);\n    self.createElem('img', src, tag.id);\n};\n\nVendorService.prototype.htmlSnippet = function (tag, index) {\n    var self = this;\n\n    var variableMap = {\n        '$artist_id$':         self.getValue('page.attributes.artistID'),\n        '$artist_name$':       self.getValue('page.attributes.artistName'),\n        '$brand$':             self.getValue('brand'),\n        '$cfc$':               self.getValue('cfc'),\n        '$client_id$':         self.getValue('page.attributes.clientID'),\n        '$document_referrer$': document.referrer,\n        '$document_href$':     document.location.href,\n        '$event_date$':        self.getValue('page.attributes.eventDate'),\n        '$event_id$':          self.getValue('page.attributes.eventID'),\n        '$event_name$':        self.getValue('page.attributes.eventName').replace(/\\x27/g, '\\\\\\x27'),\n        '$event_time$':        self.getValue('page.attributes.eventTime'),\n        '$language$':          self.getValue('page.pageInfo.language'),\n        '$inventory_type$':    ( parseInt(self.getValue('transaction.attributes.isResale') + 0) !== 0 ) ? 'resale' : 'primary',\n        '$major_category$':    self.getValue('page.category.primaryCategory'),\n        '$major_category_id$': self.getValue('page.category.primaryCategoryID'),\n        '$minor_category$':    self.getValue('page.category.subCategory1'),\n        '$minor_category_id$': self.getValue('page.category.subCategory1ID'),\n        '$mlb_product_string$':self.getValue('mlbProductString'),\n        '$face_value$':        self.getValue('transaction.total.basePrice'),\n        '$order_fees$':        self.getValue('transaction.total.feesTotal'),\n        '$order_id$':          self.getValue('transaction.transactionID'),\n        '$order_state$':       self.getValue('transaction.profile.address.stateProvince'),\n        '$order_country$':     self.getValue('transaction.profile.address.country'),\n        '$ticket_quantity$':   self.getValue('transaction.attributes.ticketQuantity'),\n        '$order_currency$':    self.getValue('transaction.total.currency'),\n        '$order_date$':        self.getValue('transaction.attributes.orderDate'),\n        '$order_time$':        self.getValue('transaction.attributes.orderTime'),\n        '$order_zip$':         self.getValue('transaction.profile.address.postalCode'),\n        '$page_name$':         self.getValue('page.pageInfo.pageName'),\n        '$random$':            Math.random() * 1000000000,\n        '$transaction_total$': self.getValue('transaction.total.transactionTotal'),\n        '$venue_country$':     self.getValue('page.attributes.country'),\n        '$venue_id$':          self.getValue('page.attributes.venueID'),\n        '$venue_name$':        self.getValue('page.attributes.venueName').replace(/\\x27/g, '\\\\\\x27'),\n        '$venue_zip$':         self.getValue('page.attributes.zip'),\n        '$event_time_zone$':   '',\n        '$product_data_json$': self.getValue('productDataJson')\n    };\n\n    var refScript = '<head><script>' +\n                    'Object.defineProperty(document, \"referrer\", { ' +\n                    'get : function() { ' +\n                    'return \\'' + document.referrer + '\\'; ' +\n                    '}' +\n                    '});' +\n                    '</script></head><body>${tag.html}</body>';\n\n    function escapeRegExp(str) {\n        return str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|\\']/g, '\\\\$&');\n    }\n\n    function cleanupString(str) {\n        if(str.replace) {\n            return str.replace(/[\\[\\]\\$\\']/g, '');\n        } else {\n            return str;\n        }\n    };\n\n    //replace all of the $...$ html strings with their actual values\n    var variablesToReplace = Object.keys(variableMap);\n    variablesToReplace.forEach(function (variableName, index) {\n        tag.html = tag.html.replace(new RegExp(escapeRegExp(variableName), 'gi'), typeof variableMap[variableName] !== 'undefined' ? cleanupString(variableMap[variableName]) : '');\n    });\n\n    var iframe           = document.createElement('iframe');\n    iframe.id            = tag.id;\n    iframe.style.cssText = 'width:1px; height:1px; display:none;';\n    iframe.frameborder   = 0;\n    document.body.appendChild(iframe);\n    var doc = (iframe.contentWindow || iframe.contentDocument);\n    if ( doc.document ) {\n        doc = doc.document;\n    }\n    doc.open();\n    doc.write(refScript.replace('${tag.html}', tag.html));\n    doc.close();\n\n};\n\nVendorService.prototype.custom = function(tag, index) {\n\tvar self = this;\n\n\tvar src;\n\t\tif(tag.url.indexOf('http:') === -1) {\n\t\t\tsrc = tag.url;\n\t\t\tif ( typeof tag.customVariables !== 'undefined' ) {\n\t\t\t\tif ( src.indexOf('?') > -1 )\n\t\t\t\t\tsrc += '&';\n\t\t\t\telse\n\t\t\t\t\tsrc += '?';\n\t\t\t\tvar u = tag.customVariables;\n\t\t\t\tfor ( var j in u ) {\n\t\t\t\t\tif ( u.hasOwnProperty(j) ) {\n\t\t\t\t\t\tsrc += j + '=' + encodeURIComponent(self.getValue(u[ j ], self.config.data)) + '&';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t//trim off the trailing ? or &\n\t\t\t\tsrc = src.substring(0, src.length - 1);\n\t\t\t}\n\n\t\t\tif ( tag.tagType !== 'SCRIPT' ) {\n\t\t\t\t//IMG or IFRAME\n\t\t\t\tself.createElem(tag.tagType, src, tag.id);\n\t\t\t} else {\n\t\t\t\tvar scrpt = document.createElement('script');\n\t\t\t\tscrpt.src = src;\n\t\t\t\tself.createElem('iframe', \"\", tag.id, function() {\n\t\t\t\t\tvar doc = this.contentWindow || this.contentDocument;\n\t\t\t\t\tdoc = doc.document || doc;\n\t\t\t\t\tvar head = doc.getElementsByTagName(\"head\")[ 0 ];\n\t\t\t\t\thead.appendChild(scrpt);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n};\nVendorService.prototype.doubleclickFloodlightCounter = function (tag, index) {\n    var self = this;\n\n    tag.floodlightId = tag.advertiserId;\n\n    //for every tag, load gtm and fire gtag config\n    var html = '<script async src=\"https://www.googletagmanager.com/gtag/js?id=DC-' + tag.floodlightId + '\"></script>';\n    html += '<script>';\n    html += 'window.dataLayer = window.dataLayer || [];';\n    html += 'function gtag(){dataLayer.push(arguments);}';\n    html += 'gtag(\\'js\\', new Date());';\n    html += 'gtag(\\'config\\', \\'DC-' + tag.floodlightId + '\\');';\n\n    html += 'gtag(\\'event\\', \\'conversion\\', {\\'send_to\\': \\'DC-' + tag.advertiserId + '/'\n        + tag.groupTagString + '/' + tag.activityTagString + '+' + tag.countingMethod.toString().toLowerCase() + '\\'';\n    html += ', \\'allow_custom_scripts\\': \\'' + 'false' + '\\'';\n\n    if (typeof tag.customVariables !== 'undefined') {\n        var u = tag.customVariables;\n        for (var i in u) {\n            if (u.hasOwnProperty(i)) {\n                var value = self.getValue(u[i], self.config.data);\n                html += ', \\'' + i + '\\': \\'' + value + '\\'';\n            }\n        }\n    }\n    html += '});';\n    html += '</script>';\n\n    self.createIframeWithContent(tag.id, html, function () {\n        self.log('Iframe added for pixel: ' + tag.id);\n    });\n}\n\nVendorService.prototype.doubleclickFloodlightSales = function (tag, index) {\n    var self = this;\n\n    tag.floodlightId = tag.advertiserId;\n\n    //for every tag, load gtm and fire gtag config\n    var html = '<script async src=\"https://www.googletagmanager.com/gtag/js?id=DC-' + tag.floodlightId + '\"></script>';\n    html += '<script>';\n    html += 'window.dataLayer = window.dataLayer || [];';\n    html += 'function gtag(){dataLayer.push(arguments);}';\n    html += 'gtag(\\'js\\', new Date());';\n    html += 'gtag(\\'config\\', \\'DC-' + tag.floodlightId + '\\');';\n\n    html += 'gtag(\\'event\\', \\'purchase\\', {\\'send_to\\': \\'DC-' + tag.advertiserId + '/'\n        + tag.groupTagString + '/' + tag.activityTagString + '+' + tag.countingMethod.toString().toLowerCase() + '\\'';\n    html += ', \\'allow_custom_scripts\\': \\'' + 'false' + '\\'';\n\n    if ( self.getValue('transaction.transactionID', self.config.data) ) {\n        html += ', \\'value\\':' + self.toFloat(self.getValue('transaction.total.basePrice') , 0);\n        html += ', \\'quantity\\':';\n        html += self.getValue('transaction.attributes.ticketQuantity', self.config.data);\n        html += ', \\'currency\\': \\'' + self.getValue('transaction.total.currency') + '\\'';\n        html += ', \\'transaction_id\\': \\'' + self.getValue('transaction.transactionID') + '\\'';\n    }\n    if (typeof tag.customVariables !== 'undefined') {\n        var u = tag.customVariables;\n        for (var i in u) {\n            if (u.hasOwnProperty(i)) {\n                var value = self.getValue(u[i], self.config.data);\n                html += ', \\'' + i + '\\': \\'' + value + '\\'';\n            }\n        }\n    }\n    html += '});';\n    html += '</script>';\n\n    self.createIframeWithContent(tag.id, html, function () {\n        self.log('Iframe added for pixel: ' + tag.id);\n    });\n};\n\nVendorService.prototype.doubleclickGtagEvent = function (tag, index) {\n    var self = this;\n\n    tag.floodlightId = tag.sendTo.split('/')[0];\n\n    //for every tag, load gtm and fire gtag config\n    var html = '<script async src=\"https://www.googletagmanager.com/gtag/js?id=' + tag.floodlightId + '\"></script>';\n    html += '<script>';\n    html += 'window.dataLayer = window.dataLayer || [];';\n    html += 'function gtag(){dataLayer.push(arguments);}';\n    html += 'gtag(\\'js\\', new Date());';\n    html += 'gtag(\\'config\\', \\'' + tag.floodlightId + '\\');';\n    \n    if (tag.sendTo.indexOf('transactions') !== -1 || tag.sendTo.indexOf('items_sold') !== -1) {\n        html += 'gtag(\\'event\\', \\'purchase\\', {\\'send_to\\': \\'' + tag.sendTo + '\\'';\n    } else {\n        html += 'gtag(\\'event\\', \\'conversion\\', {\\'send_to\\': \\'' + tag.sendTo + '\\'';\n    }\n    html += ', \\'allow_custom_scripts\\': \\'' + 'false' + '\\'';\n    \n    if ( (tag.sendTo.indexOf('transactions') !== -1 || tag.sendTo.indexOf('items_sold') !== -1)\n        && self.getValue('transaction.transactionID', self.config.data)) {\n            html += ', \\'value\\':' + self.toFloat(self.getValue('transaction.total.basePrice') , 0);\n            html += ', \\'quantity\\':';\n            html += tag.sendTo.indexOf('transactions') !== -1 ? 1 : self.getValue('transaction.attributes.ticketQuantity', self.config.data);\n            html += ', \\'currency\\': \\'' + self.getValue('transaction.total.currency') + '\\'';\n            html += ', \\'transaction_id\\': \\'' + self.getValue('transaction.transactionID') + '\\'';\n    }\n    if (typeof tag.customVariables !== 'undefined') {\n        var u = tag.customVariables;\n        for (var i in u) {\n            if (u.hasOwnProperty(i)) {\n                var value = self.getValue(u[i], self.config.data);\n                html += ', \\'' + i + '\\': \\'' + value + '\\'';\n            }\n        }\n    }\n    html += '});';\n    html += '</script>';\n\n    self.createIframeWithContent(tag.id, html, function () {\n        self.log('Iframe added for pixel: ' + tag.id);\n    });\n};\n\nVendorService.prototype.doubleclickPublishersConversion = function (i, index) {\n\tvar self = this;\n\n\tvar img = document.createElement('img');\n\timg.src = 'https://pubads.g.doubleclick.net/activity;xsp=' + i.publisherId;\n\n\n\tif (self.getValue('transaction.transactionID',self.config.data)) {\n\t\timg.src += ';ord=' + self.getValue('transaction.transactionID',self.config.data);\n\t\timg.src += ';cost=' + self.getValue('transaction.total.basePrice',self.config.data);\n\t\tif (i.countingMethod === 'TRANSACTIONS') {\n\t\t\timg.src += ';qty=' + 1;\n\t\t} else {\n\t\t\timg.src += ';qty=' + self.getValue('transaction.attributes.ticketQuantity',self.config.data);\n\t\t}\n\t} else {\n\t\tvar axel = Math.random() + \"\";\n\t\tvar a = axel * 10000000000000;\n\t\timg.src += ';ord=' + a;\n\t}\n\n\timg.src += '?';\n\n\timg.width = 1;\n\timg.height = 1;\n\timg.border = 0;\n\n\tdocument.body.appendChild(img);\n\n};\nVendorService.prototype.facebookAudience = function (tag, index) {\n    var self = this;\n\n//****** Facebook Audience ******//\n    var html = '<script type=\"text/javascript\">';\n    html+= '(function () {';\n    html+= '    var _fbq = window._fbq || (window._fbq = []);';\n    html+= '    if ( !_fbq.loaded ) {';\n    html+= '        var fbds   = document.createElement(\\'script\\');';\n    html+= '        fbds.async = true;';\n    html+= '        fbds.src   = \\'//connect.facebook.net/en_US/fbds.js\\';';\n    html+= '        var s      = document.getElementsByTagName(\\'script\\')[0];';\n    html+= '        s.parentNode.insertBefore(fbds, s);';\n    html+= '        _fbq.loaded = true;';\n    html+= '    }';\n    html+= '    window._fbq.push([\\'addPixelId\\', tag.pixelId]);';\n    html+= '})();';\n\n    html+= 'window._fbq = window._fbq || [];';\n    html+= 'window._fbq.push([\\'track\\', \\'PixelInitialized\\', {}]);';\n\n    if ( self.getValue('transaction.transactionID') ) {\n        html+= 'window._fbq.push([\\'track\\', \\'Purchase\\', {';\n        html+= '    currency: \\'' + self.getValue('transaction.total.currency') + '\\',';\n        html+= '    value:    \\'' + self.getValue('transaction.total.basePrice') + '\\'';\n        html+= '}]);';\n    }\n    else {\n    html+= 'window._fbq.push([\\'track\\', \\'ViewContent\\']);';\n    }\n    html += '</script>';\n\n    self.createIframeWithContent(tag.id, html, function () {\n        self.log('Iframe added for pixel: ' + tag.id);\n    });\n\n//****** End Facebook Audience ******//\n\n};\nVendorService.prototype.facebookConversion = function (tag, index) {\n    var self = this;\n\n//****** Facebook Conversion ******//\n    var html = '<script type=\"text/javascript\">';\n    html+= '(function () {';\n    html+= '    var _fbq = window._fbq || (window._fbq = []);';\n    html+= '    if ( !_fbq.loaded ) {';\n    html+= '        var fbds   = document.createElement(\\'script\\');';\n    html+= '        fbds.async = true;';\n    html+= '        fbds.src   = \\'//connect.facebook.net/en_US/fbds.js\\';';\n    html+= '        var s      = document.getElementsByTagName(\\'script\\')[0];';\n    html+= '        s.parentNode.insertBefore(fbds, s);';\n    html+= '        _fbq.loaded = true;';\n    html+= '    }';\n    html+= '})();';\n    html+= '(function () {';\n    html+= '    window._fbq = window._fbq || [];';\n    html+= '        window._fbq.push([\\'track\\', \\'' + tag.pixelId + '\\', {';\n    html+= '    currency: \\'' + self.getValue('transaction.total.currency') + '\\',';\n    html+= '    value:    \\'' + self.getValue('transaction.total.basePrice') + '\\'';\n    html+= '        }]);';\n    html+= '})();';\n    html += '</script>';\n\n    self.createIframeWithContent(tag.id, html, function () {\n        self.log('Iframe added for pixel: ' + tag.id);\n    });\n\n//****** End Facebook Conversion ******//\n};\n\nVendorService.prototype.facebook = function (tag, index) {\n    var self = this;\n\n    //load the library in the iFrame\n    var html = '<script type=\"text/javascript\">';\n    html += '!function(f, b, e, v, n, t, s) {';\n    html += 'if ( f.fbq ) return;';\n    html += 'n = f.fbq = function() {';\n    html += 'n.callMethod ?';\n    html += 'n.callMethod.apply(n, arguments) : n.queue.push(arguments)';\n    html += '};';\n    html += 'if ( !f._fbq )';\n    html += 'f._fbq = n;';\n    html += 'n.push = n;';\n    html += 'n.loaded = !0;';\n    html += 'n.version = \\'2.0\\';';\n    html += 'n.agent = \\'PLTICKETMASTER\\';';\n    html += 'n.queue = [];';\n    html += 't = b.createElement(e);';\n    html += 't.async = !0;';\n    html += 't.src = v;';\n    html += 's = b.getElementsByTagName(e)[ 0 ];s.parentNode.insertBefore(t, s)';\n    html += '}(window,';\n    html += 'document, \\'script\\', \\'//connect.facebook.net/en_US/fbevents.js\\');';\n\n    //track init and pageView\n    html += 'fbq(\\'set\\', \\'autoConfig\\', false, \\'' + tag.pixelId + '\\');';\n    html += 'fbq(\\'init\\', \\'' + tag.pixelId + '\\');';\n    html += 'fbq(\\'track\\', \\'PageView\\');';\n\n    html += '</script>';\n\n    html += '<script type=\"text/javascript\">';\n\n    if ( self.getValue('transaction.transactionID', self.config.data) ) {\n        var inventoryType = ( parseInt(self.getValue('transaction.attributes.isResale') + 0) !== 0 ) ? 'resale' : 'primary';\n\n        html += 'fbq(\\'track\\', \\'Purchase\\',';\n        html += '{';\n        html += 'value: ' + self.toFloat(self.getValue('transaction.total.basePrice') , 0) + ',';\n        html += 'currency: \\'' + self.getValue('transaction.total.currency') + '\\'';\n        html += ',inventory_type: \\'' + inventoryType + '\\',';\n    } else {\n        html += 'fbq(\\'track\\', \\'ViewContent\\',';\n        html += '{';\n    }\n\n        html += 'hostname: window.parent.location.hostname,';\n        html += 'page_name: \\'' + self.getValue('page.pageInfo.pageName') + '\\',';\n        html += 'event_name: \\'' + self.addSlashes(self.getValue('page.attributes.eventName').replace(/\\x27/g, '\\\\\\x27')) + '\\',';\n        html += 'event_id: \\'' + self.getValue('page.attributes.eventID') + '\\',';\n        html += 'event_cat_major: \\'' + self.addSlashes(self.getValue('page.category.primaryCategory')) + '\\',';\n        html += 'event_cat_minor: \\'' + self.addSlashes(self.getValue('page.category.subCategory1')) + '\\',';\n\n        /* start - added for AS-2229 (Facebook parameters for DPA) */\n        html += 'content_ids: \\'' + self.getValue('page.attributes.eventID') + '\\',';\n        html += 'content_type: \\'product\\',';\n        /* end - added for AS-2229 (Facebook parameters for DPA) */\n\n        html += 'channel: \\'' + (self.getValue('accountManager') == true ? 'Account Manager' : 'Ticketmaster') + '\\',';\n\n        html += 'artist_name: \\'' + self.addSlashes(self.getValue('page.attributes.artistName')) + '\\',';\n        html += 'artist_id: \\'' + self.getValue('page.attributes.artistID') + '\\',';\n        html += 'venue_name: \\'' + self.addSlashes(self.getValue('page.attributes.venueName').replace(/\\x27/g, '\\\\\\x27')) + '\\',';\n        html += 'venue_id: \\'' + self.getValue('page.attributes.venueID') + '\\'';\n\n        html += '}';\n        html += ');';\n\n    html += '</script>';\n\n    self.createIframeWithContent(tag.id, html, function () {\n        self.log('Iframe added for pixel: ' + tag.id);\n    });\n\n};\nVendorService.prototype.googleAdwordsConversion = function (tag, index) {\n\tvar self = this;\n\tvar pixel = JSON.parse(JSON.stringify(tag));\n\n\tvar next = function () {\n\n\t\tvar params = {};\n\t\tparams.google_conversion_id = pixel.conversionId;\n\t\tparams.google_conversion_label = typeof pixel.conversionLabel !== 'undefined' ? pixel.conversionLabel : '';\n\t\tparams.google_remarketing_only = false;\n\t\tparams.google_conversion_value = self.getValue('transaction.total.basePrice');\n\t\tparams.google_conversion_currency = self.getValue('transaction.total.currency') || 'USD';\n\t\tgoogle_trackConversion(params);\n\t};\n\n\n\tif (typeof window.google_trackConversion === 'undefined') {\n\t\tself.getScript(location.protocol + \"//www.googleadservices.com/pagead/conversion_async.js\", null, null,\n\t\t\tfunction () {\n\t\t\t\tnext();\n\t\t\t});\n\n\t} else {\n\t\tnext();\n\t}\n\n};\nVendorService.prototype.googleAdwordsGtagEvent = function (tag, index) {\n    var self = this;\n\n    //check for a sendTo parameter\n    if(tag.sendTo) {\n        tag.conversionId = tag.sendTo.split('/')[0];\n        tag.conversionLabel = tag.sendTo.split('/')[1];\n    }\n\n    //for every tag, load gtm and fire gtag config\n    var html = '<script async src=\"https://www.googletagmanager.com/gtag/js?id=' + tag.conversionId + '\"></script>';\n    html += '<script>';\n    html += 'window.dataLayer = window.dataLayer || [];';\n    html += 'function gtag(){dataLayer.push(arguments);}';\n    html += 'gtag(\\'js\\', new Date());';\n    html += 'gtag(\\'config\\', \\'' + tag.conversionId + '\\');';\n    \n    //for tags with a conversion label, fire a conversion event (these would be the \"event tags\" (vs. global site tags))\n    if(tag.conversionLabel) {\n\n        if (self.getValue('transaction.transactionID', self.config.data)) {\n            html += 'gtag(\\'event\\', \\'purchase\\', {\\'send_to\\': \\'' + tag.conversionId + '/' + tag.conversionLabel + '\\'';\n        } else {\n            html += 'gtag(\\'event\\', \\'conversion\\', {\\'send_to\\': \\'' + tag.conversionId + '/' + tag.conversionLabel + '\\'';\n        }\n\n        if(self.getValue('transaction.transactionID', self.config.data)) {\n            html += ', \\'value\\':' + self.toFloat(self.getValue('transaction.total.basePrice') , 0);\n            html += ', \\'currency\\': \\'' + self.getValue('transaction.total.currency') + '\\'';\n            html += ', \\'transaction_id\\': \\'' + self.getValue('transaction.transactionID') + '\\'';\n        }\n        \n        html += '});';\n\n    }\n    \n    html += '</script>';\n\n    self.createIframeWithContent(tag.id, html, function () {\n        self.log('Iframe added for pixel: ' + tag.id);\n    });\n\n};\nVendorService.prototype.googleAdwordsGtagGlobal = function (tag, index) {\n    var self = this;\n\n    //for every tag, load gtm and fire gtag config\n    var html = '<script async src=\"https://www.googletagmanager.com/gtag/js?id=' + tag.adWordsId + '\"></script>';\n    html += '<script>';\n    html += 'window.dataLayer = window.dataLayer || [];';\n    html += 'function gtag(){dataLayer.push(arguments);}';\n    html += 'gtag(\\'js\\', new Date());';\n    html += 'gtag(\\'config\\', \\'' + tag.adWordsId + '\\');';\n    html += '</script>';\n\n    self.createIframeWithContent(tag.id, html, function () {\n        self.log('Iframe added for pixel: ' + tag.id);\n    });\n\n};\nVendorService.prototype.googleAdwordsRemarketing = function (tag, index) {\n    var self = this;\n\n    //****** Adwords Conversion ******//\n    var pixel = JSON.parse(JSON.stringify(tag));\n\n    var next = function (arr) {\n        var params = {};\n        params.google_conversion_id = pixel.conversionId;\n        params.google_conversion_label = typeof pixel.conversionLabel !== 'undefined' ? pixel.conversionLabel : '';\n        params.google_remarketing_only = true;\n        params.google_conversion_value = self.getValue('transaction.total.basePrice');\n        google_trackConversion(params);\n    };\n\n    if (typeof window.google_trackConversion === 'undefined') {\n\n        self.getScript(location.protocol + '//www.googleadservices.com/pagead/conversion_async.js', null, null,\n            function () {\n                next();\n            });\n\n    } else {\n        next();\n    }\n    //****** End Adwords Retargeting ******//\n};\n//****** Google Analytics ******//\n// This legacy tag runs analytics.js in the top DOM of the page, it should be sequestered in an IFRAME as of 2019 InfoSec practices\n// However GA3 will be sunset by Google on July 1, 2023 so this is left as-is to be deprecated while maintaining consistency\n// Input :\n//\t* tag \t: the object deserialized from the json pixel TM1 marketing has generated\n//\t* index : index of the current tag in the page. Part of the general vendor interface that is called in src/lib/prototypes/processPixels.js L14\n\nfunction loadGoogleAnalyticsLibrary() {\n\t// this _should_ be loaded on all pages by way of TM Analytics Platform, but just in case\n\tvar windowObject = window, domDocument = document, scriptTag = 'script', gaEndpointUrl = '//www.google-analytics.com/analytics.js', libKey = 'ga';\n\twindowObject['GoogleAnalyticsObject'] = libKey;\n\twindowObject[libKey] = windowObject[libKey] || function () {\n\t\t(windowObject[libKey].q = windowObject[libKey].q || []).push(arguments)\n\t}, windowObject[libKey].l = 1 * new Date();\n\n\tvar scriptElement = domDocument.createElement(scriptTag), firstScriptTagInDom = domDocument.getElementsByTagName(scriptTag)[0];\n\tscriptElement.async = 1;\n\tscriptElement.src = gaEndpointUrl;\n\tfirstScriptTagInDom.parentNode.insertBefore(scriptElement, firstScriptTagInDom);\n}\n\n// Helper: Build Product actionFieldObject for ecommerce to this named tracker\n// Named tracker documentation : https://support.google.com/tagmanager/answer/2574372#TrackerName\nconst htmlSingleQuote = '\\\\\\x27';\nvar buildAndSendEcommerceEvents = function (gaVendorService, trackerName, tag) {\n\tvar require = trackerName + \".require\";\n\tvar ecom = trackerName + \".ec\";\n\tga(require, 'ec');\n\n\t// First, get all the generic Product stuff with values we know are present in fanbuilder\n\tvar productInfo = {\n\t\tid: gaVendorService.getValue('page.attributes.eventID'),\n\t\tname: gaVendorService.getValue('googleAnalytics.productInfo.name') || gaVendorService.getValue('page.attributes.eventName').replace(/\\x27/g, htmlSingleQuote),\n\t\tcategory: gaVendorService.getValue('googleAnalytics.productInfo.category') || gaVendorService.getValue('page.category.primaryCategory') || gaVendorService.getValue('page.attributes.eventType') || \"\",\n\t\tbrand: gaVendorService.getValue('accountManager') ? 'Account Manager' : 'Ticketmaster'\n\t};\n\n\t// Second, Add Product custom dimensions (can't tell if it is hit/session/product scoped so add to both, GA will ignore invalid scopes)\n\tif (typeof tag.customVariables !== 'undefined') {\n\t\tfor (var key in tag.customVariables) {\n\t\t\tproductInfo[key] = gaVendorService.getValue(tag.customVariables[key]);\n\t\t}\n\t}\n\n\t// Third, add ec Products Actions to the hit, if its a confirmation page, add products and purchase action\n\t// Official documentation :\n\t// \t* https://developers.google.com/analytics/devguides/collection/analyticsjs/ecommerce\n\t//\t* https://developers.google.com/analytics/devguides/collection/analyticsjs/enhanced-ecommerce\n\t// A good step by step guide : https://www.optimizesmart.com/implementing-enhanced-ecommerce-tracking-universal-analytics/\n\tif(gaVendorService.getValue('transaction.transactionID')){\n\t\t// Augment productInfo above with processedItems that expand transaction data for cat/variant/etc\n\t\t// \t \"processedItems\" is a construct in Google Tag Manager that handles platform fixes/issues\n\t\tvar processedItemsLength = gaVendorService.getValue('googleAnalytics.productInfo.processedItems').length || 1;\n\t\tfor(var i=0; i<processedItemsLength; i++){\n\t\t\t// Here we take that info and apply \"safe\" backups in case it is missing for critical transaction attributes\n\t\t\tvar processedItemsDefined = gaVendorService.getValue('googleAnalytics.productInfo.processedItems') && gaVendorService.getValue('googleAnalytics.productInfo.processedItems')[i];\n\t\t\tproductInfo.id = processedItemsDefined ? gaVendorService.getValue('googleAnalytics.productInfo.processedItems')[i].gaId : gaVendorService.getValue('page.attributes.eventID');\n\t\t\tproductInfo.name = processedItemsDefined ? gaVendorService.getValue('googleAnalytics.productInfo.processedItems')[i].gaName : ( gaVendorService.getValue('googleAnalytics.productInfo.name') || gaVendorService.getValue('page.attributes.eventName').replace(/\\x27/g, htmlSingleQuote) || \"\" );\n\t\t\tproductInfo.category = processedItemsDefined ? gaVendorService.getValue('googleAnalytics.productInfo.processedItems')[i].gaCategory : ( gaVendorService.getValue('page.category.primaryCategory') || gaVendorService.getValue('page.attributes.eventType') || \"\" );\n\t\t\tproductInfo.variant = processedItemsDefined ? gaVendorService.getValue('googleAnalytics.productInfo.processedItems')[i].gaVariant : ( gaVendorService.getValue('googleAnalytics.productInfo.variant') || \"\" );\n\t\t\tproductInfo.quantity = processedItemsDefined ? gaVendorService.getValue('googleAnalytics.productInfo.processedItems')[i].quantity : gaVendorService.getValue('transaction.attributes.ticketQuantity');\n\t\t\tproductInfo.price = processedItemsDefined ? gaVendorService.getValue('googleAnalytics.productInfo.processedItems')[i].price.basePrice : ( gaVendorService.getValue('transaction.total.basePrice')/gaVendorService.getValue('transaction.attributes.ticketQuantity') );\n\t\t\tproductInfo.brand = gaVendorService.getValue('accountManager') ? 'Account Manager' : gaVendorService.getValue('googleAnalytics.productInfo.confirmationBrand');\n\t\t\tga(ecom + ':addProduct', productInfo);\n\t\t}\n\t\t//then, call a single purchase event with totals included (sent with pageview below to named tracker object)\n\t\tga(ecom + ':setAction', 'purchase', {\n\t\t\tid: gaVendorService.getValue('transaction.transactionID'),\n\t\t\taffiliation: 'Ticketmaster',\n\t\t\trevenue: gaVendorService.getValue('transaction.total.basePrice'),\n\t\t\tcurrency: gaVendorService.getValue('transaction.total.currency')\n\t\t});\n\t} else if ( gaVendorService.getValue('page.attributes.eventID') ){ //if you are on an EDP and have event info, Add a Product Impression\n\t\tga(ecom + ':addProduct', productInfo );\n\t\tga(ecom + ':setAction', 'detail');\n\t}\n};\n\nVendorService.prototype.googleAnalyticsV2 = function (tag, index) {\n    var self = this;\n\n\tif( !window.ga ) {\n\t\tloadGoogleAnalyticsLibrary();\n\t}\n\n\t// Prepare tracker object and send page hit\n\tif (typeof tag.trackingId !== \"undefined\") {\n\t\tvar trackerName = 'tracker' + tag.id;\n\t\tga('create', tag.trackingId, 'auto', {'name': trackerName, 'allowLinker': true});\n\t\t// Add Hit/Session Custom Dimensions (separate function for jest tests, could be done here as with products)\n\t\tself.addGA2CustomDimensions(ga, trackerName, tag.customVariables);\n\t\tbuildAndSendEcommerceEvents(self, trackerName, tag);\n\t\tga(trackerName + '.send', 'pageview');\n\t}\n};\n\nVendorService.prototype.googleAnalyticsV4 = function (tag, index) {\n    /*\n     This vendor uses some unusual adaptations to manage GA4 data integrity\n      1 - Rename both the dataLayer and gtag object to prevent client tags from \"hearing\"\n            other pushes.  Shouldn't happen in the IFRAME but gtag has shown it can do this\n            when similar approach used in GTM\n                https://developers.google.com/tag-platform/devguides/dataLayer#rename_the_data_layer\n                https://developers.google.com/analytics/devguides/collection/gtagjs/renaming-the-gtag-object\n      2 - Hard disable to the tracker with setTimeout() as normally it will continue to try to listen for\n            Enhanced Measurement events which we cannot control but clients can set in their config.\n                https://support.google.com/analytics/answer/9216061\n      3 - Use the new token from GTM override productDataJson, an enhanced and formatted JSON object for GA/CCV vendors\n    */\n    var self = this;\n\n    if (isTrackingIdValid(tag)) {\n        var html = self.generateGA4HtmlScriptTag(tag);\n\n        self.createIframeWithContent(tag.id, html, function () {\n            self.log('Iframe added for pixel: ' + tag.id);\n        });\n    } else {\n        self.log('Invalid GA4 ID: ' + tag.trackingId);\n    }\n};\n\nvar isTrackingIdValid =  function(tag) {\n    var gaTrackingIdPrefix = 'G-';\n    return !!tag.trackingId && tag.trackingId.indexOf(gaTrackingIdPrefix) !== -1;\n}\n\nVendorService.prototype.googleAnalytics = function (tag, index) {\n    var self = this;\n\n//****** Google Analytics ******//\n\n        (function (i, s, o, g, r, a, m) {\n            i['GoogleAnalyticsObject'] = r;\n            i[r] = i[r] || function () {\n                    (i[r].q = i[r].q || []).push(arguments)\n                }, i[r].l = 1 * new Date();\n            a = s.createElement(o),\n                m = s.getElementsByTagName(o)[0];\n            a.async = 1;\n            a.src = g;\n            m.parentNode.insertBefore(a, m)\n        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');\n\n        var collectProductInfo = function (){\n        \tvar productInfo = {\n        \t    'id': self.getValue('page.attributes.eventID'),\n        \t    'name': self.getValue('page.attributes.eventName').replace(/\\x27/g, '\\\\\\x27') + ' on ' + self.getValue('page.attributes.eventDate') + ' at ' + self.getValue('page.attributes.venueName').replace(/\\x27/g, '\\\\\\x27'),\n        \t    'category': self.getValue('page.category.primaryCategory') || self.getValue('page.attributes.eventType')\n        \t};\n\n        \tif(self.getValue('transaction.transactionID')){\n        \t\tproductInfo.variant = self.getValue('transaction.attributes.isResale') ? 'Resale' : 'Primary';\n        \t    productInfo.quantity = self.getValue('transaction.attributes.ticketQuantity');\n        \t    productInfo.price = self.getValue('transaction.total.basePrice')/self.getValue('transaction.attributes.ticketQuantity');\n        \t}\n        \t\n        \treturn productInfo;\n        };\n        \n        var ecommerce = function (acct) {\n            \n\t        var require = acct + \".require\";\n\t        var ecom = acct + \".ec\";\n\t        ga(require, 'ec');\n                \n\t        //if its a confirmation page, add products and purchase action\n\t        if(self.getValue('transaction.transactionID')){\n\t        \tga(ecom + ':addProduct', collectProductInfo());\n\t        \tga(ecom + ':setAction', 'purchase', {\n\t        \t\t  'id': self.getValue('transaction.transactionID'),\n\t        \t\t  'affiliation': 'Ticketmaster',\n\t        \t\t  'revenue': self.getValue('transaction.total.basePrice')\n\t        \t});\n\t        }\n\t        //if you are on an EDP and have event info, count an impression\n\t        else if (self.getValue('page.attributes.eventID')){\n\t        \tga(ecom + ':addImpression', collectProductInfo());\n\t        }\n        };\n\n       \n            if (typeof tag.trackingId !== \"undefined\") {\n                var name = 'tracker' + tag.id;\n                ga('create', tag.trackingId, 'auto', {'name': name, 'allowLinker': true});\n                ecommerce(name);\n                ga(name + '.send', 'pageview');\n            }\n\n    \n//****** End Google Analytics ******//\n};\nVendorService.prototype.lotame = function (tag, index) {\n    var self = this;\n\n            var img = document.createElement('img');\n            img.src = 'https://bcp.crwdcntrl.net/5/c=' + tag.clientId;\n            img.src += '/b=' + tag.behaviorId;\n            img.width = 1;\n            img.height = 1;\n\n            document.body.appendChild(img);\n\n};\nVendorService.prototype.marketo = function (tag, index) {\n    var self = this;\n\n        var iframe = document.createElement('iframe');\n        iframe.style.cssText = 'width:1px; height:1px; display:none;';\n        iframe.frameborder = 0;\n        iframe.id = tag.id;\n        var html = '<script type=\"text/javascript\" src=\"//munchkin.marketo.net/munchkin.js\"></script>';\n\n        html += '<script type=\"text/javascript\">';\n        html += 'Munchkin.init(\"' + tag.munchkinId + '\");';\n        html += 'Munchkin.munchkinFunction(\"visitWebPage\", { url: \"' + self.getValue('page.pageInfo.pageName') + '\" } );';\n        html += '</script>';\n\n        document.body.appendChild(iframe);\n        var doc = (iframe.contentWindow || iframe.contentDocument);\n\t\tif (doc.document)doc = doc.document;\n    \tdoc.open();\n        doc.write(html);\n        doc.close();\n\n        \n};\nVendorService.prototype.mediamath = function (tag, index) {\n    var self = this;\n\n            var img = document.createElement('img');\n            img.src = '//pixel.mathtag.com/event/img?mt_id=' + tag.pixelId;\n            img.src += '&mt_adid=' + tag.advertiserId;\n            img.style.display = 'none';\n            img.width = 1;\n            img.height = 1;\n\n            if (typeof tag.customVariables !== 'undefined') {\n                var u = tag.customVariables;\n                for (var i in u) {\n                    if (u.hasOwnProperty(i)) {\n                        img.src += '&' + i + '=' + self.getValue(u[i]);\n                    }\n                }\n            }\n            document.body.appendChild(img);\n\n};\n\nVendorService.prototype.oracleBluekai = function (tag, index) {\n    var self = this;\n\n    //load the library in the iFrame\n    var html = '<script>';\n    html+= 'window.bk_async = function() {';\n    html+= 'bk_addPageCtx(\\'' + tag.phintKey + '\\', \\'' + tag.phintValue + '\\');';\n    html+= 'BKTAG.doTag(' + tag.siteId + ', 1);';\n    html+= '};';\n\n    html+= '(function() {';\n    html+= 'var scripts = document.getElementsByTagName(\\'script\\')[0];';\n    html+= 'var s = document.createElement(\\'script\\');';\n    html+= 's.async = true;';\n    html+= 's.src = \"https://tags.bkrtx.com/js/bk-coretag.js\";';\n    html+= 'scripts.parentNode.insertBefore(s, scripts);';\n    html+= '}());';\n    html+= '</script>';\n\n    self.createIframeWithContent(tag.id, html, function () {\n        self.log('Iframe added for pixel: ' + tag.id);\n    });\n}\n\n\nVendorService.prototype.oracleEloqua = function(tag, index) {\n  var self = this;\n  var src = '//s' + tag.siteId + '.t.eloqua.com/visitor/v200/svrGP?pps=3&siteid=' + tag.siteId;\n  self.createElem('img', src, tag.id);\n\n};\nVendorService.prototype.pinterest = function (tag, index) {\n    var self = this;\n\n    //load the library in the iFrame\n    var html = '<script>';\n    html += '!function(e){if(!window.pintrk){window.pintrk = function () {';\n    html += 'window.pintrk.queue.push(Array.prototype.slice.call(arguments))};';\n    html += 'var n=window.pintrk;n.queue=[],n.version=\"3.0\";';\n    html += 'var t=document.createElement(\"script\");t.async=!0,t.src=e;';\n    html += 'var r=document.getElementsByTagName(\"script\")[0];';\n    html += 'r.parentNode.insertBefore(t,r)}}';\n    html += '(\"https://s.pinimg.com/ct/core.js\");';\n\n    html += 'pintrk(\\'load\\', \\'' + tag.conversionTagId + '\\');';\n    html += 'pintrk(\\'page\\');';\n\n    if ( self.getValue('transaction.transactionID', self.config.data) ) {\n        html += 'pintrk(\\'track\\', \\'checkout\\', {';\n        html += 'value: ' + self.toFloat(self.getValue('transaction.total.basePrice') , 0) + ',';\n        html += 'order_quantity: ' + self.getValue('transaction.attributes.ticketQuantity', self.config.data) + ',';\n        html += 'currency: \\'' + self.getValue('transaction.total.currency') + '\\',';\n        html += 'line_items: [{';\n        html += 'product_name: \\'' + self.getValue('page.attributes.eventName') + '\\',';\n        html += 'product_id: \\'' + self.getValue('page.attributes.eventID') + '\\',';\n        html += 'product_category: \\'' + self.getValue('page.attributes.artistID') + '\\'';\n        html += '}]';\n        html += '});';\n    }\n\n    html+= '</script>';\n\n    self.createIframeWithContent(tag.id, html, function () {\n        self.log('Iframe added for pixel: ' + tag.id);\n    });\n}\n\nVendorService.prototype.quantcast = function (tag, index) {\n    var self = this;\n\n    window._qevents = window._qevents || [];\n\n    (function () {\n        var elem   = document.createElement('script');\n        elem.src   =\n            (document.location.protocol === 'https:' ? 'https://secure' : 'http://edge')\n            + '.quantserve.com/quant.js';\n        elem.async = true;\n        elem.type  = 'text/javascript';\n        var scpt   = document.getElementsByTagName('script')[0];\n        scpt.parentNode.insertBefore(elem, scpt);\n    })();\n\n    var cust = [];\n    if ( typeof tag.customLabels !== 'undefined' ) {\n        var u = tag.customLabels;\n        for ( var i in u ) {\n            if ( u.hasOwnProperty(i) ) {\n                if ( u[i] === 'CUSTOM_SEGMENT' ) {\n                    cust.push('_fp.channel.' + i);\n                }\n                else if ( u[i] === 'VARIABLE' ) {\n                    cust.push('_fp.channel.' + self.getValue(i));\n                }\n            }\n        }\n    }\n    cust.push('_fp.event.' + self.getValue('page.pageInfo.pageName'));\n    cust.push('_fp.pcat.' + self.getValue('page.attributes.eventName').replace(/\\x27/g, '\\\\\\x27'));\n    var labelString = cust.join(', ');\n    if ( self.getValue('transaction.transactionID') ) {\n        _qevents.push({\n                          qacct:   tag.pcode,\n                          labels:  labelString,\n                          orderid: self.getValue('transaction.transactionID'),\n                          revenue: self.getValue('transaction.total.basePrice').toString()\n                      });\n    }\n    else {\n        _qevents.push({\n                          qacct:  tag.pcode,\n                          labels: labelString\n                      });\n    }\n\n};\nVendorService.prototype.rocketfuel = function (tag, index) {\n    var self = this;\n\n//<!-- Begin Rocket Fuel Conversion Action Tracking Code Version 9 -->\n        (function () {\n            var w = window, d = document;\n            var s = d.createElement('script');\n            s.setAttribute('async', 'true');\n            s.setAttribute('type', 'text/javascript');\n            s.setAttribute('src', '//c1.rfihub.net/js/tc.min.js');\n            var f = d.getElementsByTagName('script')[0];\n            f.parentNode.insertBefore(s, f);\n            if (typeof w['_rfi'] !== 'function') {\n                w['_rfi'] = function () {\n                    w['_rfi'].commands = w['_rfi'].commands || [];\n                    w['_rfi'].commands.push(arguments);\n                };\n            }\n                _rfi('setArgs', 'ver', '9');\n                _rfi('setArgs', 'rb', tag.accountId);\n                _rfi('setArgs', 'ca', tag.conversionId);\n                _rfi('track');\n        })();\n\n};\nVendorService.prototype.rubiconConversion = function (tag, index) {\n    var self = this;\n\n    if ( self.getValue('transaction.transactionID') ) {\n        var src = '//as.chango.com/conv/i?' + tag.conversionId + '&cost=' + self.getValue('transaction.total.basePrice') + '&order_id=' + self.getValue('transaction.transactionID') + '&quantity=' + self.getValue('transaction.attributes.ticketQuantity');\n        self.createElem('img', src, tag.id);\n    }\n};\n\nVendorService.prototype.rubiconRetargeting = function (tag, index) {\n    var self = this;\n\n    var src = '//cc.chango.com/c/o?pid=' + tag.segmentId;\n    self.createElem('img', src, tag.id);\n\n};\nVendorService.prototype.sitescout = function (tag, index) {\n    var self = this;\n    var src  = self.getValue('transaction.transactionID') ? '//clickserv.sitescout.com/conv/' + tag.conversionId + '/' + self.getValue('transaction.total.basePrice') : ('//pixel.sitescout.com/iap/' + tag.conversionId);\n\n    self.createElem('img', src, tag.id);\n\n};\nVendorService.prototype.sizmekV2 = function (tag, index) {\n    var self = this;\n\n    //****** Start Sizmek ******//\n    var rnd = Math.random() * 1000000;\n\n    var ep = document.location.protocol + '//bs.serving-sys.com/BurstingPipe/ActivityServer.bs?ifrm=1&cn=as&rnd=' + rnd + '&';\n\n    var standardParams = [\n        ['ProductID', self.getValue('page.attributes.eventID')],\n        ['ProductInfo', self.getValue('page.attributes.eventName').replace(/\\x27/g, '\\\\\\x27')]\n    ];\n\n    var enhancedParams = [\n        ['ArtistID', self.getValue('page.attributes.artistID')],\n        ['ArtistName', self.getValue('page.attributes.artistName')],\n        ['Country', self.getValue('page.attributes.country')],\n        ['EventDate', self.getValue('page.attributes.eventDate')],\n        ['EventState', self.getValue('page.attributes.state')],\n        ['EventTime', self.getValue('page.attributes.eventTime')],\n        ['EventZip', self.getValue('page.attributes.zip')],\n        ['MajorcatID', self.getValue('page.category.primaryCategoryID')],\n        ['MinorcatID', self.getValue('page.category.subCategory1ID')],\n        ['PageName', self.getValue('page.pageInfo.pageName')],\n        ['VenueID', self.getValue('page.attributes.venueID')],\n        ['VenueName', self.getValue('page.attributes.venueName').replace(/\\x27/g, '\\\\\\x27')],\n        ['VenueZip', self.getValue('page.attributes.zip')]\n    ];\n\n    if ( self.getValue('transaction.transactionID') ) {\n\n        var value = parseFloat(self.getValue('transaction.total.basePrice')).toFixed(2);\n        standardParams.push(['OrderID', self.getValue('transaction.transactionID')]);\n        standardParams.push(['Value', value]);\n        standardParams.push(['Quantity', self.getValue('transaction.attributes.ticketQuantity')]);\n\n        var inventoryType = ( parseInt(self.getValue('transaction.attributes.isResale') + 0) !== 0 ) ? 'resale' : 'primary';\n        enhancedParams.push(['InventoryType', inventoryType]);\n        enhancedParams.push(['PurchaseDate', self.getValue('transaction.attributes.orderDate')]);\n        enhancedParams.push(['PurchaseTime', self.getValue('transaction.attributes.orderTime')]);\n\n    }\n\n    var prefixedParams = [],\n        activityId     = typeof tag.activityId !== 'undefined' ? tag.activityId : '00000';\n\n    var prefix = '';\n    if ( typeof tag.prefix !== 'undefined' ) {\n        prefix = tag.prefix;\n    }\n\n    //all tags get the standard params\n    for ( var j = 0; j < standardParams.length; j++ ) {\n        var param = standardParams[j];\n        prefixedParams.push([prefix + param[0], param[1]]);\n    }\n\n    //add extra variables for enhanced tags\n    if ( tag.enhancedData && tag.enhancedData === true ) {\n        for ( var k = 0; k < enhancedParams.length; k++ ) {\n            var param = enhancedParams[k];\n            prefixedParams.push([prefix + param[0], param[1]]);\n        }\n    }\n\n    (function (ep, p, d) {\n\n        var sizmekFrame           = d.createElement('iframe');\n        sizmekFrame.style.cssText = 'width:1px; height:1px; display:none;';\n        var url                   = ep + 'ActivityID=' + activityId + '&';\n        p.forEach(function (item, index) {\n            url += item[0] + '=' + encodeURIComponent(item[1]) + '&';\n        });\n        sizmekFrame.src         = url;\n        sizmekFrame.width       = 0;\n        sizmekFrame.height      = 0;\n        sizmekFrame.frameborder = 0;\n        sizmekFrame.hspace      = 0;\n        sizmekFrame.vspace      = 0;\n        sizmekFrame.scrolling   = 'no';\n        sizmekFrame.title       = 'Advertisement Content';\n        sizmekFrame.bordercolor = '#000000';\n\n        document.body.appendChild(sizmekFrame);\n\n    })(ep, prefixedParams, document);\n\t\n};\nVendorService.prototype.sizmek = function (tag, index) {\n    var self = this;\n\n//****** Start Sizmek ******//\n    var rnd = Math.random() * 1000000;\n\n    var ep     = document.location.protocol\n                 + '//bs.serving-sys.com/BurstingPipe/ActivityServer.bs?ifrm=1&cn=as&rnd=' + rnd + '&',\n        params = [\n            ['ArtistID', self.getValue('page.attributes.artistID')],\n            ['VenueID', self.getValue('page.attributes.venueID')],\n            ['MinorcatID', self.getValue('page.category.subCategory1ID')],\n            ['MajorcatID', self.getValue('page.category.primaryCategoryID')],\n            ['EventID', self.getValue('page.attributes.eventID')],\n            ['EventName', self.getValue('page.attributes.eventName').replace(/\\x27/g, '\\\\\\x27')],\n            ['VenueZip', self.getValue('page.attributes.zip')],\n            ['DmaID', self.getValue('DMA ID')],\n            ['EventTime', self.getValue('page.attributes.eventTime')],\n            ['EventState', self.getValue('page.attributes.state')],\n            ['EventZip', self.getValue('page.attributes.zip')],\n            ['EventDate', self.getValue('page.attributes.eventDate')],\n            ['Country', self.getValue('page.attributes.country')],\n            ['EventTimeZone', ''],\n            ['Promoter', self.getValue('page.pageInfo.promoterID')],\n            ['ProductID', self.getValue('page.attributes.eventID')],\n            ['ProductInfo', self.getValue('page.attributes.eventName').replace(/\\x27/g, '\\\\\\x27')]\n        ];\n\n    if ( self.getValue('transaction.transactionID') ) {\n\n        var value = parseFloat(self.getValue('transaction.total.basePrice')).toFixed(2);\n\n        params.push(['PurchaseTime', self.getValue('transaction.attributes.orderTime')]);\n        params.push(['PurchaseDay', '']);\n        params.push(['PurchaseDate', self.getValue('transaction.attributes.orderDate')]);\n        params.push(['ConfCode',\n                     self.getValue('transaction.transactionID')]);\n        params.push(['OrderID',\n                     self.getValue('transaction.transactionID')]);\n        params.push(['FValue', value]);\n        params.push(['Value', value]);\n        params.push(['TixP', self.getValue('transaction.attributes.ticketQuantity')]);\n        params.push(['Quantity', self.getValue('transaction.attributes.ticketQuantity')]);\n        //todo:fix this for everyone\n        if ( window.tm_omn && window.tm_omn.eVar33 ) {\n            params.push(['TicketType', window.tm_omn.eVar33]);\n        } else {\n            params.push(['TicketType', self.getValue('transaction.attributes.ticketType')]);\n\n        }\n\n        if ( /\\/resale\\/checkout\\/order/.test(document.location.pathname) ) {\n            params.push(['Page', 'checkout_resale']);\n            params.push(['PageName', self.getValue('page.pageInfo.pageName')]);\n        } else {\n            params.push(['PageName', 'confirmation']);\n        }\n    } else {\n        params.push(['PageName', self.getValue('page.pageInfo.pageName')]);\n    }\n    var i = 0;\n\n    var prefixedParams = [],\n        activityId     = typeof tag.activityId !== 'undefined' ? tag.activityId : '00000';\n    if ( typeof tag.prefix !== 'undefined' ) {\n        for ( var j = 0; j < params.length; j++ ) {\n            param = params[j];\n            prefixedParams.push([tag.prefix + param[0], param[1]]);\n        }\n    }\n\n    if ( typeof tag.type.name !== 'undefined' && tag.type.name.indexOf(':Retargeting')\n                                                    !== -1 ) {\n        var url = 'https://bs.serving-sys.com/Serving?CN=ntt&TID=' + activityId\n                  + '&TVAL=z&rnd=' + ebRand;\n        self.ajax(url);\n\n    } else {\n\n        (function (ep, p, d) {\n\n            var sizmekFrame           = d.createElement('iframe');\n            sizmekFrame.style.cssText = 'width:1px; height:1px; display:none;';\n            var url                   = ep + 'ActivityID=' + activityId + '&';\n            p.forEach(function (item, index) {\n                url += item[0] + '=' + encodeURIComponent(item[1]) + '&';\n            });\n            sizmekFrame.src         = url;\n            sizmekFrame.width       = 0;\n            sizmekFrame.height      = 0;\n            sizmekFrame.frameborder = 0;\n            sizmekFrame.hspace      = 0;\n            sizmekFrame.vspace      = 0;\n            sizmekFrame.scrolling   = 'no';\n            sizmekFrame.title       = 'Advertisement Content';\n            sizmekFrame.bordercolor = '#000000';\n\n            document.body.appendChild(sizmekFrame);\n\n        })(ep, prefixedParams.length > 0 ? prefixedParams : params, document);\n    }\n\n//****** End Sizmek ******//\n};\nVendorService.prototype.snap = function (tag, index) {\n    var self = this;\n\n    //load the library in the iFrame\n    var html = '<script>';\n    html += '(function(win, doc, sdk_url){' +\n        'if(win.snaptr) return;' +\n        'var tr=win.snaptr=function(){' +\n        'tr.handleRequest? tr.handleRequest.apply(tr, arguments):tr.queue.push(arguments);' +\n        '};' +\n        'tr.queue = [];v' +\n        'ar s=\\'script\\';' +\n        'var new_script_section=doc.createElement(s);' +\n        'new_script_section.async=!0;' +\n        'new_script_section.src=sdk_url;' +\n        'var insert_pos=doc.getElementsByTagName(s)[0];' +\n        'insert_pos.parentNode.insertBefore(new_script_section, insert_pos);})' +\n        '(window, document, \\'https://sc-static.net/scevent.min.js\\');';\n    html += 'snaptr(\\'init\\',\\'' + tag.pixelId + '\\');';\n    html += 'snaptr(\\'track\\',\\'PAGE_VIEW\\');';\n\n    if ( self.getValue('transaction.transactionID', self.config.data) ) {\n        html += 'snaptr(\\'track\\',\\'PURCHASE\\',  {';\n        html += '\\'currency\\':\\'' + self.getValue('transaction.total.currency') + '\\',';\n        html += '\\'price\\':' + self.toFloat(self.getValue('transaction.total.basePrice') , 0) + ',';\n        html += '\\'number_items\\':\\'' + self.getValue('transaction.attributes.ticketQuantity', self.config.data) + '\\',';\n        html += '\\'transaction_id\\':\\'' + self.getValue('transaction.transactionID', self.config.data) + '\\'';\n        html += '});';\n    }\n\n    html+= '</script>';\n\n    self.createIframeWithContent(tag.id, html, function () {\n        self.log('Iframe added for pixel: ' + tag.id);\n    });\n}\n\nVendorService.prototype.sportsDesk = function (tag, index) {\n    var self = this;\n\n    var img = document.createElement('script');\n    img.src = '//secfld.vmmpxl.com/?bkt=' + tag.pixelId;\n\n    if ( typeof tag.customVariables !== 'undefined' ) {\n        var u = tag.customVariables;\n        for ( var i in u ) {\n            if ( u.hasOwnProperty(i) ) {\n                img.src += '&' + i + '=' + self.getValue(u[i]);\n            }\n        }\n    }\n    document.body.appendChild(img);\n};\n\nVendorService.prototype.theTradeDeskUniversal = function (tag, index) {\n    var self = this;\n\n    //load the library in the iFrame\n    var html = '<script src=\"https://js.adsrvr.org/up_loader.1.1.0.js\"></script>';\n    html += '<script>';\n    html += 'var dynParam = {};';\n\n    if ( self.getValue('transaction.transactionID', self.config.data) ) {\n        html += 'dynParam.orderid = \\'' + self.getValue('transaction.transactionID', self.config.data) + '\\';';\n        html += 'dynParam.v = \\'' + self.toFloat(self.getValue('transaction.total.basePrice') , 0) + '\\';';\n        html += 'dynParam.vf = \\'' + self.getValue('transaction.total.currency') + '\\';';\n    }\n\n    if (typeof tag.customVariables !== 'undefined') {\n        var u = tag.customVariables;\n        for (var i in u) {\n            if (u.hasOwnProperty(i)) {\n                html += 'dynParam.' + i + ' = \\'' + self.getValue(u[i], self.config.data) + '\\';';\n            }\n        }\n    }\n\n    html += 'ttd_dom_ready( function() {';\n    html += 'if (typeof TTDUniversalPixelApi === \\'function\\') {';\n    html += 'var universalPixelApi = new TTDUniversalPixelApi();';\n    html += 'universalPixelApi.init(\"' + tag.advertiserId + '\", [\"' + tag.tagId + '\"], \"https://insight.adsrvr.org/track/up\", dynParam);';\n    html += '}';\n    html += '});';\n\n    html+= '</script>';\n\n    self.createIframeWithContent(tag.id, html, function () {\n        self.log('Iframe added for pixel: ' + tag.id);\n    });\n}\n\nVendorService.prototype.theTradeDesk = function(tag, index) {\n\tvar self = this;\n\n\t\tvar src = '//insight.adsrvr.org/track/evnt/?adv=' + tag.advertiserId + '&ct=' + tag.contentId + '&fmt=3';\n\n\t\tif ( self.getValue('transaction.transactionID') ) {\n\t\t\tsrc = '//insight.adsrvr.org/track/conv/?adv=' + tag.advertiserId + '&ct=' + tag.contentId + '&fmt=3';\n\t\t\tsrc = src + '&v=' + self.getValue('transaction.total.basePrice') + '&vf=' + self.getValue('transaction.total.currency') + '&orderid=' + self.getValue('transaction.transactionID');\n\t\t}\n\n\t\tif ( typeof tag.customVariables !== 'undefined' ) {\n\t\t\tvar u = tag.customVariables;\n\t\t\tfor ( var j in u ) {\n\t\t\t\tif ( u.hasOwnProperty(j) ) {\n\t\t\t\t\tsrc += '&' + j + '=' + self.getValue(u[ j ], self.config.data);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tself.createElem('img', src, tag.id);\n};\nVendorService.prototype.tiktok = function (tag, index) {\n    var self = this;\n\n    if (isPixelIdValid(tag)) {\n        var html = self.generateTiktokHtmlScriptTag(tag);\n        self.createIframeWithContent(tag.id, html, function () {\n            self.log('Iframe added for pixel: ' + tag.id);\n        });\n    } else {\n        self.log('Invalid TikTok ID: ' + tag.pixelId);\n    }\n};\n\nvar isPixelIdValid =  function(tag) {\n    return !!tag.pixelId;\n}\n\nVendorService.prototype.twitterUniversal = function (tag, index) {\n    var self = this;\n    \n    !function (e, t, n, s, u, a) {\n        e.twq || (s = e.twq = function () {\n            s.exe ? s.exe.apply(s, arguments) : s.queue.push(arguments);\n        }, s.version = '1.1', s.queue = [], u = t.createElement(n), u.async = !0, u.src = '//static.ads-twitter.com/uwt.js',\n            a = t.getElementsByTagName(n)[0], a.parentNode.insertBefore(u, a))\n    }(window, document, 'script');\n\n\n    twq('init', tag.pid);\n\n    if ( self.getValue('transaction.transactionID') ) {\n        twq('track', 'Purchase',\n            //Note, all values sent as strings in single quotes)\n            {\n                value:        self.getValue('transaction.total.basePrice').toString(),\n                currency:     self.getValue('transaction.total.currency'),\n                order_id:     self.getValue('transaction.transactionID'),\n                content_type: 'tickets',\n                content_ids:  [self.getValue('page.attributes.eventID')],\n                content_name: self.getValue('page.attributes.eventName').replace(/\\x27/g, '\\\\\\x27'),\n                num_items:    self.getValue('transaction.attributes.ticketQuantity').toString()\n            }\n        );\n    } else {\n        twq('track', 'PageView');\n    }\n};\nVendorService.prototype.twitter = function (tag, index) {\n    var self = this;\n//****** Twitter ******//\n    (function (w, d, t, u, f, c) {\n        if(f){\n            c();\n            return;\n        }\n        var x = false,\n        p, s = d.createElement('script');\n        s.type = 'text/javascript';\n        s.src = u;\n        s.async = 1;\n        s.onload = s.onreadystatechange = function () {\n            if (!x && (!this.readyState || this.readyState === 'complete')) {\n                x = true;\n                self.twitterLoaded = true;\n                c();\n            }\n        };\n        p = d.getElementsByTagName(t)[0];\n        p.parentNode.insertBefore(s, p);\n    })(window, document, 'script', '//platform.twitter.com/oct.js', self.twitterLoaded, function () {\n        var conversion = {};\n        if (self.getValue('transaction.transactionID')) {\n            conversion.tw_sale_amount = self.getValue('transaction.total.basePrice');\n            conversion.tw_order_quantity =\n                self.getValue('transaction.attributes.ticketQuantity');\n        }\n        window.twttr.conversion.trackPid(tag.pid, conversion);\n\n    });\n\n//****** End Twitter ******//\n};\nVendorService.prototype.verizonMediaOauth = function (tag, index) {\n    var self = this;\n\n    //load the library in the iFrame\n    var html = '<script>';\n    html += '(function(w,d,t,r,u){w[u]=w[u]||[];w[u].push(\\n' +\n        '{projectId:\"' + tag.projectId + '\",properties:{pixelId:\"' + tag.pixelId + '\"}});\\n' +\n        'var s=d.createElement(t);s.src=r;s.async=true;s.onload=\\n' +\n        's.onreadystatechange=function(){var y,rs=this.readyState,c=w[u];\\n' +\n        'if(rs&&rs!=\"complete\"&&rs!=\"loaded\"){return}try{y=YAHOO.ywa.I13N.fireBeacon;\\n' +\n        'w[u]=[];w[u].push=function(p){y([p])};y(c)}catch(e){}};\\n' +\n        'var scr=d.getElementsByTagName(t)[0],par=scr.parentNode;par.insertBefore(s,scr)})(window,document,\"script\",\"https://s.yimg.com/wi/ytc.js\",\"dotq\"); ';\n\n    if ( self.getValue('transaction.transactionID', self.config.data) ) {\n        html += 'window.dotq = window.dotq || [];window.dotq.push({ \\'gv\\': ' + self.toFloat(self.getValue('transaction.total.basePrice') , 0) + ' });';\n    }\n\n    html+= '</script>';\n\n    self.createIframeWithContent(tag.id, html, function () {\n        self.log('Iframe added for pixel: ' + tag.id);\n    });\n}\n\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJidWlsZC9pbmRleC5qcyIsImJ1aWxkL2xpYi9UbVBpeGVsLmpzIiwiYnVpbGQvbGliL1ZlbmRvclNlcnZpY2UuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcFNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGJyZXR0LmhhbGUgb24gOS85LzE1LlxuICovXG4vL29wdGlvbnM6XG4vLyBkYXRhTGF5ZXI6cmVmZXJlbmNlIHRvIGRhdGFMYXllciBkZWZhdWx0cyB0byBkaWdpdGFsRGF0YVxuLy8gZW52aXJvbm1lbnQ6IGFrYW1haSBlbnYgdG8gdXNlIFtsb2NhbCxkZXYscWEscHJvZF1cbi8vIGdldFZhcjogcmVmZXJlbmNlIHRvIGdldFZhciBmdW5jdGlvblxuLy8gcnVsZXM6IGFycmF5IG9mIHJ1bGVzIHRvIGZvcm11bGF0ZSB0aGUgZW5kcG9pbnRcbi8vIFt7dGVzdFJlZ2V4Oi9yZWdleC8sdGVzdEZpZWxkOidwYWdlTmFtZScsdXJsVGVtcGxhdGU6JzwlYmFzZVVybCU+LzwlZW52aXJvbm1lbnQlPi9ldmVudC9lXzwlZGF0YS5ldmVudElEJT4nfV1cbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi9saWIvVmVuZG9yU2VydmljZScpO1xuIiwiLy8qKioqKiogVE0gUGl4ZWwgKioqKioqLy9cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKHNjb3BlKSB7XG5cbiAgICB2YXIgc2V0dGluZ3MgPSBzY29wZS5jb25maWcuZGl2b2x0ZTtcbiAgICB2YXIgcGFyYW1zID0ge307XG4gICAgdmFyIGNhbGxiYWNrcyA9IFtmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNjb3BlLmxvZygnRGl2b2x0ZSBMaWJyYXJ5IExvYWRlZCcpXG4gICAgfV07XG5cbiAgICBpZiAodHlwZW9mIHNldHRpbmdzLm9uTG9hZCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBjYWxsYmFja3MucHVzaChzZXR0aW5ncy5vbkxvYWQpO1xuICAgIH1cblxuICAgIHZhciB1cmwgPSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCArIChzZXR0aW5ncy5pc1N0YWdpbmcgPyAnLy9kLnQteC5pby9kaXZvbHRlLmpzJyA6ICcvL2QudC14LmlvL2Rpdm9sdGUuanMnKTtcblxuICAgIHNjb3BlLmxvZygnTG9hZGluZyBEaXZvbHRlIExpYnJhcnknKTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93LnJlcXVpcmVqcyAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHdpbmRvdy5yZXF1aXJlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHdpbmRvdy5yZXF1aXJlLmNvbmZpZyh7c2hpbTp7ZGl2b2x0ZTp7ZXhwb3J0czonZGl2b2x0ZSd9fSxwYXRoczp7ZGl2b2x0ZTogc2V0dGluZ3MudXJsfX0pO1xuICAgICAgICBzY29wZS5sb2coJ3JlcXVpcmVqcyBsb2FkaW5nLi4uJywgJ0Rpdm9sdGU6Jyk7XG4gICAgICAgIHdpbmRvdy5yZXF1aXJlKFsnZGl2b2x0ZSddLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgd2luZG93LmRpdm9sdGUgPSBkO1xuICAgICAgICAgICAgc2NvcGUubG9nKCdyZXF1aXJlanMgZmluaXNoZWQgbG9hZGluZy4nLCAnRGl2b2x0ZTonKTtcbiAgICAgICAgICAgIGhhbmRsZUxpYkxvYWQoZCk7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGxvYWRTY3JpcHQoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0b0FycmF5ICh0YXJnZXQpIHtcblxuICAgICAgICBpZiAodHlwZW9mIHRhcmdldCA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIHRhcmdldC5wdXNoID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0YXJnZXQgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICByZXR1cm4gW3RhcmdldF07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIHRhcmdldCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiB0YXJnZXQuc3BsaXQoJywnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2VuZCBiZWNvbWVzIFRNUGl4ZWwucHVzaFxuICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2VuZCAoZGF0YSkge1xuICAgICAgICBzY29wZS5sb2coJ1NlbmRpbmcgY2FsbGVkOicgKyBkYXRhLmV2ZW50ICsgJyAtLSAnICsgSlNPTi5zdHJpbmdpZnkoZGF0YS5kYXRhKSwgJ0Rpdm9sdGU6ICcpO1xuICAgICAgICB2YXIgZGl2b2x0ZSA9IHdpbmRvd1snZGl2b2x0ZSddIHx8IHdpbmRvd1snbW9kdWxlJ10gJiYgd2luZG93Wydtb2R1bGUnXVsnZXhwb3J0cyddO1xuICAgICAgICBpZiAoZGl2b2x0ZSAmJiBkaXZvbHRlLnNpZ25hbCkge1xuICAgICAgICAgICAgdmFyIHRvcGljcyA9IFtdO1xuICAgICAgICAgICAgaWYgKHNldHRpbmdzLnRvcGljcykgdG9waWNzID0gdG9BcnJheShzZXR0aW5ncy50b3BpY3MpO1xuXG4gICAgICAgICAgICBpZiAoZGF0YS5kYXRhLnRvcGljcykge1xuICAgICAgICAgICAgICAgIGRhdGEuZGF0YS50b3BpY3MgPSB0b0FycmF5KGRhdGEuZGF0YS50b3BpY3MpLmNvbmNhdCh0b3BpY3MpO1xuICAgICAgICAgICAgICAgIGRhdGEuZGF0YS50b3BpY3MgPSBzY29wZS51bmlxKGRhdGEuZGF0YS50b3BpY3MpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkYXRhLmRhdGEudG9waWNzID0gdG9waWNzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEluY2x1ZGUgYWxsIHBhcmFtcyBmcm9tIHBhZ2UgbG9hZCBjYWxsXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGlmIChkYXRhLnNlbmRBbGwpIHtcbiAgICAgICAgICAgICAgICBkYXRhLmRhdGEgPSBzY29wZS5tZXJnZShwYXJhbXMsIGRhdGEuZGF0YSk7XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgc2NvcGUubG9nKCdTZW5kaW5nIHdpdGggcGFyYW1zOicgKyBkYXRhLmV2ZW50ICsgJyAtLSAnICsgSlNPTi5zdHJpbmdpZnkoZGF0YS5kYXRhKSwgJ0Rpdm9sdGU6ICcpO1xuXG4gICAgICAgICAgICBpZihzZXR0aW5ncy5zdXBwcmVzc0NhbGwpIHJldHVybjtcblxuICAgICAgICAgICAgZGl2b2x0ZS5zaWduYWwoZGF0YS5ldmVudCwgZGF0YS5kYXRhKTtcbiAgICAgICAgICAgIHNjb3BlLmxvZygnU2VudCBTdWNjZXNzZnVsbHknLCAnRGl2b2x0ZTogJyk7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNjb3BlLmxvZygnRVJST1I6IERpdm9sdGUgZGlkIG5vdCBsb2FkJywgJ0Rpdm9sdGU6ICcpO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbGVhclF1ZXVlICgpIHtcbiAgICAgICAgc2NvcGUubG9nKCdDbGVhcmluZyBRdWV1ZSB7d2luZG93LlRtUGl4ZWx9JywgJ0Rpdm9sdGU6ICcpO1xuICAgICAgICB2YXIgcXVldWUgPSB3aW5kb3cuVG1QaXhlbCB8fCBbXTtcbiAgICAgICAgaWYgKHF1ZXVlICYmIHF1ZXVlLmxlbmd0aD4wKSB7XG4gICAgICAgICAgICBxdWV1ZS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLGluZGV4KSB7XG4gICAgICAgICAgICAgICAgc2VuZChpdGVtKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgd2luZG93LlRtUGl4ZWwgPSB7cHVzaDpzZW5kfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBZb3Ugc2hvdWxkIG1ha2UgYWxsIG5lY2Vzc2FyeSBjaGFuZ2UgdG8gb3ZlcnJpZGVzIGFuZCBzZXR0aW5ncyBiZWZvcmUgY2FsbGluZyBzY29wZS5cbiAgICAgKi9cbiAgICBzY29wZS50cmFja1BhZ2VWaWV3ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBzZXR0aW5ncyA9IHNjb3BlLmNvbmZpZy5kaXZvbHRlO1xuICAgICAgICBwYXJhbXMgPSB7fTtcbiAgICAgICAgYnVpbGREYXRhKHBhcmFtcyk7XG4gICAgICAgIHNjb3BlLmxvZygnVHJhY2tQYWdlVmlldyAtIE1lcmdlZCBTZXR0aW5nczogJyArIEpTT04uc3RyaW5naWZ5KHNldHRpbmdzKSwgJ0Rpdm9sdGU6ICcpO1xuICAgICAgICBzZW5kKHtldmVudDoncGFnZV9sb2FkJywgZGF0YTpwYXJhbXN9KTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gaGFuZGxlTGliTG9hZCAoKSB7XG4gICAgICAgIGNhbGxiYWNrcy5mb3JFYWNoKGZ1bmN0aW9uIChvbmxvYWRDYWxsYmFjaykge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBvbmxvYWRDYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuXG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgb25sb2FkQ2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmxvZygnQ2FsbGJhY2sgRXJyb3IgJyArIGUubWVzc2FnZSwgJ0Rpdm9sdGU6ICcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgeCA9IHRydWU7XG4gICAgICAgIGlmIChzZXR0aW5ncy5hdXRvVHJhY2sgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBzY29wZS5sb2coJ01hbnVhbCBUcmFja2luZyBSZXF1aXJlZCAtIFF1ZXVlIGlnbm9yZWQnLCAnRGl2b2x0ZTogJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLmF1dG9UcmFjayA9PT0gJ3VuZGVmaW5lZCcgfHwgc2V0dGluZ3MuYXV0b1RyYWNrID09PSB0cnVlIHx8IHNldHRpbmdzLmF1dG9UcmFjayA9PT0gJ2V2ZW50cycpIHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQXV0b1RyYWNrIHBhZ2UgdmlldyBvbmx5IHdoZW4gdW5kZWZpbmVkIChtaW1pYyBkZWZhdWx0IHRydWUgYmVoYXZpb3IpIG9yIGV4cGxpY2l0bHkgc2V0IHRvIHRydWVcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgaWYgKHNldHRpbmdzLmF1dG9UcmFjayAhPT0gJ2V2ZW50cycpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5sb2coJ0F1dG9UcmFjayBFbmFibGVkIC0gU2VuZGluZyBJbml0aWFsIFBhZ2VWaWV3JywgJ0Rpdm9sdGU6ICcpO1xuICAgICAgICAgICAgICAgIHNjb3BlLnRyYWNrUGFnZVZpZXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYnVpbGREYXRhKHBhcmFtcyk7XG4gICAgICAgICAgICAgICAgc2NvcGUubG9nKCdBdXRvVHJhY2sgRXZlbnRzIE9ubHkgLSBObyBQYWdlVHJhY2sgU2VudCcsICdEaXZvbHRlOiAnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQWxsIG9mIHRoZXNlIGNhc2VzIHdlIHdhbnQgdG8gY2xlYXIgdGhlIHF1ZXVlLlxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBjbGVhclF1ZXVlKCk7XG5cbiAgICAgICAgfSBlbHNlIGlmIChzZXR0aW5ncy5hdXRvVHJhY2sgPT09IGZhbHNlKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLnRyYWNrRXZlbnQgPSBzZW5kO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzY29wZS5sb2coJ0Vycm9yIGNvbmZpZ3VyaW5nIGF1dG9UcmFjayBzZXR0aW5nLCBhY2NwdGFibGUgdmFsdWVzIGFyZSBbdHJ1ZSwgZmFsc2UsIFxcJ2V2ZW50c1xcJ10nKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbG9hZFNjcmlwdCgpIHtcblxuICAgICAgICBzY29wZS5sb2coJ0xvYWRpbmcgRGl2b2x0ZSBTY3JpcHQnLCAnRGl2b2x0ZTogJyk7XG4gICAgICAgIHZhciB4ID0gZmFsc2UsXG4gICAgICAgICAgICBwLCBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAgICAgIHMudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnO1xuICAgICAgICBzLmFzeW5jID0gMTtcbiAgICAgICAgcy5zcmMgPSB1cmw7XG4gICAgICAgIHMub25sb2FkID0gcy5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzY29wZS5sb2coJ0ZpbmlzaGVkIExvYWRpbmcgRGl2b2x0ZSBTY3JpcHQnLCAnRGl2b2x0ZTogJyk7XG4gICAgICAgICAgICBpZiAoIXggJiYgKCF0aGlzLnJlYWR5U3RhdGUgfHwgdGhpcy5yZWFkeVN0YXRlID09ICdjb21wbGV0ZScpKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlTGliTG9hZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBwID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdO1xuICAgICAgICBwLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHMsIHApO1xuXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZXh0cmFjdERvbWFpbk5hbWUgKHBhZ2VOYW1lKSB7XG4gICAgICAgIHJldHVybiBwYWdlTmFtZS5yZXBsYWNlKC9cXDouKiQvZywnJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY29sbGVjdERhdGEobWFwLCBwYXJhbXMpIHtcblxuICAgICAgICB2YXIgdmFsdWUgPSBudWxsO1xuXG4gICAgICAgIGlmIChtYXAuZGF0YSkge1xuICAgICAgICAgICAgLy8gY2hlY2sgaWYgbmVzdGVkIHNjaGVtYSBleGlzdHMgYW5kIGNvbGxlY3QgZGF0YSByZWN1cnNpdmVseVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBtYXAuZGF0YSA9PT0gJ29iamVjdCcpIHtcblxuICAgICAgICAgICAgICAgIHZhciBuZXN0ZWRQYXJhbXMgPSB7fTtcbiAgICAgICAgICAgICAgICBtYXAuZGF0YS5mb3JFYWNoICYmIG1hcC5kYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbGxlY3REYXRhKGl0ZW0sIG5lc3RlZFBhcmFtcyk7XG5cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhuZXN0ZWRQYXJhbXMpLmxlbmd0aCA+IDEpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG1hcC50cmFuc2Zvcm0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5lc3RlZFBhcmFtcyA9IG1hcC50cmFuc2Zvcm0obmVzdGVkUGFyYW1zKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc1ttYXAua2V5XSA9IG5lc3RlZFBhcmFtcztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBzY29wZS5nZXRWYWx1ZShtYXAuZGF0YSwgbWFwLmRhdGFPYmopO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSAnJykge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWFwLnRyYW5zZm9ybSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBtYXAudHJhbnNmb3JtKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zW21hcC5rZXldID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVud3JhcFF1ZXJ5KHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZS5qb2luKCcsJyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHR5cGUgeypbXX1cbiAgICAgKiBrZXk6IG1hcHMgdG8gZGl2b2x0ZSBzY2hlbWFcbiAgICAgKiBkYXRhOiB3aGF0IHRvIGxvb2sgZm9yIGluIGRpZ2l0YWxEYXRhIG9yIGRhdGFPYmogaWYgcHJvdmlkZWRcbiAgICAgKiBkYXRhT2JqOiBvcHRpb25hbCAtIGlmIG5vdCBkaWdpdGFsRGF0YSB3aGVyZSB0byBsb29rIGZvciB0aGUgZGF0YSBuZWVkZWRcbiAgICAgKlxuICAgICAqIHRvZG86IGFkZCB0eXBlIHZhbGlkYXRpb24gZm9yIGRpdm9sdGUgc2NoZW1hXG4gICAgICovXG4gICAgc2NvcGUuc2NoZW1hID0gW1xuICAgICAgICB7a2V5Oidicm93c2VySWQnLGRhdGE6J0JJRCcsIGRhdGFPYmo6IHNjb3BlLmNvb2tpZXN9LFxuICAgICAgICB7a2V5OidtZW1iZXJJZCcsZGF0YTonTUlEJywgZGF0YU9iajogc2NvcGUuY29va2llc30sXG4gICAgICAgIHtrZXk6J21hcmtldElkJyxkYXRhOidNQVJLRVRfSUQnLCBkYXRhT2JqOiBzY29wZS5jb29raWVzfSxcbiAgICAgICAge2tleTonc2Vzc2lvbklkJyxkYXRhOidTSUQnLCBkYXRhT2JqOiBzY29wZS5jb29raWVzfSxcbiAgICAgICAge2tleTonc2Vzc2lvbklkVE0nLGRhdGE6J1RNU0lEJywgZGF0YU9iajogc2NvcGUuY29va2llc30sXG4gICAgICAgIHtrZXk6J3BhZ2VUeXBlJyxkYXRhOidwYWdlLnBhZ2VJbmZvLnBhZ2VUeXBlJ30sXG4gICAgICAgIHtrZXk6J3BhZ2VOYW1lJyxkYXRhOidwYWdlLnBhZ2VJbmZvLnBhZ2VOYW1lJ30sXG4gICAgICAgIHtrZXk6J2RvbWFpbicsZGF0YToncGFnZS5wYWdlSW5mby5wYWdlTmFtZScsIHRyYW5zZm9ybTogZXh0cmFjdERvbWFpbk5hbWV9LFxuICAgICAgICB7a2V5OidldmVudElkJyxkYXRhOidwYWdlLmF0dHJpYnV0ZXMuZXZlbnRJRCd9LFxuICAgICAgICB7a2V5OidldmVudERhdGUnLGRhdGE6J3BhZ2UuYXR0cmlidXRlcy5ldmVudERhdGUnfSxcbiAgICAgICAge2tleTonbWFqb3JDYXRlZ29yeUlkJyxkYXRhOidwYWdlLmF0dHJpYnV0ZXMucHJpbWFyeUNhdGVnb3J5SUQnfSxcbiAgICAgICAge2tleTonbWlub3JDYXRlZ29yeUlkJyxkYXRhOidwYWdlLmF0dHJpYnV0ZXMuc2Vjb25kYXJ5Q2F0ZWdvcnlJRCd9LFxuICAgICAgICB7a2V5OidhcnRpc3RJZCcsZGF0YToncGFnZS5hdHRyaWJ1dGVzLmFydGlzdElEJ30sXG4gICAgICAgIHtrZXk6J29yZGVyVGlja2V0UXVhbnRpdHknLGRhdGE6J3RyYW5zYWN0aW9uLmF0dHJpYnV0ZXMudGlja2V0UXVhbnRpdHknfSxcbiAgICAgICAge2tleTonb3JkZXJUb3RhbCcsZGF0YTondHJhbnNhY3Rpb24udG90YWwudHJhbnNhY3Rpb25Ub3RhbCd9LFxuICAgICAgICB7a2V5OidvcmRlcklkJyxkYXRhOid0cmFuc2FjdGlvbi50cmFuc2FjdGlvbklEJ30sXG4gICAgICAgIHtrZXk6J29yZGVyQ29uZmlybWF0aW9uQ29kZScsZGF0YTonJ30sXG4gICAgICAgIHtrZXk6J29yZGVyRmFjZVZhbHVlVG90YWwnLGRhdGE6J3RyYW5zYWN0aW9uLnRvdGFsLmJhc2VQcmljZSd9LFxuICAgICAgICB7a2V5OidvcmRlckZlZVRvdGFsJyxkYXRhOid0cmFuc2FjdGlvbi50b3RhbC5mZWVzVG90YWwnfSxcbiAgICAgICAge2tleTonc2VhcmNoUXVlcnknLGRhdGE6J3BhZ2UucGFnZUluZm8ub25zaXRlU2VhcmNoVGVybSd9LFxuICAgICAgICB7a2V5OidzZWFyY2hQYWdlTnVtYmVyJyxkYXRhOicnfSxcbiAgICAgICAge2tleTondG1MaW5rJyxkYXRhOid0bUxpbmsnLGRhdGFPYmo6c2NvcGUudXJsUGFyYW1zLCB0cmFuc2Zvcm06IHVud3JhcFF1ZXJ5fSxcbiAgICAgICAge2tleTonbWFqb3JDYXRlZ29yeUlkJywgZGF0YToncGFnZS5jYXRlZ29yeS5wcmltYXJ5Q2F0ZWdvcnlJRCd9LFxuICAgICAgICB7a2V5OidtaW5vckNhdGVnb3J5SWQnLCBkYXRhOidwYWdlLmNhdGVnb3J5LnN1YkNhdGVnb3J5MUlEJ30sXG4gICAgICAgIHtrZXk6J2ZhbmJ1aWxkZXInLCB0cmFuc2Zvcm06IHRvQXJyYXksIGRhdGE6IFtcbiAgICAgICAgICAgIHtrZXk6ICd1c2VySWQnLCBkYXRhOiAnbWNfZWlkJywgZGF0YU9iajogc2NvcGUudXJsUGFyYW1zLCB0cmFuc2Zvcm06IHVud3JhcFF1ZXJ5fSxcbiAgICAgICAgICAgIHtrZXk6ICdjYW1wYWlnbklkJywgZGF0YTogJ21jX2NpZCcsIGRhdGFPYmo6IHNjb3BlLnVybFBhcmFtcywgdHJhbnNmb3JtOiB1bndyYXBRdWVyeX0sXG4gICAgICAgICAgICB7a2V5OiAncHJvdmlkZXInLCBkYXRhOiAnbWNfY2lkJywgZGF0YU9iajogc2NvcGUudXJsUGFyYW1zLCB0cmFuc2Zvcm06IChmdW5jdGlvbih2YWx1ZSl7cmV0dXJuIHZhbHVlWzBdICYmICdNQUlMQ0hJTVAnIHx8IG51bGw7fSl9XG4gICAgICAgIF19LFxuICAgICAgICB7a2V5Oid1dG0nLCB0cmFuc2Zvcm06IHRvQXJyYXksIGRhdGE6IFtcbiAgICAgICAgICAgIHtrZXk6J3NvdXJjZScsIGRhdGE6ICd1dG1fc291cmNlJywgZGF0YU9iajogc2NvcGUudXJsUGFyYW1zLCB0cmFuc2Zvcm06IHVud3JhcFF1ZXJ5fSxcbiAgICAgICAgICAgIHtrZXk6J21lZGl1bScsIGRhdGE6ICd1dG1fbWVkaXVtJywgZGF0YU9iajogc2NvcGUudXJsUGFyYW1zLCB0cmFuc2Zvcm06IHVud3JhcFF1ZXJ5fSxcbiAgICAgICAgICAgIHtrZXk6J3Rlcm0nLCBkYXRhOiAndXRtX3Rlcm0nLCBkYXRhT2JqOiBzY29wZS51cmxQYXJhbXMsIHRyYW5zZm9ybTogdW53cmFwUXVlcnl9LFxuICAgICAgICAgICAge2tleTonY29udGVudCcsIGRhdGE6ICd1dG1fY29udGVudCcsIGRhdGFPYmo6IHNjb3BlLnVybFBhcmFtcywgdHJhbnNmb3JtOiB1bndyYXBRdWVyeX0sXG4gICAgICAgICAgICB7a2V5OidjYW1wYWlnbicsIGRhdGE6ICd1dG1fY2FtcGFpZ24nLCBkYXRhT2JqOiBzY29wZS51cmxQYXJhbXMsIHRyYW5zZm9ybTogdW53cmFwUXVlcnl9XG4gICAgICAgIF19LFxuICAgICAgICB7a2V5OidjZmMnLCBkYXRhOidjZmMnfVxuICAgIF07XG5cbiAgICBmdW5jdGlvbiBidWlsZERhdGEgKHBhcmFtcykge1xuICAgICAgICBzY29wZS5sb2coJ0J1aWxkaW5nIERhdGEnLCAnRGl2b2x0ZTogJyk7XG4gICAgICAgIGlmIChzZXR0aW5ncy5pc1N0YWdpbmcpIHtcbiAgICAgICAgICAgIHBhcmFtcy5pc1N0YWdpbmdFbnZpcm9ubWVudCA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc2NoZW1hID0gc2NvcGUuc2NoZW1hO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGlzIGFsbG93cyBpbXBsZW1lbnRvcnMgdG8gZXh0ZW5kIHRoZSBzY2hlbWEgd2l0aG91dCByZWxlYXNpbmcgZmFuYnVpbGRlci5qc1xuICAgICAgICAgKi9cbiAgICAgICAgaWYoc2V0dGluZ3MuYWRkaXRpb25hbFBhZ2VMb2FkUGFyYW1zKXtcbiAgICAgICAgICAgIHNjaGVtYSA9IHNjaGVtYS5jb25jYXQoc2V0dGluZ3MuYWRkaXRpb25hbFBhZ2VMb2FkUGFyYW1zKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpPHNjaGVtYS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29sbGVjdERhdGEoc2NoZW1hW2ldLCBwYXJhbXMpO1xuICAgICAgICB9XG4gICAgICAgIHNjb3BlLmxvZygnUGFyYW1zOiAnICsgSlNPTi5zdHJpbmdpZnkocGFyYW1zKSwgJ0Rpdm9sdGU6ICcpO1xuXG5cbiAgICB9XG5cbn07XG4vLyoqKioqKiBFbmQgVE0gUGl4ZWwgKioqKioqLy9cbiIsInZhciBUbVBpeGVsID0gcmVxdWlyZSgnLi9UbVBpeGVsJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gVmVuZG9yU2VydmljZTtcblxuZnVuY3Rpb24gVmVuZG9yU2VydmljZShvcHRpb25zLCBvdmVycmlkZXMpIHtcbiAgICBjb25zdCBodG1sU2luZ2xlUXVvdGUgPSAnXFxcXFxceDI3JztcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICBzZWxmLmNvb2tpZXMgICA9IHNlbGYucmVhZEFsbENvb2tpZXMoKTtcbiAgICBzZWxmLnVybFBhcmFtcyA9IHNlbGYuZ2V0VXJsUGFyYW1zKCk7XG4gICAgc2VsZi5zdG9yZU1hcCAgPSB7XG4gICAgICAgIGJhc2VQcmljZTogICAgICAgICd0cmFuc2FjdGlvbi50b3RhbC5iYXNlUHJpY2UnLFxuICAgICAgICB0cmFuc2FjdGlvbklEOiAgICAndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcsXG4gICAgICAgIHRpY2tldFF1YW50aXR5OiAgICd0cmFuc2FjdGlvbi5hdHRyaWJ1dGVzLnRpY2tldFF1YW50aXR5JyxcbiAgICAgICAgb3JkZXJJRDogICAgICAgICAgJycsXG4gICAgICAgIGNvbmZpcm1hdGlvbklEOiAgICcnLFxuICAgICAgICBvcmRlckRhdGU6ICAgICAgICAnJyxcbiAgICAgICAgb3JkZXJUaW1lOiAgICAgICAgJycsXG4gICAgICAgIHRpY2tldFR5cGU6ICAgICAgICd0cmFuc2FjdGlvbi5hdHRyaWJ1dGVzLnRpY2tldFR5cGUnLFxuICAgICAgICBwYWdlTmFtZTogICAgICAgICAncGFnZS5wYWdlSW5mby5wYWdlTmFtZScsXG4gICAgICAgIHByb21vdGVySUQ6ICAgICAgICdwYWdlLnBhZ2VJbmZvLnByb21vdGVySUQnLFxuICAgICAgICBzdGF0ZTogICAgICAgICAgICAncGFnZS5hdHRyaWJ1dGVzLnN0YXRlJyxcbiAgICAgICAgemlwOiAgICAgICAgICAgICAgJ3BhZ2UuYXR0cmlidXRlcy56aXAnLFxuICAgICAgICBjb3VudHJ5OiAgICAgICAgICAncGFnZS5hdHRyaWJ1dGVzLmNvdW50cnknLFxuICAgICAgICB2YWx1ZTogICAgICAgICAgICAndHJhbnNhY3Rpb24ucHJvZmlsZS5hZGRyZXNzLnN0YXRlUHJvdmluY2UnLFxuICAgICAgICBiaWxsaW5nWmlwOiAgICAgICAndHJhbnNhY3Rpb24ucHJvZmlsZS5hZGRyZXNzLnBvc3RhbENvZGUnLFxuICAgICAgICBiaWxsaW5nU3RhdGU6ICAgICAndHJhbnNhY3Rpb24ucHJvZmlsZS5hZGRyZXNzLnN0YXRlUHJvdmluY2UnLFxuICAgICAgICBiaWxsaW5nQ291bnRyeTogICAndHJhbnNhY3Rpb24ucHJvZmlsZS5hZGRyZXNzLmNvdW50cnknLFxuICAgICAgICBkbWFJRDogICAgICAgICAgICAnJyxcbiAgICAgICAgZXZlbnREYXRlOiAgICAgICAgJ3BhZ2UuYXR0cmlidXRlcy5ldmVudERhdGUnLFxuICAgICAgICBldmVudFRpbWU6ICAgICAgICAncGFnZS5hdHRyaWJ1dGVzLmV2ZW50VGltZScsXG4gICAgICAgIGV2ZW50TmFtZTogICAgICAgICdwYWdlLmF0dHJpYnV0ZXMuZXZlbnROYW1lJyxcbiAgICAgICAgZXZlbnRJRDogICAgICAgICAgJ3BhZ2UuYXR0cmlidXRlcy5ldmVudElEJyxcbiAgICAgICAgYXJ0aXN0TmFtZTogICAgICAgJ3BhZ2UuYXR0cmlidXRlcy5hcnRpc3ROYW1lJyxcbiAgICAgICAgYXJ0aXN0SUQ6ICAgICAgICAgJ3BhZ2UuYXR0cmlidXRlcy5hcnRpc3RJRCcsXG4gICAgICAgIHZlbnVlTmFtZTogICAgICAgICdwYWdlLmF0dHJpYnV0ZXMudmVudWVOYW1lJyxcbiAgICAgICAgdmVudWVJRDogICAgICAgICAgJ3BhZ2UuYXR0cmlidXRlcy52ZW51ZUlEJyxcbiAgICAgICAgbWFqb3JDYXRnb3J5SUQ6ICAgJ3BhZ2UuY2F0ZWdvcnkucHJpbWFyeUNhdGVnb3J5SUQnLFxuICAgICAgICBtYWpvckNhdGdvcnlOYW1lOiAncGFnZS5jYXRlZ29yeS5wcmltYXJ5Q2F0ZWdvcnknLFxuICAgICAgICBtaW5vckNhdGdvcnlJRDogICAncGFnZS5jYXRlZ29yeS5zdWJDYXRlZ29yeUlEJyxcbiAgICAgICAgbWlub3JDYXRnb3J5TmFtZTogJ3BhZ2UuY2F0ZWdvcnkuc3ViQ2F0ZWdvcnknLFxuICAgICAgICB0ZWFtSUQ6ICAgICAgICAgICAncGFnZS5hdHRyaWJ1dGVzLnRlYW1JRCcsXG4gICAgICAgIGN1cnJlbmN5OiAgICAgICAgICd0cmFuc2FjdGlvbi50b3RhbC5jdXJyZW5jeScsXG4gICAgICAgIHNlc3Npb25JRDogICAgICAgICcnLFxuICAgICAgICBjZmM6ICAgICAgICAgICAgICAnY2ZjJ1xuICAgIH07XG5cbiAgICBzZWxmLmNvbmZpZyAgICAgICAgID0gb3B0aW9ucyB8fCB7fTtcbiAgICBzZWxmLmNvbmZpZy52ZXJzaW9uID0gJzIuMC4yNSc7XG4gICAgc2VsZi5vdmVycmlkZXMgICAgICA9IG92ZXJyaWRlcyB8fCB7fTtcblxuICAgIGlmICggc2VsZi5jb25maWcuZGF0YUxheWVyT2JqZWN0ICkge1xuICAgICAgICBzZWxmLmNvbmZpZy5kYXRhID0gc2VsZi5nZXRWYWx1ZShzZWxmLmNvbmZpZy5kYXRhTGF5ZXJPYmplY3QsIHdpbmRvdyk7XG4gICAgfVxuXG4gICAgaWYgKCBzZWxmLmNvbmZpZy5kaXZvbHRlICYmIHNlbGYuY29uZmlnLmRpdm9sdGUuZW5hYmxlZCApIHtcbiAgICAgICAgc2VsZi50bVBpeGVsID0gbmV3IFRtUGl4ZWwoc2VsZik7XG4gICAgfVxuXG4gICAgc2VsZi50cmFja1BhZ2UgPSBmdW5jdGlvbiAoc2tpcFVwZGF0ZSkge1xuXG4gICAgICAgIGlmKCFza2lwVXBkYXRlKSB7XG4gICAgICAgICAgICBpZiAoIHNlbGYuY29uZmlnLmRhdGFMYXllck9iamVjdCApIHtcbiAgICAgICAgICAgICAgICBzZWxmLmNvbmZpZy5kYXRhID0gc2VsZi5nZXRWYWx1ZShzZWxmLmNvbmZpZy5kYXRhTGF5ZXJPYmplY3QsIHdpbmRvdyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIHNlbGYuY29uZmlnLmRhdGEgKSB7XG5cbiAgICAgICAgICAgIHNlbGYuY29uZmlnLmRhdGEucGFnZVVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICAgICAgICAgICAgc2VsZi5jb25maWcuZGF0YS5wYWdlUmVmZXJyZXIgPSBkb2N1bWVudC5yZWZlcnJlcjtcbiAgICAgICAgICAgIHNlbGYuY29uZmlnLmRhdGEucmFuZG9tICA9IE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwMDAwMDAwMDAwMDA7XG4gICAgICAgICAgICBzZWxmLmNvbmZpZy5kYXRhLnBhZ2VUaXRsZSA9IHdpbmRvdy5kb2N1bWVudC50aXRsZS5yZXBsYWNlKC9cXHgyNy9nLCBodG1sU2luZ2xlUXVvdGUpIHx8ICcnO1xuXG4gICAgICAgICAgICBzZWxmLmhhbmRsZVBpeGVscyhzZWxmLmNvbmZpZy5kaXZvbHRlICYmIHNlbGYuY29uZmlnLmRpdm9sdGUuZW5hYmxlZCAmJiBzZWxmLmNvbmZpZy5sb2dQaXhlbHMpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGlmICggc2VsZi5jb25maWcuYXV0b0ZpcmVQaXhlbHMgIT09IGZhbHNlICkge1xuICAgICAgICBzZWxmLnRyYWNrUGFnZSh0cnVlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc2VsZjtcbn1cblxuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuYWRkR0EyQ3VzdG9tRGltZW5zaW9ucyA9IGZ1bmN0aW9uIChnYSwgdHJhY2tlck5hbWUsIGN1c3RvbVZhcmlhYmxlcykge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIGlmICh0eXBlb2YgY3VzdG9tVmFyaWFibGVzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBmb3IgKHZhciBrZXkgaW4gY3VzdG9tVmFyaWFibGVzKSB7XG4gICAgICAgICAgICBnYSh0cmFja2VyTmFtZSArICcuc2V0Jywga2V5LCBzZWxmLmdldFZhbHVlKGN1c3RvbVZhcmlhYmxlc1trZXldKSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cblZlbmRvclNlcnZpY2UucHJvdG90eXBlLmFkZFNsYXNoZXMgPSBmdW5jdGlvbihzdHIpXG57XG4gICAgcmV0dXJuIChzdHIgKyAnJykucmVwbGFjZSgvW1xcXFxcIiddL2csICdcXFxcJCYnKS5yZXBsYWNlKC9cXHUwMDAwL2csICdcXFxcMCcpO1xufTtcblZlbmRvclNlcnZpY2UucHJvdG90eXBlLmFqYXggPSBmdW5jdGlvbih1cmwpe1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBpc01TOG9yOSA9IHdpbmRvdy5YRG9tYWluUmVxdWVzdCAmJiAod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL1RyaWRlbnRcXC81XFwuLykgfHwgd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL1RyaWRlbnRcXC80XFwuLykpO1xuICAgIHZhciB4bWxodHRwLHJlcXVlc3RUaGVuLGNhbGxiYWNrcyA9IFtdO1xuXG4gICAgaWYoaXNNUzhvcjkpe1xuICAgICAgICB4bWxodHRwID0gbmV3IFhEb21haW5SZXF1ZXN0KCk7XG4gICAgICAgIHhtbGh0dHAub25zdWNjZXNzID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGZvcih2YXIgaT0wO2k8Y2FsbGJhY2tzLmxlbmd0aDtpKyspe1xuICAgICAgICAgICAgICAgIHZhciBmbnMgPSBjYWxsYmFja3Muc2hpZnQoKTtcbiAgICAgICAgICAgICAgICBpZih0eXBlb2YgZm5zLnN1Y2Nlc3MgPT09ICdmdW5jdGlvbicpe1xuICAgICAgICAgICAgICAgICAgICBmbnMuc3VjY2VzcyhKU09OLnBhcnNlKHhtbGh0dHAucmVzcG9uc2VUZXh0KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB4bWxodHRwLm9uZXJyb3IgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgZm9yKHZhciBpPTA7aTxjYWxsYmFja3MubGVuZ3RoO2krKyl7XG4gICAgICAgICAgICAgICAgdmFyIGZucyA9IGNhbGxiYWNrcy5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBmbnMuZXJyb3IgPT09ICdmdW5jdGlvbicpe1xuICAgICAgICAgICAgICAgICAgICBmbnMuZXJyb3IoeG1saHR0cC5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmVxdWVzdFRoZW4gPSBmdW5jdGlvbihzdWNjZXNzLGVycm9yKXtcbiAgICAgICAgICAgIGNhbGxiYWNrcy5wdXNoKHtzdWNjZXNzOnN1Y2Nlc3MsZXJyb3I6ZXJyb3J9KVxuICAgICAgICB9O1xuICAgIH1lbHNle1xuICAgICAgICB4bWxodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgICAgICAgeG1saHR0cC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoeG1saHR0cC5yZWFkeVN0YXRlID09IChYTUxIdHRwUmVxdWVzdC5ET05FIHx8IDQpKSB7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBpPTA7aTxjYWxsYmFja3MubGVuZ3RoO2krKyl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmbnMgPSBjYWxsYmFja3Muc2hpZnQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoeG1saHR0cC5zdGF0dXMgPT0gMjAwICYmIHR5cGVvZiBmbnMuc3VjY2VzcyA9PT0gJ2Z1bmN0aW9uJyAmJiB4bWxodHRwLnJlc3BvbnNlVGV4dC5sZW5ndGggPiAwKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZucy5zdWNjZXNzKEpTT04ucGFyc2UoeG1saHR0cC5yZXNwb25zZVRleHQpKTtcbiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoeG1saHR0cC5zdGF0dXMgIT09IDIwMCAmJiB0eXBlb2YgZm5zLmVycm9yID09PSAnZnVuY3Rpb24nKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZucy5lcnJvcih4bWxodHRwLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXF1ZXN0VGhlbiA9IGZ1bmN0aW9uKHN1Y2Nlc3MsZXJyb3Ipe1xuICAgICAgICAgICAgaWYoeG1saHR0cC5yZWFkeVN0YXRlID09IChYTUxIdHRwUmVxdWVzdC5ET05FIHx8IDQpKXtcbiAgICAgICAgICAgICAgICB2YXIgY2FsbGJhY2sgPSB4bWxodHRwLnN0YXR1cyA9PSAyMDAgPyBzdWNjZXNzIDogZXJyb3I7XG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKWNhbGxiYWNrKHhtbGh0dHAucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5wdXNoKHtzdWNjZXNzOnN1Y2Nlc3MsZXJyb3I6ZXJyb3J9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHRyeXtcbiAgICAgICAgeG1saHR0cC5vcGVuKFwiR0VUXCIsIHVybCwgdHJ1ZSk7XG4gICAgICAgIHhtbGh0dHAuc2VuZCgpO1xuICAgIH1jYXRjaChlKXtcbiAgICAgICAgICAgIHNlbGYubG9nKCdQaXhlbCBTZXJ2aWNlOiBBamF4IEVycm9yIGZvciB1cmw6ICcgKyB1cmwpO1xuICAgIH1cblxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgdGhlbjpyZXF1ZXN0VGhlblxuICAgIH07XG5cbn07XG5WZW5kb3JTZXJ2aWNlLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKGZyb20sIHRvKVxue1xuICAgIGlmIChmcm9tID09IG51bGwgfHwgdHlwZW9mIGZyb20gIT0gXCJvYmplY3RcIikgcmV0dXJuIGZyb207XG4gICAgaWYgKGZyb20uY29uc3RydWN0b3IgIT0gT2JqZWN0ICYmIGZyb20uY29uc3RydWN0b3IgIT0gQXJyYXkpIHJldHVybiBmcm9tO1xuICAgIGlmIChmcm9tLmNvbnN0cnVjdG9yID09IERhdGUgfHwgZnJvbS5jb25zdHJ1Y3RvciA9PSBSZWdFeHAgfHwgZnJvbS5jb25zdHJ1Y3RvciA9PSBGdW5jdGlvbiB8fFxuICAgICAgICBmcm9tLmNvbnN0cnVjdG9yID09IFN0cmluZyB8fCBmcm9tLmNvbnN0cnVjdG9yID09IE51bWJlciB8fCBmcm9tLmNvbnN0cnVjdG9yID09IEJvb2xlYW4pXG4gICAgICAgIHJldHVybiBuZXcgZnJvbS5jb25zdHJ1Y3Rvcihmcm9tKTtcblxuICAgIHRvID0gdG8gfHwgbmV3IGZyb20uY29uc3RydWN0b3IoKTtcblxuICAgIGZvciAodmFyIG5hbWUgaW4gZnJvbSlcbiAgICB7XG4gICAgICAgIHRvW25hbWVdID0gdHlwZW9mIHRvW25hbWVdID09IFwidW5kZWZpbmVkXCIgPyB0aGlzLmNsb25lKGZyb21bbmFtZV0sIG51bGwpIDogdG9bbmFtZV07XG4gICAgfVxuXG4gICAgcmV0dXJuIHRvO1xufTtcblZlbmRvclNlcnZpY2UucHJvdG90eXBlLmNyZWF0ZUVsZW0gPSBmdW5jdGlvbih0eXBlLHVybCxpZCxjYikge1xuICAgIHZhciBlbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0eXBlKTtcbiAgICBlbGVtLnNyYyA9IHVybDtcbiAgICBlbGVtLndpZHRoID0gMTtcbiAgICBlbGVtLmhlaWdodCA9IDE7XG4gICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywnZGlzcGxheTpub25lJyk7XG4gICAgaWYodHlwZW9mIGlkID09PSAnc3RyaW5nJyllbGVtLmlkID0gaWQ7XG4gICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ2ZyYW1lYm9yZGVyJywwKTtcbiAgICBpZih0eXBlb2YgY2IgPT09ICdmdW5jdGlvbicpe1xuICAgICAgICBlbGVtLm9ubG9hZCA9IGNiO1xuICAgIH1cbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW0pO1xuXG59O1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuY3JlYXRlSWZyYW1lV2l0aENvbnRlbnQgPSBmdW5jdGlvbihpZCwgaHRtbCwgY2IpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB2YXIgaWZyYW1lICAgICAgICAgICA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpO1xuICAgIGlmcmFtZS5zdHlsZS5jc3NUZXh0ID0gJ3dpZHRoOjFweDsgaGVpZ2h0OjFweDsgZGlzcGxheTpub25lOyc7XG4gICAgaWZyYW1lLmZyYW1lYm9yZGVyICAgPSAwO1xuICAgIGlmcmFtZS5pZCAgICAgICAgICAgID0gaWQgKyBcIlwiO1xuICAgIGlmcmFtZS53aWR0aCAgICAgICAgID0gMTtcbiAgICBpZnJhbWUuaGVpZ2h0ICAgICAgICA9IDE7XG5cbiAgICBpZih0eXBlb2YgY2IgPT09ICdmdW5jdGlvbicpe1xuICAgICAgICBpZnJhbWUub25sb2FkID0gY2I7XG4gICAgfVxuXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChpZnJhbWUpO1xuICAgIHZhciBkb2MgPSAoIGlmcmFtZS5jb250ZW50V2luZG93IHx8IGlmcmFtZS5jb250ZW50RG9jdW1lbnQgKTtcbiAgICBpZiAoIGRvYy5kb2N1bWVudCApIHtcbiAgICAgICAgZG9jID0gZG9jLmRvY3VtZW50O1xuICAgIH1cbiAgICBkb2Mub3BlbigpO1xuICAgIGRvYy53cml0ZShodG1sKTtcbiAgICBkb2MuY2xvc2UoKTtcblxufTtcblxuXG5cblZlbmRvclNlcnZpY2UucHJvdG90eXBlLmVtYmVkSW5TY3JpcHRUYWcgPSBmdW5jdGlvbihwaXhlbENvZGVzKSB7XG4gICAgdmFyIGh0bWwgPSAnPHNjcmlwdD4nO1xuICAgIHBpeGVsQ29kZXMuZm9yRWFjaChmdW5jdGlvbiAocGl4ZWxDb2RlKSB7XG4gICAgICAgIGh0bWwgKz0gISFwaXhlbENvZGUgPyBwaXhlbENvZGUgOiAnJztcbiAgICB9KVxuICAgIGh0bWwgKz0gJzwvc2NyaXB0Pic7XG5cbiAgICByZXR1cm4gaHRtbDtcbn1cblZlbmRvclNlcnZpY2UucHJvdG90eXBlLmZldGNoUGl4ZWxzID0gZnVuY3Rpb24oY2FsbGJhY2spe1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciB1cmwgPSBzZWxmLmdldFBpeGVsRmlsZUVuZHBvaW50KCk7XG4gICAgaWYoc2VsZi5jb25maWcuYmFzZVVybCl7XG4gICAgICAgIHNlbGYuY29uZmlnLmVudmlyb25tZW50ID0gc2VsZi5jb25maWcuZW52aXJvbm1lbnQgfHwgJ2xvY2FsLyc7XG4gICAgICAgIGlmKHVybCkge1xuICAgICAgICAgICAgc2VsZi5hamF4KCdodHRwczovLycgKyB1cmwpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0cyl7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICAgICAgICB9LGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgc2VsZi5sb2coJ05vIGJhc2VVcmwgc2V0IGluIGNvbmZpZyB0byByZXRyaWV2ZSBwaXhlbHMnKTtcbiAgICB9XG5cbn07XG52YXIgdGlja2V0bWFzdGVyQWZmaWxpYXRpb24gPSAnVGlja2V0bWFzdGVyJztcblxuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuZ2VuZXJhdGVHQTRIdG1sU2NyaXB0VGFnID0gZnVuY3Rpb24gKHRhZykge1xuICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgdmFyIGVDb21tZXJjZVByb2R1Y3RzO1xuICB2YXIgcHJvZHVjdERhdGEgPSBzZWxmLmdldFZhbHVlKCdwcm9kdWN0RGF0YUpzb24nLCBzZWxmLmNvbmZpZy5kYXRhKTtcbiAgdmFyIHByb2R1Y3RJdGVtcyA9IFtdO1xuICB2YXIgdHJhY2tpbmdJZCA9IHRhZy50cmFja2luZ0lkLnJlcGxhY2UoL1xccy9nLCAnJyk7XG4gIHZhciBwYWdlVGl0bGUgPSBzZWxmLmdldFZhbHVlKCdwYWdlVGl0bGUnLCBzZWxmLmNvbmZpZy5kYXRhKTtcblxuICB0cnkge1xuICAgIGVDb21tZXJjZVByb2R1Y3RzID0gSlNPTi5wYXJzZShwcm9kdWN0RGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBlQ29tbWVyY2VQcm9kdWN0cyA9IFtdO1xuICB9XG5cbiAgdmFyIGh0bWwgPSBnZW5lcmF0ZU9wZW5pbmdIdG1sUGFydChzZWxmLCB0cmFja2luZ0lkLCBwYWdlVGl0bGUsIHRhZy5jdXN0b21WYXJpYWJsZXMpO1xuXG4gIGlmIChpc0FDb252ZXJzaW9uUGFnZShzZWxmLCBlQ29tbWVyY2VQcm9kdWN0cy5sZW5ndGgpKSB7XG4gICAgaHRtbCArPSBnZW5lcmF0ZUNvbnZlcnNpb25QYWdlSHRtbENvbnRlbnQoc2VsZiwgZUNvbW1lcmNlUHJvZHVjdHMsIHByb2R1Y3RJdGVtcywgdGFnLmN1c3RvbVZhcmlhYmxlcyk7XG4gIH0gZWxzZSBpZiAoaXNBbkV2ZW50RGV0YWlsUGFnZShlQ29tbWVyY2VQcm9kdWN0cy5sZW5ndGgpKSB7XG4gICAgaHRtbCArPSBnZW5lcmF0ZUV2ZW50RGV0YWlsUGFnZUh0bWxDb250ZW50KHNlbGYsIGVDb21tZXJjZVByb2R1Y3RzLCBwcm9kdWN0SXRlbXMsIHRhZy5jdXN0b21WYXJpYWJsZXMpO1xuICB9XG5cbiAgaHRtbCArPSBnZW5lcmF0ZUNsb3NpbmdIdG1sUGFydCgpO1xuICByZXR1cm4gaHRtbDtcbn1cblxudmFyIGlzQUNvbnZlcnNpb25QYWdlID0gZnVuY3Rpb24gKHZlbmRvclNlcnZpY2UsIGVDb21tZXJjZVByb2R1Y3RzU2l6ZSkge1xuICByZXR1cm4gdmVuZG9yU2VydmljZS5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcsIHZlbmRvclNlcnZpY2UuY29uZmlnLmRhdGEpICYmIGVDb21tZXJjZVByb2R1Y3RzU2l6ZTtcbn1cblxudmFyIGlzQW5FdmVudERldGFpbFBhZ2UgPSBmdW5jdGlvbiAoZUNvbW1lcmNlUHJvZHVjdHNTaXplKSB7XG4gIHJldHVybiBlQ29tbWVyY2VQcm9kdWN0c1NpemUgPT09IDE7XG59XG5cbnZhciBnZXRDdXN0b21EaW1lbnNpb25WYWx1ZXMgPSBmdW5jdGlvbiAoc2VydmljZSwgY3VzdG9tRGltZW5zaW9ucykge1xuICB2YXIgY3VzdG9tRGltZW5zaW9uc1ZhbHVlcyA9IHt9O1xuICBmb3IgKHZhciBrZXkgaW4gY3VzdG9tRGltZW5zaW9ucykge1xuICAgIGN1c3RvbURpbWVuc2lvbnNWYWx1ZXNba2V5XSA9IHNlcnZpY2UuZ2V0VmFsdWUoY3VzdG9tRGltZW5zaW9uc1trZXldKTtcbiAgfVxuICByZXR1cm4gY3VzdG9tRGltZW5zaW9uc1ZhbHVlcztcbn1cblxudmFyIGdldEZvcm1hdHRlZEN1c3RvbURpbWVuc2lvbnNGb3JIdG1sID0gZnVuY3Rpb24gKHNlcnZpY2UsIGN1c3RvbURpbWVuc2lvbnMpIHtcbiAgdmFyIGZvcm1hdHRlZEN1c3RvbURpbWVuc2lvbnMgPSAnJztcbiAgaWYgKGN1c3RvbURpbWVuc2lvbnMgJiYgT2JqZWN0LmtleXMoY3VzdG9tRGltZW5zaW9ucykubGVuZ3RoID4gMCkge1xuICAgIGZvcm1hdHRlZEN1c3RvbURpbWVuc2lvbnMgKz0gJywnO1xuICAgIGZvcm1hdHRlZEN1c3RvbURpbWVuc2lvbnMgKz0gSlNPTi5zdHJpbmdpZnkoZ2V0Q3VzdG9tRGltZW5zaW9uVmFsdWVzKHNlcnZpY2UsIGN1c3RvbURpbWVuc2lvbnMpKVxuICAgICAgICAucmVwbGFjZSgvXCIoW15cIl0rKVwiOi9nLCAnJDE6JylcbiAgICAgICAgLnJlcGxhY2UoL1t7fV0vZywgJycpXG4gICAgICAgIC5yZXBsYWNlKC9cIi9nLCBcIidcIik7XG4gIH1cblxuICByZXR1cm4gZm9ybWF0dGVkQ3VzdG9tRGltZW5zaW9ucztcbn1cblxudmFyIGdlbmVyYXRlRXZlbnREZXRhaWxQYWdlSHRtbENvbnRlbnQgPSBmdW5jdGlvbiAoc2VydmljZSwgZUNvbW1lcmNlUHJvZHVjdHMsIHByb2R1Y3RJdGVtcywgY3VzdG9tRGltZW5zaW9ucykge1xuICB2YXIgcHJvZHVjdCA9IGVDb21tZXJjZVByb2R1Y3RzWzBdO1xuICB2YXIgY2F0ZWdvcnkgPSBwcm9kdWN0LmNhdGVnb3J5LnNwbGl0KCcvJyk7XG4gIHZhciBwcmltYXJ5Q2F0ZWdvcnkgPSBjYXRlZ29yeVswXSB8fCAnJztcbiAgdmFyIHN1YkNhdGVnb3J5ID0gY2F0ZWdvcnkubGVuZ3RoID4gMSA/IGNhdGVnb3J5WzFdIDogJyc7XG4gIHZhciBjdXN0b21EaW1lbnNpb25WYWx1ZXMgPSBnZXRDdXN0b21EaW1lbnNpb25WYWx1ZXMoc2VydmljZSwgY3VzdG9tRGltZW5zaW9ucyk7XG4gIHZhciBwcm9kdWN0SXRlbSA9IE9iamVjdC5hc3NpZ24oY3VzdG9tRGltZW5zaW9uVmFsdWVzLCB7XG4gICAgYWZmaWxpYXRpb246IHRpY2tldG1hc3RlckFmZmlsaWF0aW9uLFxuICAgIGl0ZW1faWQ6IHByb2R1Y3QuaWQsXG4gICAgaXRlbV9uYW1lOiBwcm9kdWN0Lm5hbWUsXG4gICAgaXRlbV9icmFuZDogcHJvZHVjdC5icmFuZCxcbiAgICBpdGVtX2NhdGVnb3J5OiBwcmltYXJ5Q2F0ZWdvcnksXG4gICAgaXRlbV9jYXRlZ29yeTI6IHN1YkNhdGVnb3J5XG4gIH0pO1xuXG4gIHByb2R1Y3RJdGVtcy5wdXNoKHByb2R1Y3RJdGVtKTtcblxuICB2YXIgZXZlbnREZXRhaWxQYWdlSHRtbCA9ICd0bUd0YWcoXFwnZXZlbnRcXCcsIFxcJ3ZpZXdfaXRlbVxcJywgeyc7XG4gIGV2ZW50RGV0YWlsUGFnZUh0bWwgKz0gJ3NlbmRfdG86IHQsJztcbiAgZXZlbnREZXRhaWxQYWdlSHRtbCArPSAnaXRlbXM6ICcgKyBKU09OLnN0cmluZ2lmeShwcm9kdWN0SXRlbXMpO1xuICBldmVudERldGFpbFBhZ2VIdG1sICs9IGdldEZvcm1hdHRlZEN1c3RvbURpbWVuc2lvbnNGb3JIdG1sKHNlcnZpY2UsIGN1c3RvbURpbWVuc2lvbnMpO1xuICBldmVudERldGFpbFBhZ2VIdG1sICs9ICd9KTsnO1xuXG4gIHJldHVybiBldmVudERldGFpbFBhZ2VIdG1sO1xufVxuXG52YXIgZ2VuZXJhdGVDb252ZXJzaW9uUGFnZUh0bWxDb250ZW50ID0gZnVuY3Rpb24gKHNlcnZpY2UsIGVDb21tZXJjZVByb2R1Y3RzLCBwcm9kdWN0SXRlbXMsIGN1c3RvbURpbWVuc2lvbnMpIHtcbiAgZUNvbW1lcmNlUHJvZHVjdHMuZm9yRWFjaChmdW5jdGlvbiAocHJvZHVjdCkge1xuICAgIHZhciBjYXRlZ29yeSA9IHByb2R1Y3QuY2F0ZWdvcnkuc3BsaXQoJy8nKTtcbiAgICB2YXIgcHJpbWFyeUNhdGVnb3J5ID0gY2F0ZWdvcnlbMF0gfHwgJyc7XG4gICAgdmFyIHN1YkNhdGVnb3J5ID0gY2F0ZWdvcnkubGVuZ3RoID4gMSA/IGNhdGVnb3J5WzFdIDogJyc7XG4gICAgdmFyIGN1c3RvbURpbWVuc2lvbnNWYWx1ZXMgPSBnZXRDdXN0b21EaW1lbnNpb25WYWx1ZXMoc2VydmljZSwgY3VzdG9tRGltZW5zaW9ucyk7XG4gICAgdmFyIHByb2R1Y3RJdGVtID0gT2JqZWN0LmFzc2lnbihjdXN0b21EaW1lbnNpb25zVmFsdWVzLCB7XG4gICAgICBhZmZpbGlhdGlvbjogdGlja2V0bWFzdGVyQWZmaWxpYXRpb24sXG4gICAgICBpdGVtX2lkOiBwcm9kdWN0LmlkLFxuICAgICAgaXRlbV9uYW1lOiBwcm9kdWN0Lm5hbWUsXG4gICAgICBpdGVtX2JyYW5kOiBwcm9kdWN0LmJyYW5kLFxuICAgICAgaXRlbV9jYXRlZ29yeTogcHJpbWFyeUNhdGVnb3J5LFxuICAgICAgaXRlbV9jYXRlZ29yeTI6IHN1YkNhdGVnb3J5LFxuICAgICAgaXRlbV92YXJpYW50OiBwcm9kdWN0LnZhcmlhbnQsXG4gICAgICBxdWFudGl0eTogcHJvZHVjdC5xdWFudGl0eSxcbiAgICAgIHByaWNlOiBwcm9kdWN0LnByaWNlXG4gICAgfSk7XG5cbiAgICBwcm9kdWN0SXRlbXMucHVzaChwcm9kdWN0SXRlbSk7XG4gIH0pO1xuXG4gIHZhciBjb252ZXJzaW9uSHRtbCA9ICd0bUd0YWcoXFwnZXZlbnRcXCcsIFxcJ3B1cmNoYXNlXFwnLCB7JztcbiAgY29udmVyc2lvbkh0bWwgKz0gJ3NlbmRfdG86IHQsJztcbiAgY29udmVyc2lvbkh0bWwgKz0gJ2N1cnJlbmN5OiBcXCcnICsgc2VydmljZS5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udG90YWwuY3VycmVuY3knLCBzZXJ2aWNlLmNvbmZpZy5kYXRhKSArICdcXCcsJztcbiAgY29udmVyc2lvbkh0bWwgKz0gJ3RyYW5zYWN0aW9uX2lkOiBcXCcnICsgc2VydmljZS5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcsIHNlcnZpY2UuY29uZmlnLmRhdGEpICsgJ1xcJywnO1xuICBjb252ZXJzaW9uSHRtbCArPSAndmFsdWU6IFxcJycgKyBzZXJ2aWNlLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5iYXNlUHJpY2UnLCBzZXJ2aWNlLmNvbmZpZy5kYXRhKSArICdcXCcsJztcbiAgY29udmVyc2lvbkh0bWwgKz0gJ2l0ZW1zOiAnICsgSlNPTi5zdHJpbmdpZnkocHJvZHVjdEl0ZW1zKTtcbiAgY29udmVyc2lvbkh0bWwgKz0gZ2V0Rm9ybWF0dGVkQ3VzdG9tRGltZW5zaW9uc0Zvckh0bWwoc2VydmljZSwgY3VzdG9tRGltZW5zaW9ucyk7XG4gIGNvbnZlcnNpb25IdG1sICs9ICd9KTsnO1xuXG4gIHJldHVybiBjb252ZXJzaW9uSHRtbDtcbn1cblxudmFyIGdlbmVyYXRlT3BlbmluZ0h0bWxQYXJ0ID0gZnVuY3Rpb24gKHNlcnZpY2UsIHRyYWNraW5nSWQsIHBhZ2VUaXRsZSwgY3VzdG9tRGltZW5zaW9ucykge1xuICB2YXIgb3BlbmluZ0h0bWwgPSAnPHNjcmlwdD52YXIgdCA9IFxcJycgKyB0cmFja2luZ0lkICsgJ1xcJywgJztcbiAgb3BlbmluZ0h0bWwgKz0gJ2d0cyA9IGZ1bmN0aW9uIChpLGQpe3ZhciBlPWQuY3JlYXRlRWxlbWVudChcXCdzY3JpcHRcXCcpLG09ZC5nZXRFbGVtZW50c0J5VGFnTmFtZShcXCdzY3JpcHRcXCcpWzBdO2Uuc3JjPVxcJ2h0dHBzOi8vd3d3Lmdvb2dsZXRhZ21hbmFnZXIuY29tL2d0YWcvanM/aWQ9XFwnK2krXFwnJmw9dG1kbFxcJzttLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGUsbSl9Oyc7XG4gIG9wZW5pbmdIdG1sICs9ICdndHModCxkb2N1bWVudCk7JztcbiAgb3BlbmluZ0h0bWwgKz0gJ3dpbmRvdy50bWRsID0gd2luZG93LnRtZGwgfHwgW107JztcbiAgb3BlbmluZ0h0bWwgKz0gJ2Z1bmN0aW9uIHRtR3RhZygpe3RtZGwucHVzaChhcmd1bWVudHMpO30nO1xuICBvcGVuaW5nSHRtbCArPSAndG1HdGFnKFxcJ2pzXFwnLCBuZXcgRGF0ZSgpKTsnO1xuICAvLyBFbmhhbmNlZCBtZWFzdXJlbWVudCBidWdcbiAgb3BlbmluZ0h0bWwgKz0gJ3RtR3RhZyhcXCdjb25maWdcXCcsIHQsIHtzZW5kX3BhZ2VfdmlldzogZmFsc2V9KTsnO1xuICAvLyBCdWc6ICBFbmhhbmNlZCBNZWFzdXJlbWVudCBoYXMgYW4gdW5wcmVkaWN0YWJsZSBkZWxheSBmb3IgcGFnZV92aWV3IHdoZW4gY29uZmlndXJlZCBpbiBHQTQgY2xpZW50IGFjY291bnQgKG91dCBvZiBvdXIgY29udHJvbClcbiAgLy8gSXQncyB3YWl0aW5nL2xvb2tpbmcgZm9yIHNjcm9sbHMsIGV0Yy4gSGVyZSB3ZSB0cmlnZ2VyIHBhZ2VfdmlldyBtYW51YWxseSB0byBlbnN1cmUgaXQgZ29lcyBvdXQgYmVmb3JlIGdhLWRpc2FibGUgaXMgc2V0XG4gIG9wZW5pbmdIdG1sICs9ICd0bUd0YWcoXFwnZXZlbnRcXCcsIFxcJ3BhZ2Vfdmlld1xcJywge3NlbmRfdG86IHQsIHBhZ2VfdGl0bGU6IFxcJycgKyBwYWdlVGl0bGUgKyAnXFwnJyArIGdldEZvcm1hdHRlZEN1c3RvbURpbWVuc2lvbnNGb3JIdG1sKHNlcnZpY2UsIGN1c3RvbURpbWVuc2lvbnMpICsgJ30pOyc7XG5cbiAgcmV0dXJuIG9wZW5pbmdIdG1sO1xufVxuXG52YXIgZ2VuZXJhdGVDbG9zaW5nSHRtbFBhcnQgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiAnPC9zY3JpcHQ+Jztcbn1cblxuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuZ2VuZXJhdGVUaWt0b2tIdG1sU2NyaXB0VGFnID0gZnVuY3Rpb24odGFnKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGNvbnN0IHBhZ2VUeXBlID0gZ2V0UGFnZVR5cGUoc2VsZik7XG4gICAgaWYocGFnZVR5cGUgIT09IFBhZ2VUeXBlcy5VbnN1cHBvcnRlZClcbiAgICAgICAgcmV0dXJuIHNlbGYuZW1iZWRJblNjcmlwdFRhZyhbZ2VuZXJhdGVQaXhlbEluc3RhbGxhdGlvbkNvZGUodGFnLnBpeGVsSWQpLCBnZW5lcmF0ZVBpeGVsRXZlbnRDb2RlKHNlbGYsIHRhZywgcGFnZVR5cGUpXSlcbiAgICBlbHNlXG4gICAgICAgIHJldHVybiBudWxsO1xufVxuXG5jb25zdCBnZW5lcmF0ZVBpeGVsSW5zdGFsbGF0aW9uQ29kZSA9IGZ1bmN0aW9uKHBpeGVsSWQpIHtcbiAgICB2YXIgaW5zdGFsbGF0aW9uQ29kZSA9ICchKGZ1bmN0aW9uICh3LCBkLCB0KSB7JztcbiAgICBpbnN0YWxsYXRpb25Db2RlICs9ICd3LlRpa3Rva0FuYWx5dGljc09iamVjdCA9IHQ7JztcbiAgICBpbnN0YWxsYXRpb25Db2RlICs9ICd2YXIgdHRxID0gKHdbdF0gPSB3W3RdIHx8IFtdKTsnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJyh0dHEubWV0aG9kcyA9IFsnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJ1wicGFnZVwiLCc7XG4gICAgaW5zdGFsbGF0aW9uQ29kZSArPSAnXCJ0cmFja1wiLCc7XG4gICAgaW5zdGFsbGF0aW9uQ29kZSArPSAnXCJpZGVudGlmeVwiLCc7XG4gICAgaW5zdGFsbGF0aW9uQ29kZSArPSAnXCJpbnN0YW5jZXNcIiwnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJ1wiZGVidWdcIiwnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJ1wib25cIiwnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJ1wib2ZmXCIsJztcbiAgICBpbnN0YWxsYXRpb25Db2RlICs9ICdcIm9uY2VcIiwnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJ1wicmVhZHlcIiwnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJ1wiYWxpYXNcIiwnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJ1wiZ3JvdXBcIiwnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJ1wiZW5hYmxlQ29va2llXCIsJztcbiAgICBpbnN0YWxsYXRpb25Db2RlICs9ICdcImRpc2FibGVDb29raWVcIiwnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJ10pLCc7XG4gICAgaW5zdGFsbGF0aW9uQ29kZSArPSAnKHR0cS5zZXRBbmREZWZlciA9IGZ1bmN0aW9uICh0LCBlKSB7JztcbiAgICBpbnN0YWxsYXRpb25Db2RlICs9ICd0W2VdID0gZnVuY3Rpb24gKCkgeyc7XG4gICAgaW5zdGFsbGF0aW9uQ29kZSArPSAndC5wdXNoKFtlXS5jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKSkpOyc7XG4gICAgaW5zdGFsbGF0aW9uQ29kZSArPSAnfTsnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJ30pOyc7XG4gICAgaW5zdGFsbGF0aW9uQ29kZSArPSAnZm9yICh2YXIgaSA9IDA7IGkgPCB0dHEubWV0aG9kcy5sZW5ndGg7IGkrKyknO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJ3R0cS5zZXRBbmREZWZlcih0dHEsIHR0cS5tZXRob2RzW2ldKTsnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJyh0dHEuaW5zdGFuY2UgPSBmdW5jdGlvbiAodCkgeyc7XG4gICAgaW5zdGFsbGF0aW9uQ29kZSArPSAnZm9yICh2YXIgZSA9IHR0cS5faVt0XSB8fCBbXSwgbiA9IDA7IG4gPCB0dHEubWV0aG9kcy5sZW5ndGg7IG4rKyknO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJ3R0cS5zZXRBbmREZWZlcihlLCB0dHEubWV0aG9kc1tuXSk7JztcbiAgICBpbnN0YWxsYXRpb25Db2RlICs9ICdyZXR1cm4gZTsnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJ30pLCc7XG4gICAgaW5zdGFsbGF0aW9uQ29kZSArPSAnKHR0cS5sb2FkID0gZnVuY3Rpb24gKGUsIG4pIHsnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJ3ZhciBpID0gXCJodHRwczovL2FuYWx5dGljcy50aWt0b2suY29tL2kxOG4vcGl4ZWwvZXZlbnRzLmpzXCI7JztcbiAgICBpbnN0YWxsYXRpb25Db2RlICs9ICcodHRxLl9pID0gdHRxLl9pIHx8IHt9KSwnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJyh0dHEuX2lbZV0gPSBbXSksJztcbiAgICBpbnN0YWxsYXRpb25Db2RlICs9ICcodHRxLl9pW2VdLl91ID0gaSksJztcbiAgICBpbnN0YWxsYXRpb25Db2RlICs9ICcodHRxLl90ID0gdHRxLl90IHx8IHt9KSwnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJyh0dHEuX3RbZV0gPSArbmV3IERhdGUoKSksJztcbiAgICBpbnN0YWxsYXRpb25Db2RlICs9ICcodHRxLl9vID0gdHRxLl9vIHx8IHt9KSwnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJyh0dHEuX29bZV0gPSBuIHx8IHt9KSwnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJyh0dHEuX3BhcnRuZXIgPSB0dHEuX3BhcnRuZXIgfHwgXCJUaWNrZXRtYXN0ZXJcIik7JztcbiAgICBpbnN0YWxsYXRpb25Db2RlICs9ICd2YXIgbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIik7JztcbiAgICBpbnN0YWxsYXRpb25Db2RlICs9ICcoby50eXBlID0gXCJ0ZXh0L2phdmFzY3JpcHRcIiksJztcbiAgICBpbnN0YWxsYXRpb25Db2RlICs9ICcoby5hc3luYyA9ICEwKSwnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJyhvLnNyYyA9IGkgKyBcIj9zZGtpZD1cIiArIGUgKyBcIiZsaWI9XCIgKyB0KTsnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJ3ZhciBhID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIilbMF07JztcbiAgICBpbnN0YWxsYXRpb25Db2RlICs9ICdhLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG8sIGEpOyc7XG4gICAgaW5zdGFsbGF0aW9uQ29kZSArPSAnfSk7JztcbiAgICBpbnN0YWxsYXRpb25Db2RlICs9ICd0dHEubG9hZChcIicgKyBwaXhlbElkICsgJ1wiKTsnO1xuICAgIGluc3RhbGxhdGlvbkNvZGUgKz0gJ3R0cS5wYWdlKCk7JztcbiAgICBpbnN0YWxsYXRpb25Db2RlICs9ICd9KSh3aW5kb3csIGRvY3VtZW50LCBcInR0cVwiKTsnO1xuXG4gICAgcmV0dXJuIGluc3RhbGxhdGlvbkNvZGU7XG59XG5cbmNvbnN0IGdlbmVyYXRlUGl4ZWxFdmVudENvZGUgPSBmdW5jdGlvbih2ZW5kb3JTZXJ2aWNlLCB0YWcsIHBhZ2VUeXBlKSB7XG4gICAgdmFyIGV2ZW50Q29kZSA9ICdzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyc7XG4gICAgZXZlbnRDb2RlICs9ICAnaWYoICF3aW5kb3cudHRxICl7cmV0dXJuO30nO1xuXG4gICAgZXZlbnRDb2RlICs9IGdlbmVyYXRlUGFnZVR5cGVIdG1sUGFydCh2ZW5kb3JTZXJ2aWNlLCB0YWcucGl4ZWxJZCwgcGFnZVR5cGUpO1xuXG4gICAgZXZlbnRDb2RlICs9ICd9LCA1MDApOyc7XG4gICAgcmV0dXJuIGV2ZW50Q29kZTtcbn1cblxuY29uc3QgUGFnZVR5cGVzID0ge1xuICAgIFZlbnVlOiBcInZlbnVlIHBhZ2VcIixcbiAgICBBcnRpc3Q6IFwiYXJ0aXN0IHBhZ2VcIixcbiAgICBFdmVudERldGFpbDogXCJldmVudCBkZXRhaWwgcGFnZVwiLFxuICAgIENvbmZpcm1hdGlvbjogXCJjb25maXJtYXRpb24gcGFnZVwiLFxuICAgIFVuc3VwcG9ydGVkOiBcIlwiXG59O1xuXG52YXIgZ2V0UGFnZVR5cGUgPSBmdW5jdGlvbih2ZW5kb3JTZXJ2aWNlKSB7XG4gICAgY29uc3QgdmVudWVJZCA9IHZlbmRvclNlcnZpY2UuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy52ZW51ZUlEJywgdmVuZG9yU2VydmljZS5jb25maWcuZGF0YSk7XG4gICAgY29uc3QgYXJ0aXN0SWQgPSB2ZW5kb3JTZXJ2aWNlLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMuYXJ0aXN0SUQnLCB2ZW5kb3JTZXJ2aWNlLmNvbmZpZy5kYXRhKTtcbiAgICBjb25zdCBldmVudElkID0gdmVuZG9yU2VydmljZS5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmV2ZW50SUQnLCB2ZW5kb3JTZXJ2aWNlLmNvbmZpZy5kYXRhKTtcbiAgICBjb25zdCBvcmRlcklkID0gdmVuZG9yU2VydmljZS5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcsIHZlbmRvclNlcnZpY2UuY29uZmlnLmRhdGEpO1xuXG4gICAgaWYgKCEhdmVudWVJZCAmJiAhYXJ0aXN0SWQgJiYgIWV2ZW50SWQgJiYgIW9yZGVySWQpXG4gICAgICAgIHJldHVybiBQYWdlVHlwZXMuVmVudWU7XG4gICAgZWxzZSBpZiAoISFhcnRpc3RJZCAmJiAhdmVudWVJZCAmJiAhZXZlbnRJZCAmJiAhb3JkZXJJZClcbiAgICAgICAgcmV0dXJuIFBhZ2VUeXBlcy5BcnRpc3Q7XG4gICAgZWxzZSBpZiAoISFldmVudElkICYmICFvcmRlcklkKVxuICAgICAgICByZXR1cm4gUGFnZVR5cGVzLkV2ZW50RGV0YWlsO1xuICAgIGVsc2UgaWYgKCEhb3JkZXJJZClcbiAgICAgICAgcmV0dXJuIFBhZ2VUeXBlcy5Db25maXJtYXRpb247XG4gICAgZWxzZVxuICAgICAgICByZXR1cm4gUGFnZVR5cGVzLlVuc3VwcG9ydGVkO1xufVxuXG52YXIgZ2VuZXJhdGVQYWdlVHlwZUh0bWxQYXJ0ID0gZnVuY3Rpb24odmVuZG9yU2VydmljZSwgcGl4ZWxJZCwgcGFnZVR5cGUpIHtcbiAgICBzd2l0Y2gocGFnZVR5cGUpIHtcbiAgICAgICAgY2FzZSBQYWdlVHlwZXMuVmVudWU6XG4gICAgICAgICAgICByZXR1cm4gZ2VuZXJhdGVWZW51ZVBhZ2VIdG1sUGFydCh2ZW5kb3JTZXJ2aWNlLCBwaXhlbElkKTtcbiAgICAgICAgY2FzZSBQYWdlVHlwZXMuQXJ0aXN0OlxuICAgICAgICAgICAgcmV0dXJuIGdlbmVyYXRlQXJ0aXN0UGFnZUh0bWxQYXJ0KHZlbmRvclNlcnZpY2UsIHBpeGVsSWQpO1xuICAgICAgICBjYXNlIFBhZ2VUeXBlcy5FdmVudERldGFpbDpcbiAgICAgICAgICAgIHJldHVybiBnZW5lcmF0ZUV2ZW50RGV0YWlsUGFnZUh0bWxQYXJ0KHZlbmRvclNlcnZpY2UsIHBpeGVsSWQpO1xuICAgICAgICBjYXNlIFBhZ2VUeXBlcy5Db25maXJtYXRpb246XG4gICAgICAgICAgICByZXR1cm4gZ2VuZXJhdGVDb25maXJtYXRpb25QYWdlSHRtbFBhcnQodmVuZG9yU2VydmljZSwgcGl4ZWxJZCk7XG4gICAgfVxufVxuXG5jb25zdCBnZW5lcmF0ZVZlbnVlUGFnZUh0bWxQYXJ0ID0gZnVuY3Rpb24odmVuZG9yU2VydmljZSwgcGl4ZWxJZCkge1xuICAgIHJldHVybiAndHRxLmluc3RhbmNlKFxcJycrIHBpeGVsSWQgKydcXCcpLnRyYWNrKFxcJ1ZpZXdDb250ZW50XFwnLHtjb250ZW50X2NhdGVnb3J5OlxcJycrIHZlbmRvclNlcnZpY2UuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy52ZW51ZU5hbWUnKSArJ1xcJ30pOyc7XG59XG5cbmNvbnN0IGdlbmVyYXRlQXJ0aXN0UGFnZUh0bWxQYXJ0ID0gZnVuY3Rpb24odmVuZG9yU2VydmljZSwgcGl4ZWxJZCkge1xuICAgIHJldHVybiAndHRxLmluc3RhbmNlKFxcJycrIHBpeGVsSWQgKydcXCcpLnRyYWNrKFxcJ1ZpZXdDb250ZW50XFwnLHtjb250ZW50X2NhdGVnb3J5OlxcJycrIHZlbmRvclNlcnZpY2UuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5hcnRpc3ROYW1lJykgKydcXCd9KTsnO1xufVxuXG5jb25zdCBnZW5lcmF0ZUV2ZW50RGV0YWlsUGFnZUh0bWxQYXJ0ID0gZnVuY3Rpb24odmVuZG9yU2VydmljZSwgcGl4ZWxJZCkge1xuICAgIHJldHVybiAndHRxLmluc3RhbmNlKFxcJycrIHBpeGVsSWQgKydcXCcpLnRyYWNrKFxcJ1ZpZXdDb250ZW50XFwnLCB7ICBjb250ZW50X2NhdGVnb3J5OlxcJycrIHZlbmRvclNlcnZpY2UuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5hcnRpc3ROYW1lJykgKydcXCcsICBjb250ZW50X25hbWU6IFxcJycrIHZlbmRvclNlcnZpY2UuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudE5hbWUnKSArJ1xcJywgIGNvbnRlbnRfaWQ6IFxcJycrIHZlbmRvclNlcnZpY2UuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudElEJykgKydcXCcsICBjb250ZW50X3R5cGU6IFxcJ3Byb2R1Y3RcXCcgfSk7Jztcbn1cblxuY29uc3QgZ2VuZXJhdGVDb25maXJtYXRpb25QYWdlSHRtbFBhcnQgPSBmdW5jdGlvbih2ZW5kb3JTZXJ2aWNlLCBwaXhlbElkKSB7XG4gICAgdmFyIGNvbmZpcm1hdGlvblBhZ2VDb2RlID0gJ3R0cS5pbnN0YW5jZShcXCcnKyBwaXhlbElkICsnXFwnKS50cmFjayhcXCdDb21wbGV0ZVBheW1lbnRcXCcsIHsnO1xuICAgIGNvbmZpcm1hdGlvblBhZ2VDb2RlICs9ICdjb250ZW50X2NhdGVnb3J5OlxcJycrIHZlbmRvclNlcnZpY2UuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5hcnRpc3ROYW1lJykgKydcXCcsJztcbiAgICBjb25maXJtYXRpb25QYWdlQ29kZSArPSAnY29udGVudF9uYW1lOiBcXCcnKyB2ZW5kb3JTZXJ2aWNlLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMuZXZlbnROYW1lJykgKydcXCcsJztcbiAgICBjb25maXJtYXRpb25QYWdlQ29kZSArPSAnY29udGVudF9pZDogXFwnJysgdmVuZG9yU2VydmljZS5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmV2ZW50SUQnKSArJ1xcJywnO1xuICAgIGNvbmZpcm1hdGlvblBhZ2VDb2RlICs9ICdjb250ZW50X3R5cGU6IFxcJ3Byb2R1Y3RcXCcsJztcbiAgICBjb25maXJtYXRpb25QYWdlQ29kZSArPSAndmFsdWU6XFwnJysgdmVuZG9yU2VydmljZS5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udG90YWwuYmFzZVByaWNlJykgKydcXCcsJztcbiAgICBjb25maXJtYXRpb25QYWdlQ29kZSArPSAnY3VycmVuY3k6XFwnJysgdmVuZG9yU2VydmljZS5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udG90YWwuY3VycmVuY3knKSArJ1xcJywnO1xuICAgIGNvbmZpcm1hdGlvblBhZ2VDb2RlICs9ICdxdWFudGl0eTpcXCcnKyB2ZW5kb3JTZXJ2aWNlLmdldFZhbHVlKCd0cmFuc2FjdGlvbi5hdHRyaWJ1dGVzLnRpY2tldFF1YW50aXR5JykgKydcXCd9KTsnO1xuXG4gICAgcmV0dXJuIGNvbmZpcm1hdGlvblBhZ2VDb2RlO1xufVxuXG5cblZlbmRvclNlcnZpY2UucHJvdG90eXBlLnJlYWRBbGxDb29raWVzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHBhaXJzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KFwiO1wiKTtcbiAgICB2YXIgY29va2llcyA9IHt9O1xuICAgIGZvciAodmFyIGk9MDsgaTxwYWlycy5sZW5ndGg7IGkrKyl7XG4gICAgICAgIHZhciBwYWlyID0gcGFpcnNbaV0uc3BsaXQoXCI9XCIpO1xuICAgICAgICBjb29raWVzW3BhaXJbMF0ucmVwbGFjZSgvIC9nLCcnKV0gPSBkZWNvZGVVUklDb21wb25lbnQocGFpclsxXSk7XG4gICAgfVxuICAgIHJldHVybiBjb29raWVzO1xufTtcblZlbmRvclNlcnZpY2UucHJvdG90eXBlLmdldFBpeGVsRmlsZUVuZHBvaW50ID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIHJ1bGVzID0gc2VsZi5jb25maWcucnVsZXM7XG4gICAgdmFyIHVybFRvQnVpbGQgPSAnJztcblxuICAgIGZvcih2YXIgaSA9IDA7IGkgPCBydWxlcy5sZW5ndGg7IGkrKyl7XG4gICAgICAgIHZhciBjdXJyZW50UnVsZSA9IHJ1bGVzW2ldO1xuICAgICAgICBpZighY3VycmVudFJ1bGUudGVzdEZpZWxkIHx8ICFjdXJyZW50UnVsZS50ZXN0UmVnZXgpe1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYoY3VycmVudFJ1bGUudGVzdFJlZ2V4LnRlc3Qoc2VsZi5nZXRWYWx1ZShjdXJyZW50UnVsZS50ZXN0RmllbGQsc2VsZi5jb25maWcpKSAmJiBjdXJyZW50UnVsZS51cmxUZW1wbGF0ZSl7XG4gICAgICAgICAgICB2YXIgcGllY2VzID0gY3VycmVudFJ1bGUudXJsVGVtcGxhdGUubWF0Y2goLzwlKFteJT5dKyklPi9nKSB8fCBbXTtcbiAgICAgICAgICAgIHVybFRvQnVpbGQgPSBjdXJyZW50UnVsZS51cmxUZW1wbGF0ZSsnJztcbiAgICAgICAgICAgIGZvcih2YXIgaiA9IDA7IGogPCBwaWVjZXMubGVuZ3RoOyBqKyspe1xuICAgICAgICAgICAgICAgIC8vZGF0YS5ldmVudElEIG9yIGJhc2VVcmxcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWU9JycsXG4gICAgICAgICAgICAgICAgc3RvcmU9c2VsZi5jb25maWcsXG4gICAgICAgICAgICAgICAgZGF0YVBvaW50ID0gcGllY2VzW2pdLnJlcGxhY2UoJzwlJywnJykucmVwbGFjZSgnJT4nLCcnKTtcbiAgICAgICAgICAgICAgICBpZigvXmNvbmZpZ1xcLi8udGVzdChkYXRhUG9pbnQpKXtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVBvaW50ID0gZGF0YVBvaW50LnJlcGxhY2UoL15jb25maWdcXC4vLCcnKTtcbiAgICAgICAgICAgICAgICB9ZWxzZVxuICAgICAgICAgICAgICAgIGlmKC9eZGF0YVxcLi8udGVzdChkYXRhUG9pbnQpKXtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVBvaW50ID0gZGF0YVBvaW50LnJlcGxhY2UoL15kYXRhXFwuLywnJyk7XG4gICAgICAgICAgICAgICAgICAgIHN0b3JlID0gc2VsZi5jb25maWcuZGF0YTtcbiAgICAgICAgICAgICAgICB9ZWxzZVxuICAgICAgICAgICAgICAgIGlmKC9eY3VycmVudFJ1bGVcXC4vLnRlc3QoZGF0YVBvaW50KSl7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFQb2ludCA9IGRhdGFQb2ludC5yZXBsYWNlKC9eY3VycmVudFJ1bGVcXC4vLCcnKTtcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUgPSBjdXJyZW50UnVsZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHNlbGYuZ2V0VmFsdWUoZGF0YVBvaW50LHN0b3JlKTtcbiAgICAgICAgICAgICAgICBpZih0eXBlb2YgdmFsdWUgIT09ICdudW1iZXInICYmIHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpdmFsdWUgPSAnJztcblxuICAgICAgICAgICAgICAgIHVybFRvQnVpbGQgPSB1cmxUb0J1aWxkLnJlcGxhY2UocGllY2VzW2pdLHZhbHVlKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHJldHVybiB1cmxUb0J1aWxkIHx8IGZhbHNlO1xuXG59O1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuZ2V0U2NyaXB0ID0gZnVuY3Rpb24odXJsLGlkLGFwcGVuZFRvLGNiKXtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdHJ5e1xuICAgICAgICBuZXdTY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgICAgbmV3U2NyaXB0LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JztcbiAgICAgICAgbmV3U2NyaXB0LnNyYyA9IHVybDtcbiAgICAgICAgbmV3U2NyaXB0LmFzeW5jID0gdHJ1ZTtcbiAgICAgICAgaWYodHlwZW9mIGlkID09PSAnc3RyaW5nJyluZXdTY3JpcHQuaWQgPSBpZDtcbiAgICAgICAgaWYodHlwZW9mIGNiID09PSAnZnVuY3Rpb24nKXtcbiAgICAgICAgICAgIG5ld1NjcmlwdC5vbmxvYWQgPSBjYjtcbiAgICAgICAgfVxuICAgICAgICBpZihhcHBlbmRUbyl7XG4gICAgICAgICAgICBhcHBlbmRUby5hcHBlbmRDaGlsZChuZXdTY3JpcHQpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF0uYXBwZW5kQ2hpbGQobmV3U2NyaXB0KTtcbiAgICAgICAgfVxuICAgIH1jYXRjaChlKXtcbiAgICAgICAgaWYoc2VsZi5jb25maWcuZGVidWcgPT09IHRydWUgJiYgdHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiB0YWdzWzBdICE9PSAndW5kZWZpbmVkJyl7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnUGl4ZWwgU2VydmljZTogU2NyaXB0IExvYWRpbmcgRmFpbGVkOicgKyB1cmwpO1xuICAgICAgICB9XG4gICAgfVxuXG59O1xuXG5cblZlbmRvclNlcnZpY2UucHJvdG90eXBlLmdldFVybFBhcmFtcyA9IGZ1bmN0aW9uIChsb2NhdGlvbikge1xuICAgIGxvY2F0aW9uID0gbG9jYXRpb24gfHwgZG9jdW1lbnQubG9jYXRpb247XG4gICAgdmFyIHFkID0ge307XG4gICAgbG9jYXRpb24uc2VhcmNoLnN1YnN0cigxKS5zcGxpdChcIiZcIikuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICB2YXIgayA9IGl0ZW0uc3BsaXQoXCI9XCIpWzBdXG4gICAgICAgICAgICAsIHYgPSBkZWNvZGVVUklDb21wb25lbnQoaXRlbS5zcGxpdChcIj1cIilbMV0pO1xuICAgICAgICAoayBpbiBxZCkgPyBxZFtrXS5wdXNoKHYpIDogcWRba10gPSBbdl07XG4gICAgfSk7XG4gICAgcmV0dXJuIHFkO1xufTtcblZlbmRvclNlcnZpY2UucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKHBhdGgsIG9iaikge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBpZiAodHlwZW9mIHNlbGYub3ZlcnJpZGVzW3BhdGhdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBzZWxmLmxvZygnUGl4ZWwgU2VydmljZTogT3ZlcnJpZGUgZm91bmQgZm9yIHBhdGg6ICcgKyBwYXRoKTtcbiAgICAgICAgdmFyIG92ZXJyaWRlID0gc2VsZi5vdmVycmlkZXNbcGF0aF07XG4gICAgICAgIGlmICh0eXBlb2Ygb3ZlcnJpZGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHJldHVybiBvdmVycmlkZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy9pdCdzIGEgY29uc3RhbnRcbiAgICAgICAgICAgIHJldHVybiBzZWxmLm92ZXJyaWRlc1twYXRoXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhciB0b051bWVyaWMgPSBbJ3RpY2tldFF1YW50aXR5JywgJ2Jhc2VQcmljZScsICdmZWVzVG90YWwnLCAndHJhbnNhY3Rpb25Ub3RhbCddO1xuICAgIG9iaiA9IG9iaiB8fCBzZWxmLmNvbmZpZy5kYXRhO1xuICAgIGZvciAodmFyIGkgPSAwLCBwYXRoID0gcGF0aC5zcGxpdCgnLicpLCBsZW4gPSBwYXRoLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIGlmICh0eXBlb2Ygb2JqW3BhdGhbaV1dICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmpbcGF0aFtpXV0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBvYmogPSBvYmpbcGF0aFtpXV0oKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRvTnVtZXJpYy5pbmRleE9mKHBhdGhbaV0pID4gLTEgJiYgIW9ialtwYXRoW2ldXSkge1xuICAgICAgICAgICAgICAgICAgICBvYmogPSAwO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG9iaiA9IG9ialtwYXRoW2ldXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvYmogPSBcIlwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG9iajtcbn07XG4vKipcbiAqIFJldHVybiBjdXJyZW50IGxpYiB2ZXJzaW9uXG4gKi9cblZlbmRvclNlcnZpY2UucHJvdG90eXBlLmxvZyA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgcmV0dXJuIHNlbGYuY29uZmlnLnZlcnNpb247XG5cbn07XG5WZW5kb3JTZXJ2aWNlLnByb3RvdHlwZS5oYW5kbGVFcnJvciA9IGZ1bmN0aW9uKG1zZyl7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICBpZih0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcpe1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRVJST1I6ICVzJywgbXNnLCBkYXRhKTtcbiAgICAgICAgfVxuICAgIH07XG59O1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuaGFuZGxlUGl4ZWxzID0gZnVuY3Rpb24obG9nUGl4ZWxzKVxue1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBzZWxmLnBpeGVsUHJvY2Vzc1Byb2dyZXNzID0gW107XG4gICAgc2VsZi5mYjMgPSBzZWxmLnBpeGVsUHJvY2Vzc1Byb2dyZXNzO1xuICAgIHNlbGYuZmV0Y2hQaXhlbHMoZnVuY3Rpb24gKGVyciwgcmVzdWx0cykge1xuXG4gICAgICAgIGlmKGVycikge1xuICAgICAgICAgICAgc2VsZi5oYW5kbGVFcnJvcignRmFpbGVkIHRvIHJldHJpZXZlIHRhZ3MgZnJvbSBDRE4nKShlcnIpO1xuICAgICAgICAgICAgc2VsZi5waXhlbFByb2Nlc3NQcm9ncmVzcy5wdXNoKHtzdW1tYXJ5OiAnRmFpbGVkIHRvIHJldHJpZXZlIHRhZ3MgZnJvbSBDRE4nLCBtc2c6ZXJyfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSBpZiAocmVzdWx0cyAmJiByZXN1bHRzLmxlbmd0aCAmJiByZXN1bHRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHNlbGYucGl4ZWxQcm9jZXNzUHJvZ3Jlc3MucHVzaCh7c3VtbWFyeTogJ0ZldGNoZWQgUGl4ZWxzIFN1Y2Nlc3NmdWxseScsIG1zZzogJ0ZvdW5kICcgKyByZXN1bHRzLmxlbmd0aCwgcGFnZTogc2VsZi5nZXRWYWx1ZSgncGFnZS5wYWdlSW5mby5wYWdlTmFtZScpIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2VsZi5sb2coJ05vIFRhZ3MgdG8gUHJvY2VzcycpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgc2VsZi5wcm9jZXNzVGFncyhyZXN1bHRzLCBmdW5jdGlvbiAoZXJyKSB7XG5cbiAgICAgICAgICAgIGlmKGVycikge1xuICAgICAgICAgICAgICAgIHNlbGYuaGFuZGxlRXJyb3IoJ0ZhaWxlZCB0byBwcm9jZXNzIHRhZ3MnKShlcnIpO1xuICAgICAgICAgICAgICAgIHNlbGYucGl4ZWxQcm9jZXNzUHJvZ3Jlc3MucHVzaCh7c3VtbWFyeTogJ0ZhaWxlZCB0byBwcm9jZXNzIHRhZ3MnLCBtc2c6ZXJyfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZWxmLnBpeGVsUHJvY2Vzc1Byb2dyZXNzLnB1c2goe3N1bW1hcnk6ICdTb3J0ZWQgdGFncyBzdWNjZXNzZnVsbHknLCBwYWdlOiBzZWxmLmdldFZhbHVlKCdwYWdlLnBhZ2VJbmZvLnBhZ2VOYW1lJyl9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2VsZi5wcm9jZXNzUGl4ZWxzKGZhbHNlLCBmdW5jdGlvbiAoZXJyLCBzdGF0dXMpe1xuXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7cGl4ZWxzOiBzdGF0dXN9O1xuICAgICAgICAgICAgICAgIGlmKGVycikge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmhhbmRsZUVycm9yKCdGYWlsZWQgdG8gcHJvY2VzcyBwaXhlbHMnKShlcnIpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnBpeGVsUHJvY2Vzc1Byb2dyZXNzLnB1c2goe3N1bW1hcnk6ICdGYWlsZWQgdG8gcHJvY2VzcyBBTEwgcGl4ZWxzIHN1Y2Vzc2Z1bGx5JywgcGl4ZWxzQXR0ZW1wdGVkOiByZXN1bHRzLmxlbmd0aCwgcGl4ZWxFcnJvcnM6IGVyci5sZW5ndGggLCBlcnJvcnM6ZXJyLCBwYWdlOiBzZWxmLmdldFZhbHVlKCdwYWdlLnBhZ2VJbmZvLnBhZ2VOYW1lJyl9KTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5oYXNQaXhlbEVycm9ycyA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5waXhlbFByb2Nlc3NQcm9ncmVzcy5wdXNoKHtzdW1tYXJ5OiAnUHJvY2Vzc2VkIFBpeGVscyBTdWNjZXNzZnVsbHknLCBwYWdlOiBzZWxmLmdldFZhbHVlKCdwYWdlLnBhZ2VJbmZvLnBhZ2VOYW1lJyl9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobG9nUGl4ZWxzKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5UbVBpeGVsID0gd2luZG93LlRtUGl4ZWwgfHwgW107XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5UbVBpeGVsLnB1c2goe2V2ZW50OiAncGl4ZWxsb2dzJywgZGF0YTogZGF0YSwgc2VuZEFsbDogdHJ1ZX0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufTtcbi8qKlxuICogTG9nIHRvIGNvbnNvbGVcbiAqIEBwYXJhbSBtc2dcbiAqIEBwYXJhbSBwcmVmaXhcbiAqL1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24gKG1zZywgcHJlZml4KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHByZWZpeCA9IHByZWZpeCB8fCAnUGl4ZWwgU2VydmljZTogJztcbiAgICBpZiAoc2VsZi5jb25maWcuZGVidWcgPT09IHRydWUgJiYgdHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHByZWZpeCArIG1zZyk7XG4gICAgfVxufTtcbi8qKlxuICogTWVyZ2VcbiAqIEBwYXJhbSBkZWZNYXAgLS0gc291cmNlIG9ialxuICogQHBhcmFtIG92ZXJyaWRlcyAtLSB0YXJnZXQgb2JqLCB2YWx1ZXMgd2lsbCBvdmVycmlkZSB0aGUgc291cmNlIG9iai5cbiAqIEByZXR1cm5zIHt7fX1cbiAqL1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUubWVyZ2UgPSBmdW5jdGlvbihkZWZNYXAsIG92ZXJyaWRlcyl7XG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhkZWZNYXApLmNvbmNhdChPYmplY3Qua2V5cyhvdmVycmlkZXMpKSxcbiAgICAgICAgY29weSA9IHt9O1xuICAgIGtleXMuZm9yRWFjaChmdW5jdGlvbiAoa2V5LCBpbmRleCkge1xuICAgICAgICB2YXIgcHJpbWFyeSA9IG92ZXJyaWRlc1trZXldLCBzZWNvbmRhcnkgPSBkZWZNYXBba2V5XTtcbiAgICAgICAgaWYgKHByaW1hcnkgIT09IHVuZGVmaW5lZCAmJiBwcmltYXJ5ICE9PSBudWxsICYmIHByaW1hcnkgIT09ICcnKSB7XG4gICAgICAgICAgICBjb3B5W2tleV0gPSBwcmltYXJ5O1xuICAgICAgICB9IGVsc2UgaWYgKHNlY29uZGFyeSAhPT0gdW5kZWZpbmVkICYmIHNlY29uZGFyeSAhPT0gbnVsbCAmJiBzZWNvbmRhcnkgIT09ICcnKSB7XG4gICAgICAgICAgICBjb3B5W2tleV0gPSBzZWNvbmRhcnk7XG4gICAgICAgIH1cblxuICAgIH0pO1xuICAgIHJldHVybiBjb3B5O1xufTtcblZlbmRvclNlcnZpY2UucHJvdG90eXBlLnByb2Nlc3NQaXhlbHMgPSBmdW5jdGlvbihzZW5kVG9EaXZvbHRlLCBjYWxsYmFjayl7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBzdGF0dXMgPSBbXTtcbiAgICB2YXIgaGFzRXJyb3JzID0gW107XG4gICAgZm9yKHZhciBpID0gMCxrZXlzPU9iamVjdC5rZXlzKHNlbGYuc29ydGVkVGFncyk7aTxrZXlzLmxlbmd0aDtpKyspe1xuICAgICAgICB2YXIgc2VydmljZSA9IGtleXNbaV07XG4gICAgICAgIHNlbGYubG9nKCdUcnlpbmcgdG8gZmluZCBtZXRob2Q6ICcgKyBzZXJ2aWNlKTtcblxuICAgICAgICBpZih0eXBlb2Ygc2VsZltzZXJ2aWNlXSA9PT0gJ2Z1bmN0aW9uJyl7XG4gICAgICAgICAgICB2YXIgdGFncyA9IHNlbGYuc29ydGVkVGFnc1tzZXJ2aWNlXTtcbiAgICAgICAgICAgIGZvciAoIHZhciBqID0gMDsgaiA8IHRhZ3MubGVuZ3RoOyBqKysgKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlY29yZCA9IHsgaWQ6IHRhZ3Nbal0uaWQsIHR5cGU6IHRhZ3Nbal0udHlwZSwgZW5kRGF0ZTogdGFnc1tqXS5lbmREYXRlLCBiZWdpbkRhdGU6IHRhZ3Nbal0uYmVnaW5EYXRlLCBkb21haW5zOiB0YWdzW2pdLmRvbWFpbnN9O1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGZbc2VydmljZV0odGFnc1tqXSwgaik7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoIGUgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlY29yZC5lcnJvciA9IGUubWVzc2FnZTtcbiAgICAgICAgICAgICAgICAgICAgaGFzRXJyb3JzLnB1c2goe2Vycm9yOiBlLm1lc3NhZ2UsIHBpeGVsOiByZWNvcmQgfSk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYubG9nKCdGYWlsZWQgdG8gcnVuIG1ldGhvZCBmb3Igc2VydmljZS9waXhlbElkOiAnICsgc2VydmljZSArICcvJyArIHRhZ3Nbal0uaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdGF0dXMucHVzaChyZWNvcmQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2VsZi5waXhlbEhpc3RvcnkgPSBzZWxmLnBpeGVsSGlzdG9yeSB8fCBbXTtcbiAgICBzZWxmLnBpeGVsSGlzdG9yeSA9IHNlbGYucGl4ZWxIaXN0b3J5LmNvbmNhdChzdGF0dXMpO1xuICAgIGNhbGxiYWNrKGhhc0Vycm9ycy5sZW5ndGg+MCA/IGhhc0Vycm9ycyA6IG51bGwsIHN0YXR1cyk7XG5cbn07XG5WZW5kb3JTZXJ2aWNlLnByb3RvdHlwZS5wcm9jZXNzVGFncyA9IGZ1bmN0aW9uIChyZXN1bHRzLCBjYWxsYmFjaykge1xuICAgIHZhciBzZWxmICAgICA9IHRoaXM7XG5cbiAgICB2YXIgc29ydGVkVGFncyAgICAgPSB7fTtcbiAgICB2YXIgbm93ICAgICAgICAgICAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcbiAgICAgICAgZG9tYWluICAgICAgICAgPSBzZWxmLmdldFZhbHVlKCdwYWdlLnBhZ2VJbmZvLmRvbWFpbicsIHNlbGYuY29uZmlnLmRhdGEpLFxuICAgICAgICBpc0NvbmZpcm1hdGlvbiA9IC9DaGVja291dDogQ29uZmlybWF0aW9uLy50ZXN0KHNlbGYuZ2V0VmFsdWUoJ3BhZ2UucGFnZUluZm8ucGFnZU5hbWUnKSksXG4gICAgICAgIHBhZ2VTdWJ0eXBlICAgID0gc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24uYXR0cmlidXRlcy5pbnZlbnRvcnlUeXBlJykgfHwgJ3ByaW1hcnknO1xuXG4gICAgZm9yICggdmFyIGkgPSAwOyBpIDwgcmVzdWx0cy5sZW5ndGg7IGkrKyApIHtcblxuICAgICAgICBpZiAoIHR5cGVvZiByZXN1bHRzW2ldLnR5cGVzID09PSAndW5kZWZpbmVkJyApIHsgIC8vaWYgdGhlcmUgYXJlIG5vIHR5cGVzLCB3ZSBjYW4gYXNzdW1lIGl0J3MgVE1cblxuICAgICAgICAgICAgdmFyIGRlZmF1bHRDYXNlRG9tYWlucyA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKCB0eXBlb2YgcmVzdWx0c1tpXS5kb21haW5zID09PSAndW5kZWZpbmVkJyB8fCByZXN1bHRzW2ldLmRvbWFpbnMubGVuZ3RoIDwgMSApIHtcbiAgICAgICAgICAgICAgICByZXN1bHRzW2ldLmRvbWFpbnMgPSBbXTtcbiAgICAgICAgICAgICAgICBpZiAoIFsnVVNfREVTS1RPUCcsICdDQV9ERVNLVE9QJywgJ1VTX01PQklMRScsICdDQV9NT0JJTEUnXS5pbmRleE9mKGRvbWFpbikgIT09IC0xICkge1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Q2FzZURvbWFpbnMgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGZpcmVCYXNlZE9uUGFnZVN1YnR5cGUgPSB0cnVlOyAvL2J5IGRlZmF1bHQsIHdlIGRvbid0IHdvcnJ5IGFib3V0IHByaW1hcnkvcmVzYWxlIHN1YnR5cGVzXG4gICAgICAgICAgICBpZiAoIGlzQ29uZmlybWF0aW9uICkge1xuICAgICAgICAgICAgICAgIC8vbm8gc3VidHlwZXM6IHRoaXMgaXMgYW4gb2xkZXIgcGl4ZWwgZnJvbSBiZWZvcmUgc3VidHlwZXMgd2VyZSBzdXBwb3J0ZWQsIHNvIGp1c3QgZmlyZSBhd2F5XG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgcmVzdWx0c1tpXS5wYWdlU3VidHlwZXMgPT09ICd1bmRlZmluZWQnIHx8IHJlc3VsdHNbaV0ucGFnZVN1YnR5cGVzLmxlbmd0aCA8IDEgKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpcmVCYXNlZE9uUGFnZVN1YnR5cGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL3N1YnR5cGVzIGV4aXN0OiBpbiB0aGlzIGNhc2UsIGlmIHRoZSBwYWdlIHN1YnR5cGUgb2YgdGhlIGN1cnJlbnQgY29uZmlybWF0aW9uIHBhZ2UgaXMgbm90IGluIHRoZSBsaXN0LCBkb24ndCBmaXJlIHRoZSBwaXhlbFxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKCByZXN1bHRzW2ldLnBhZ2VTdWJ0eXBlcy5pbmRleE9mKHBhZ2VTdWJ0eXBlLnRvVXBwZXJDYXNlKCkpID09PSAtMSApIHtcbiAgICAgICAgICAgICAgICAgICAgZmlyZUJhc2VkT25QYWdlU3VidHlwZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy93aGVuIHRvIGZpcmUgYSBwaXhlbFxuICAgICAgICAgICAgaWYgKCByZXN1bHRzW2ldLmVuYWJsZWQgIT09IGZhbHNlICYmIFx0XHRcdFx0XHRcdFx0XHRcdFx0Ly9waXhlbCBpcyBlbmFibGVkXG4gICAgICAgICAgICAgICAgIChyZXN1bHRzW2ldLmVuZERhdGUgPT0gbnVsbCB8fCBub3cgPCByZXN1bHRzW2ldLmVuZERhdGUpICYmIFx0XHRcdFx0XHRcdFx0XHRcdFx0Ly9ub3cgaXMgYmV0d2VlbiB0aGUgYmVnaW4gYW5kIGVuZCBkYXRlc1xuICAgICAgICAgICAgICAgICBub3cgPiByZXN1bHRzW2ldLmJlZ2luRGF0ZSAmJlxuICAgICAgICAgICAgICAgICAocmVzdWx0c1tpXS5kb21haW5zLmluZGV4T2YoZG9tYWluKSA+IC0xIHx8IGRlZmF1bHRDYXNlRG9tYWlucykgJiYgXHQvL3lvdSBhcmUgb24gdGhlIGNvcnJlY3QgZG9tYWluXG4gICAgICAgICAgICAgICAgIChmaXJlQmFzZWRPblBhZ2VTdWJ0eXBlKVx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvLyB0aGUgcHJpbWFyeS9yZXNhbGUgdGFyZ2V0aW5nIG1hdGNoZXMgY29ycmVjdGx5IChsb2dpYyBmb3IgdGhpcyBpcyBhYm92ZSlcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIHZhciBrZXkgPSBzZWxmLnRvQ2FtZWxDYXNlKHJlc3VsdHNbaV0uc2x1Zyk7XG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlb2Ygc29ydGVkVGFnc1trZXldID09PSAndW5kZWZpbmVkJyApIHtcbiAgICAgICAgICAgICAgICAgICAgc29ydGVkVGFnc1trZXldID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNvcnRlZFRhZ3Nba2V5XS5wdXNoKHJlc3VsdHNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy9jYXNlIG9mIGFjY291bnQgbWFuYWdlclxuICAgICAgICBlbHNlIGlmICggdHlwZW9mIHJlc3VsdHNbaV0udHlwZXMgIT09ICd1bmRlZmluZWQnICkge1xuICAgICAgICAgICAgdmFyIGNvcnJlY3RQYWdlID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgcGFnZU5hbWUgICAgPSBkb21haW4gPSBzZWxmLmdldFZhbHVlKCdwYWdlLnBhZ2VJbmZvLnBhZ2VOYW1lJywgc2VsZi5jb25maWcuZGF0YSk7XG4gICAgICAgICAgICB2YXIgcGFnZVR5cGUgPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAoISgvOiBDaGVja291dCQvLnRlc3QocGFnZU5hbWUpIHx8IC86IEJpbGxpbmckLy50ZXN0KHBhZ2VOYW1lKSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoL14oKD8hKEJ1eXxDb25maXJtYXRpb24pKS4pKiQvLnRlc3QocGFnZU5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VUeXBlID0gJ0xBTkRJTkcnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoL14oKD8hQ29uZmlybWF0aW9uKS4pKkJ1eSgoPyFDb25maXJtYXRpb24pLikqJC8udGVzdChwYWdlTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZVR5cGUgPSAnUFVSQ0hBU0lORyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICgvQnV5OiBDb25maXJtYXRpb24vLnRlc3QocGFnZU5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VUeXBlID0gJ0NPTkZJUk1BVElPTic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIHJlc3VsdHNbaV0udHlwZXMuaW5kZXhPZihwYWdlVHlwZSkgIT09IC0xICkge1xuICAgICAgICAgICAgICAgIGNvcnJlY3RQYWdlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCByZXN1bHRzW2ldLmVuYWJsZWQgIT09IGZhbHNlICYmIChyZXN1bHRzW2ldLmVuZERhdGUgPT0gbnVsbCB8fCBub3cgPCByZXN1bHRzW2ldLmVuZERhdGUpICYmIG5vdyA+IHJlc3VsdHNbaV0uYmVnaW5EYXRlICYmIGNvcnJlY3RQYWdlICkge1xuICAgICAgICAgICAgICAgIHZhciBrZXkgPSBzZWxmLnRvQ2FtZWxDYXNlKHJlc3VsdHNbaV0uc2x1Zyk7XG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlb2Ygc29ydGVkVGFnc1trZXldID09PSAndW5kZWZpbmVkJyApIHtcbiAgICAgICAgICAgICAgICAgICAgc29ydGVkVGFnc1trZXldID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNvcnRlZFRhZ3Nba2V5XS5wdXNoKHJlc3VsdHNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2VsZi5zb3J0ZWRUYWdzID0gc29ydGVkVGFncztcbiAgICBjYWxsYmFjaygpO1xuXG59O1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbihwYXRoLHZhbHVlLG9iail7XG4gICAgb2JqID0gb2JqIHx8IHt9O1xuICAgIHBhdGg9cGF0aC5zcGxpdCgnLicpO1xuICAgIGZvciAodmFyIGk9MCwgbGVuPXBhdGgubGVuZ3RoOyBpPGxlbjsgaSsrKXtcbiAgICAgICAgb2JqW3BhdGhbaV1dID0gb2JqW3BhdGhbaV1dIHx8IHt9O1xuICAgICAgICBpZihpPT09bGVuLTEpe1xuICAgICAgICAgICAgb2JqW3BhdGhbaV1dID0gdmFsdWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBvYmogPSBvYmpbcGF0aFtpXV07XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHJldHVybiBvYmo7XG59O1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUudG9DYW1lbENhc2UgPSBmdW5jdGlvbihteVN0cmluZyl7XG4gICAgcmV0dXJuIG15U3RyaW5nLnJlcGxhY2UoLy0oW2Etel0pL2csIGZ1bmN0aW9uIChnKSB7IHJldHVybiBnWzFdLnRvVXBwZXJDYXNlKCk7IH0pO1xufTtcblZlbmRvclNlcnZpY2UucHJvdG90eXBlLnRvRmxvYXQgPSBmdW5jdGlvbihudW0sIG51bURlZmF1bHQpe1xuICAgIHZhciBwYXJzZWRCYXNlID0gcGFyc2VGbG9hdChudW0pO1xuICAgIGlmKCFpc05hTihwYXJzZWRCYXNlKSAmJiB0eXBlb2YgcGFyc2VkQmFzZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlZEJhc2UudG9GaXhlZCgyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbnVtRGVmYXVsdCB8fCAwLjAwO1xuICAgIH1cbn07XG4vKipcbiAqIFVuaXFcbiAqIEBwYXJhbSBhcnJheSB0byB1bmlxXG4gKiBAcmV0dXJucyB1bmlxIGFycmF5XG4gKi9cblZlbmRvclNlcnZpY2UucHJvdG90eXBlLnVuaXEgPSBmdW5jdGlvbihhcnJheSl7XG4gICAgcmV0dXJuIGFycmF5LmZpbHRlcihcbiAgICAgICAgZnVuY3Rpb24gKGEpIHsgcmV0dXJuICF0aGlzW2FdID8gdGhpc1thXSA9IHRydWUgOiBmYWxzZTsgfSwge31cbiAgICApO1xufTtcblxuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuYWRyb2xsID0gZnVuY3Rpb24oaSwgaW5kZXgpe1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICB2YXIgaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XG4gICAgICAgIGlmcmFtZS5zdHlsZS5jc3NUZXh0ID0gJ3dpZHRoOjFweDsgaGVpZ2h0OjFweDsgZGlzcGxheTpub25lOyc7XG4gICAgICAgIGlmcmFtZS5mcmFtZWJvcmRlciA9IDA7XG4gICAgICAgIHZhciBodG1sID0gJzxzY3JpcHQgdHlwZT1cInRleHQvamF2YXNjcmlwdFwiPic7XG4gICAgICAgIGh0bWwgKz0gJ2Fkcm9sbF9hZHZfaWQ9XCInICsgaS5hZHZlcnRpc2FibGVJZDtcbiAgICAgICAgaHRtbCArPSAnXCI7YWRyb2xsX3BpeF9pZD1cIicgKyBpLmFkcm9sbFBpeGVsSWQ7XG4gICAgICAgIGh0bWwgKz0gJ1wiOyhmdW5jdGlvbiAoKSB7JztcbiAgICAgICAgaHRtbCArPSAndmFyIG9sZG9ubG9hZCA9IHdpbmRvdy5vbmxvYWQ7JztcbiAgICAgICAgaHRtbCArPSAnd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsnO1xuICAgICAgICBodG1sICs9ICdfX2Fkcm9sbF9sb2FkZWQgPSB0cnVlOyc7XG4gICAgICAgIGh0bWwgKz0gJ3ZhciBzY3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpOyc7XG4gICAgICAgIGh0bWwgKz0gJ3ZhciBob3N0ID0gKChcImh0dHBzOlwiID09IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sKSA/IFwiaHR0cHM6Ly9zLmFkcm9sbC5jb21cIiA6IFwiaHR0cDovL2EuYWRyb2xsLmNvbVwiKTsnO1xuICAgICAgICBodG1sICs9ICdzY3Iuc2V0QXR0cmlidXRlKFxcJ2FzeW5jXFwnLCBcXCd0cnVlXFwnKTsnO1xuICAgICAgICBodG1sICs9ICdzY3IudHlwZSA9IFwidGV4dC9qYXZhc2NyaXB0XCI7JztcbiAgICAgICAgaHRtbCArPSAnc2NyLnNyYyA9IGhvc3QgKyBcIi9qL3JvdW5kdHJpcC5qc1wiOyc7XG4gICAgICAgIGh0bWwgKz0gJygoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXFwnaGVhZFxcJykgfHwgW251bGxdKVswXSB8fCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcXCdzY3JpcHRcXCcpWzBdLnBhcmVudE5vZGUpLmFwcGVuZENoaWxkKHNjcik7JztcbiAgICAgICAgaHRtbCArPSAnaWYgKG9sZG9ubG9hZCkge29sZG9ubG9hZCgpfSc7XG4gICAgICAgIGh0bWwgKz0gICd9O30oKSk7PC9zY3JpcHQ+JztcblxuICAgICAgICBpZihpLnNlZ21lbnROYW1lKXtcbiAgICAgICAgICAgIGh0bWwgKz0gJzxzY3JpcHQgdHlwZT1cInRleHQvamF2YXNjcmlwdFwiPic7XG4gICAgICAgICAgICBodG1sICs9ICdhZHJvbGxfc2VnbWVudHMgPSBcIicgKyBpLnNlZ21lbnROYW1lICsnXCInO1xuICAgICAgICAgICAgaHRtbCArPSAnOzwvc2NyaXB0Pic7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcsc2VsZi5jb25maWcuZGF0YSkpIHtcbiAgICAgICAgICAgIGh0bWwgKz0gJzxzY3JpcHQgdHlwZT1cInRleHQvamF2YXNjcmlwdFwiPic7XG4gICAgICAgICAgICBodG1sICs9ICdhZHJvbGxfY29udmVyc2lvbl92YWx1ZSA9JyArIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRvdGFsLmJhc2VQcmljZScsc2VsZi5jb25maWcuZGF0YSk7XG4gICAgICAgICAgICBodG1sICs9ICc7YWRyb2xsX2N1cnJlbmN5ID0gXCInICsgKHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRvdGFsLmN1cnJlbmN5JykgfHwgJ1VTRCcpO1xuICAgICAgICAgICAgaHRtbCArPSAnXCI7PC9zY3JpcHQ+JztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpLmN1c3RvbVZhcmlhYmxlcykge1xuICAgICAgICAgICAgdmFyIGN1c3QgPSB7fTtcbiAgICAgICAgICAgIHZhciB1ID0gaS5jdXN0b21WYXJpYWJsZXM7XG4gICAgICAgICAgICBmb3IgKHZhciBpIGluIHUpIHtcbiAgICAgICAgICAgICAgICBpZiAodS5oYXNPd25Qcm9wZXJ0eShpKSkge1xuICAgICAgICAgICAgICAgICAgICBjdXN0W2ldID0gc2VsZi5nZXRWYWx1ZSh1W2ldLHNlbGYuY29uZmlnLmRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaHRtbCArPSAnPHNjcmlwdCB0eXBlPVwidGV4dC9qYXZhc2NyaXB0XCI+JztcbiAgICAgICAgICAgIGh0bWwgKz0gJ2Fkcm9sbF9jdXN0b21fZGF0YSA9ICc7XG4gICAgICAgICAgICBodG1sICs9IEpTT04uc3RyaW5naWZ5KGN1c3QpO1xuICAgICAgICAgICAgaHRtbCArPSAnPC9zY3JpcHQ+JztcblxuICAgICAgICB9XG5cbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChpZnJhbWUpO1xuICAgICAgICB2YXIgZG9jID0gKGlmcmFtZS5jb250ZW50V2luZG93IHx8IGlmcmFtZS5jb250ZW50RG9jdW1lbnQpO1xuXHRcdGlmIChkb2MuZG9jdW1lbnQpZG9jID0gZG9jLmRvY3VtZW50O1xuICAgIFx0ZG9jLm9wZW4oKTtcbiAgICAgICAgZG9jLndyaXRlKGh0bWwpO1xuICAgICAgICBkb2MuY2xvc2UoKTtcblxuXG59O1xuXG5WZW5kb3JTZXJ2aWNlLnByb3RvdHlwZS5iaW5nVjIgPSBmdW5jdGlvbiAodGFnLCBpbmRleCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICB2YXIgaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XG4gICAgICAgIGlmcmFtZS5zdHlsZS5jc3NUZXh0ID0gJ3dpZHRoOjFweDsgaGVpZ2h0OjFweDsgZGlzcGxheTpub25lOyc7XG4gICAgICAgIGlmcmFtZS5mcmFtZWJvcmRlciA9IDA7XG4gICAgICAgIGlmcmFtZS5pZCA9IHRhZy5pZDtcbiAgICAgICAgdmFyIGh0bWwgPSAnPHNjcmlwdCB0eXBlPVwidGV4dC9qYXZhc2NyaXB0XCI+JztcbiAgICAgICAgIGh0bWwgKz0gJyhmdW5jdGlvbih3LGQsdCxyLHUpe3ZhciBmLG4saTt3W3VdPXdbdV18fFtdICxmPWZ1bmN0aW9uKCl7dmFyIG89e3RpOlwiJyArIHRhZy50YWdJZCArICdcIn07IG8ucT13W3VdLHdbdV09bmV3IFVFVChvKSx3W3VdLnB1c2goXCJwYWdlTG9hZFwiKX0gLG49ZC5jcmVhdGVFbGVtZW50KHQpLG4uc3JjPXIsbi5hc3luYz0xLG4ub25sb2FkPW4gLm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpIHt2YXIgcz10aGlzLnJlYWR5U3RhdGU7cyAmJnMhPT1cImxvYWRlZFwiJiYgcyE9PVwiY29tcGxldGVcInx8KGYoKSxuLm9ubG9hZD1uLiBvbnJlYWR5c3RhdGVjaGFuZ2U9bnVsbCl9LGk9IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUodClbMF0saS4gcGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobixpKX0pKHdpbmRvdyxkb2N1bWVudCxcInNjcmlwdFwiLFwiIC8vYmF0LmJpbmcuY29tL2JhdC5qc1wiLFwidWV0cVwiKTsgJztcbiAgICAgICAgaHRtbCArPSAnd2luZG93LnVldHEgPSB3aW5kb3cudWV0cSB8fCBbXTsnO1xuXG4gICAgICAgIGlmIChzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50cmFuc2FjdGlvbklEJyxzZWxmLmNvbmZpZy5kYXRhKSkge1xuICAgICAgICAgICAgaHRtbCArPSAnd2luZG93LnVldHEucHVzaChcImV2ZW50XCIsIFwiXCIsIHtcInJldmVudWVfdmFsdWVcIjogJyArIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRvdGFsLmJhc2VQcmljZScpICsgJywgXCJjdXJyZW5jeVwiOiBcIicgKyBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5jdXJyZW5jeScpICsgJ1wifSk7ICc7XG4gICAgICAgIH1cblxuICAgICAgICBodG1sICs9ICAnPC9zY3JpcHQ+JztcblxuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGlmcmFtZSk7XG4gICAgICAgIHZhciBkb2MgPSAoaWZyYW1lLmNvbnRlbnRXaW5kb3cgfHwgaWZyYW1lLmNvbnRlbnREb2N1bWVudCk7XG5cdFx0aWYgKGRvYy5kb2N1bWVudClkb2MgPSBkb2MuZG9jdW1lbnQ7XG4gICAgXHRkb2Mub3BlbigpO1xuICAgICAgICBkb2Mud3JpdGUoaHRtbCk7XG4gICAgICAgIGRvYy5jbG9zZSgpO1xufTtcblxuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuYmluZyA9IGZ1bmN0aW9uICh0YWcsIGluZGV4KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgdGFnSWQgPSB0YWcudGFnSWQ7XG5cbiAgICAgICAgICAgIChmdW5jdGlvbiAodywgZCwgdCwgciwgdSkge1xuICAgICAgICAgICAgICAgIHZhciBmLCBuLCBpO1xuICAgICAgICAgICAgICAgIHdbdV0gPSB3W3VdIHx8IFtdLCBmID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IHt0aTogdGFnSWR9O1xuICAgICAgICAgICAgICAgICAgICBvLnEgPSB3W3VdLCB3W3VdID0gbmV3IFVFVChvKSwgd1t1XS5wdXNoKFwicGFnZUxvYWRcIilcbiAgICAgICAgICAgICAgICB9LCBuID0gZC5jcmVhdGVFbGVtZW50KHQpLCBuLnNyYyA9IHIsIG4uYXN5bmMgPSAxLCBuLm9ubG9hZCA9XG4gICAgICAgICAgICAgICAgICAgIG4ub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSB0aGlzLnJlYWR5U3RhdGU7XG4gICAgICAgICAgICAgICAgICAgICAgICBzICYmIHMgIT09IFwibG9hZGVkXCIgJiYgcyAhPT0gXCJjb21wbGV0ZVwiIHx8IChmKCksIG4ub25sb2FkID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLCBpID0gZC5nZXRFbGVtZW50c0J5VGFnTmFtZSh0KVswXSwgaS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShuLCBpKVxuICAgICAgICAgICAgfSkod2luZG93LCBkb2N1bWVudCwgXCJzY3JpcHRcIiwgXCIvL2JhdC5iaW5nLmNvbS9iYXQuanNcIiwgXCJ1ZXRxXCIpO1xuXG59O1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuY2VudHJvID0gZnVuY3Rpb24odGFnLCBpbmRleCkge1xuXHR2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB2YXIgc3JjID0gc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcpID8gJy8vY2xpY2tzZXJ2LnBpeGVsLmFkL2NvbnYvJyArIHRhZy5jb252ZXJzaW9uSWQgKyAnLycgKyBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5iYXNlUHJpY2UnKVxuICAgICAgICA6ICgnLy9jZW50cm8ucGl4ZWwuYWQvaWFwLycgKyB0YWcuY29udmVyc2lvbklkKTtcbiAgICBzZWxmLmNyZWF0ZUVsZW0oJ2ltZycsIHNyYywgdGFnLmlkKTtcbn07XG5cblZlbmRvclNlcnZpY2UucHJvdG90eXBlLmh0bWxTbmlwcGV0ID0gZnVuY3Rpb24gKHRhZywgaW5kZXgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB2YXIgdmFyaWFibGVNYXAgPSB7XG4gICAgICAgICckYXJ0aXN0X2lkJCc6ICAgICAgICAgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmFydGlzdElEJyksXG4gICAgICAgICckYXJ0aXN0X25hbWUkJzogICAgICAgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmFydGlzdE5hbWUnKSxcbiAgICAgICAgJyRicmFuZCQnOiAgICAgICAgICAgICBzZWxmLmdldFZhbHVlKCdicmFuZCcpLFxuICAgICAgICAnJGNmYyQnOiAgICAgICAgICAgICAgIHNlbGYuZ2V0VmFsdWUoJ2NmYycpLFxuICAgICAgICAnJGNsaWVudF9pZCQnOiAgICAgICAgIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5jbGllbnRJRCcpLFxuICAgICAgICAnJGRvY3VtZW50X3JlZmVycmVyJCc6IGRvY3VtZW50LnJlZmVycmVyLFxuICAgICAgICAnJGRvY3VtZW50X2hyZWYkJzogICAgIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYsXG4gICAgICAgICckZXZlbnRfZGF0ZSQnOiAgICAgICAgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmV2ZW50RGF0ZScpLFxuICAgICAgICAnJGV2ZW50X2lkJCc6ICAgICAgICAgIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudElEJyksXG4gICAgICAgICckZXZlbnRfbmFtZSQnOiAgICAgICAgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmV2ZW50TmFtZScpLnJlcGxhY2UoL1xceDI3L2csICdcXFxcXFx4MjcnKSxcbiAgICAgICAgJyRldmVudF90aW1lJCc6ICAgICAgICBzZWxmLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMuZXZlbnRUaW1lJyksXG4gICAgICAgICckbGFuZ3VhZ2UkJzogICAgICAgICAgc2VsZi5nZXRWYWx1ZSgncGFnZS5wYWdlSW5mby5sYW5ndWFnZScpLFxuICAgICAgICAnJGludmVudG9yeV90eXBlJCc6ICAgICggcGFyc2VJbnQoc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24uYXR0cmlidXRlcy5pc1Jlc2FsZScpICsgMCkgIT09IDAgKSA/ICdyZXNhbGUnIDogJ3ByaW1hcnknLFxuICAgICAgICAnJG1ham9yX2NhdGVnb3J5JCc6ICAgIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuY2F0ZWdvcnkucHJpbWFyeUNhdGVnb3J5JyksXG4gICAgICAgICckbWFqb3JfY2F0ZWdvcnlfaWQkJzogc2VsZi5nZXRWYWx1ZSgncGFnZS5jYXRlZ29yeS5wcmltYXJ5Q2F0ZWdvcnlJRCcpLFxuICAgICAgICAnJG1pbm9yX2NhdGVnb3J5JCc6ICAgIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuY2F0ZWdvcnkuc3ViQ2F0ZWdvcnkxJyksXG4gICAgICAgICckbWlub3JfY2F0ZWdvcnlfaWQkJzogc2VsZi5nZXRWYWx1ZSgncGFnZS5jYXRlZ29yeS5zdWJDYXRlZ29yeTFJRCcpLFxuICAgICAgICAnJG1sYl9wcm9kdWN0X3N0cmluZyQnOnNlbGYuZ2V0VmFsdWUoJ21sYlByb2R1Y3RTdHJpbmcnKSxcbiAgICAgICAgJyRmYWNlX3ZhbHVlJCc6ICAgICAgICBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5iYXNlUHJpY2UnKSxcbiAgICAgICAgJyRvcmRlcl9mZWVzJCc6ICAgICAgICBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5mZWVzVG90YWwnKSxcbiAgICAgICAgJyRvcmRlcl9pZCQnOiAgICAgICAgICBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50cmFuc2FjdGlvbklEJyksXG4gICAgICAgICckb3JkZXJfc3RhdGUkJzogICAgICAgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24ucHJvZmlsZS5hZGRyZXNzLnN0YXRlUHJvdmluY2UnKSxcbiAgICAgICAgJyRvcmRlcl9jb3VudHJ5JCc6ICAgICBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi5wcm9maWxlLmFkZHJlc3MuY291bnRyeScpLFxuICAgICAgICAnJHRpY2tldF9xdWFudGl0eSQnOiAgIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLmF0dHJpYnV0ZXMudGlja2V0UXVhbnRpdHknKSxcbiAgICAgICAgJyRvcmRlcl9jdXJyZW5jeSQnOiAgICBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5jdXJyZW5jeScpLFxuICAgICAgICAnJG9yZGVyX2RhdGUkJzogICAgICAgIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLmF0dHJpYnV0ZXMub3JkZXJEYXRlJyksXG4gICAgICAgICckb3JkZXJfdGltZSQnOiAgICAgICAgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24uYXR0cmlidXRlcy5vcmRlclRpbWUnKSxcbiAgICAgICAgJyRvcmRlcl96aXAkJzogICAgICAgICBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi5wcm9maWxlLmFkZHJlc3MucG9zdGFsQ29kZScpLFxuICAgICAgICAnJHBhZ2VfbmFtZSQnOiAgICAgICAgIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UucGFnZUluZm8ucGFnZU5hbWUnKSxcbiAgICAgICAgJyRyYW5kb20kJzogICAgICAgICAgICBNYXRoLnJhbmRvbSgpICogMTAwMDAwMDAwMCxcbiAgICAgICAgJyR0cmFuc2FjdGlvbl90b3RhbCQnOiBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC50cmFuc2FjdGlvblRvdGFsJyksXG4gICAgICAgICckdmVudWVfY291bnRyeSQnOiAgICAgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmNvdW50cnknKSxcbiAgICAgICAgJyR2ZW51ZV9pZCQnOiAgICAgICAgICBzZWxmLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMudmVudWVJRCcpLFxuICAgICAgICAnJHZlbnVlX25hbWUkJzogICAgICAgIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy52ZW51ZU5hbWUnKS5yZXBsYWNlKC9cXHgyNy9nLCAnXFxcXFxceDI3JyksXG4gICAgICAgICckdmVudWVfemlwJCc6ICAgICAgICAgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLnppcCcpLFxuICAgICAgICAnJGV2ZW50X3RpbWVfem9uZSQnOiAgICcnLFxuICAgICAgICAnJHByb2R1Y3RfZGF0YV9qc29uJCc6IHNlbGYuZ2V0VmFsdWUoJ3Byb2R1Y3REYXRhSnNvbicpXG4gICAgfTtcblxuICAgIHZhciByZWZTY3JpcHQgPSAnPGhlYWQ+PHNjcmlwdD4nICtcbiAgICAgICAgICAgICAgICAgICAgJ09iamVjdC5kZWZpbmVQcm9wZXJ0eShkb2N1bWVudCwgXCJyZWZlcnJlclwiLCB7ICcgK1xuICAgICAgICAgICAgICAgICAgICAnZ2V0IDogZnVuY3Rpb24oKSB7ICcgK1xuICAgICAgICAgICAgICAgICAgICAncmV0dXJuIFxcJycgKyBkb2N1bWVudC5yZWZlcnJlciArICdcXCc7ICcgK1xuICAgICAgICAgICAgICAgICAgICAnfScgK1xuICAgICAgICAgICAgICAgICAgICAnfSk7JyArXG4gICAgICAgICAgICAgICAgICAgICc8L3NjcmlwdD48L2hlYWQ+PGJvZHk+JHt0YWcuaHRtbH08L2JvZHk+JztcblxuICAgIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHtcbiAgICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bXFwtXFxbXFxdXFwvXFx7XFx9XFwoXFwpXFwqXFwrXFw/XFwuXFxcXFxcXlxcJFxcfFxcJ10vZywgJ1xcXFwkJicpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNsZWFudXBTdHJpbmcoc3RyKSB7XG4gICAgICAgIGlmKHN0ci5yZXBsYWNlKSB7XG4gICAgICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoL1tcXFtcXF1cXCRcXCddL2csICcnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzdHI7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLy9yZXBsYWNlIGFsbCBvZiB0aGUgJC4uLiQgaHRtbCBzdHJpbmdzIHdpdGggdGhlaXIgYWN0dWFsIHZhbHVlc1xuICAgIHZhciB2YXJpYWJsZXNUb1JlcGxhY2UgPSBPYmplY3Qua2V5cyh2YXJpYWJsZU1hcCk7XG4gICAgdmFyaWFibGVzVG9SZXBsYWNlLmZvckVhY2goZnVuY3Rpb24gKHZhcmlhYmxlTmFtZSwgaW5kZXgpIHtcbiAgICAgICAgdGFnLmh0bWwgPSB0YWcuaHRtbC5yZXBsYWNlKG5ldyBSZWdFeHAoZXNjYXBlUmVnRXhwKHZhcmlhYmxlTmFtZSksICdnaScpLCB0eXBlb2YgdmFyaWFibGVNYXBbdmFyaWFibGVOYW1lXSAhPT0gJ3VuZGVmaW5lZCcgPyBjbGVhbnVwU3RyaW5nKHZhcmlhYmxlTWFwW3ZhcmlhYmxlTmFtZV0pIDogJycpO1xuICAgIH0pO1xuXG4gICAgdmFyIGlmcmFtZSAgICAgICAgICAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTtcbiAgICBpZnJhbWUuaWQgICAgICAgICAgICA9IHRhZy5pZDtcbiAgICBpZnJhbWUuc3R5bGUuY3NzVGV4dCA9ICd3aWR0aDoxcHg7IGhlaWdodDoxcHg7IGRpc3BsYXk6bm9uZTsnO1xuICAgIGlmcmFtZS5mcmFtZWJvcmRlciAgID0gMDtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGlmcmFtZSk7XG4gICAgdmFyIGRvYyA9IChpZnJhbWUuY29udGVudFdpbmRvdyB8fCBpZnJhbWUuY29udGVudERvY3VtZW50KTtcbiAgICBpZiAoIGRvYy5kb2N1bWVudCApIHtcbiAgICAgICAgZG9jID0gZG9jLmRvY3VtZW50O1xuICAgIH1cbiAgICBkb2Mub3BlbigpO1xuICAgIGRvYy53cml0ZShyZWZTY3JpcHQucmVwbGFjZSgnJHt0YWcuaHRtbH0nLCB0YWcuaHRtbCkpO1xuICAgIGRvYy5jbG9zZSgpO1xuXG59O1xuXG5WZW5kb3JTZXJ2aWNlLnByb3RvdHlwZS5jdXN0b20gPSBmdW5jdGlvbih0YWcsIGluZGV4KSB7XG5cdHZhciBzZWxmID0gdGhpcztcblxuXHR2YXIgc3JjO1xuXHRcdGlmKHRhZy51cmwuaW5kZXhPZignaHR0cDonKSA9PT0gLTEpIHtcblx0XHRcdHNyYyA9IHRhZy51cmw7XG5cdFx0XHRpZiAoIHR5cGVvZiB0YWcuY3VzdG9tVmFyaWFibGVzICE9PSAndW5kZWZpbmVkJyApIHtcblx0XHRcdFx0aWYgKCBzcmMuaW5kZXhPZignPycpID4gLTEgKVxuXHRcdFx0XHRcdHNyYyArPSAnJic7XG5cdFx0XHRcdGVsc2Vcblx0XHRcdFx0XHRzcmMgKz0gJz8nO1xuXHRcdFx0XHR2YXIgdSA9IHRhZy5jdXN0b21WYXJpYWJsZXM7XG5cdFx0XHRcdGZvciAoIHZhciBqIGluIHUgKSB7XG5cdFx0XHRcdFx0aWYgKCB1Lmhhc093blByb3BlcnR5KGopICkge1xuXHRcdFx0XHRcdFx0c3JjICs9IGogKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQoc2VsZi5nZXRWYWx1ZSh1WyBqIF0sIHNlbGYuY29uZmlnLmRhdGEpKSArICcmJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0Ly90cmltIG9mZiB0aGUgdHJhaWxpbmcgPyBvciAmXG5cdFx0XHRcdHNyYyA9IHNyYy5zdWJzdHJpbmcoMCwgc3JjLmxlbmd0aCAtIDEpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIHRhZy50YWdUeXBlICE9PSAnU0NSSVBUJyApIHtcblx0XHRcdFx0Ly9JTUcgb3IgSUZSQU1FXG5cdFx0XHRcdHNlbGYuY3JlYXRlRWxlbSh0YWcudGFnVHlwZSwgc3JjLCB0YWcuaWQpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dmFyIHNjcnB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG5cdFx0XHRcdHNjcnB0LnNyYyA9IHNyYztcblx0XHRcdFx0c2VsZi5jcmVhdGVFbGVtKCdpZnJhbWUnLCBcIlwiLCB0YWcuaWQsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHZhciBkb2MgPSB0aGlzLmNvbnRlbnRXaW5kb3cgfHwgdGhpcy5jb250ZW50RG9jdW1lbnQ7XG5cdFx0XHRcdFx0ZG9jID0gZG9jLmRvY3VtZW50IHx8IGRvYztcblx0XHRcdFx0XHR2YXIgaGVhZCA9IGRvYy5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbIDAgXTtcblx0XHRcdFx0XHRoZWFkLmFwcGVuZENoaWxkKHNjcnB0KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG59O1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuZG91YmxlY2xpY2tGbG9vZGxpZ2h0Q291bnRlciA9IGZ1bmN0aW9uICh0YWcsIGluZGV4KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdGFnLmZsb29kbGlnaHRJZCA9IHRhZy5hZHZlcnRpc2VySWQ7XG5cbiAgICAvL2ZvciBldmVyeSB0YWcsIGxvYWQgZ3RtIGFuZCBmaXJlIGd0YWcgY29uZmlnXG4gICAgdmFyIGh0bWwgPSAnPHNjcmlwdCBhc3luYyBzcmM9XCJodHRwczovL3d3dy5nb29nbGV0YWdtYW5hZ2VyLmNvbS9ndGFnL2pzP2lkPURDLScgKyB0YWcuZmxvb2RsaWdodElkICsgJ1wiPjwvc2NyaXB0Pic7XG4gICAgaHRtbCArPSAnPHNjcmlwdD4nO1xuICAgIGh0bWwgKz0gJ3dpbmRvdy5kYXRhTGF5ZXIgPSB3aW5kb3cuZGF0YUxheWVyIHx8IFtdOyc7XG4gICAgaHRtbCArPSAnZnVuY3Rpb24gZ3RhZygpe2RhdGFMYXllci5wdXNoKGFyZ3VtZW50cyk7fSc7XG4gICAgaHRtbCArPSAnZ3RhZyhcXCdqc1xcJywgbmV3IERhdGUoKSk7JztcbiAgICBodG1sICs9ICdndGFnKFxcJ2NvbmZpZ1xcJywgXFwnREMtJyArIHRhZy5mbG9vZGxpZ2h0SWQgKyAnXFwnKTsnO1xuXG4gICAgaHRtbCArPSAnZ3RhZyhcXCdldmVudFxcJywgXFwnY29udmVyc2lvblxcJywge1xcJ3NlbmRfdG9cXCc6IFxcJ0RDLScgKyB0YWcuYWR2ZXJ0aXNlcklkICsgJy8nXG4gICAgICAgICsgdGFnLmdyb3VwVGFnU3RyaW5nICsgJy8nICsgdGFnLmFjdGl2aXR5VGFnU3RyaW5nICsgJysnICsgdGFnLmNvdW50aW5nTWV0aG9kLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSArICdcXCcnO1xuICAgIGh0bWwgKz0gJywgXFwnYWxsb3dfY3VzdG9tX3NjcmlwdHNcXCc6IFxcJycgKyAnZmFsc2UnICsgJ1xcJyc7XG5cbiAgICBpZiAodHlwZW9mIHRhZy5jdXN0b21WYXJpYWJsZXMgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHZhciB1ID0gdGFnLmN1c3RvbVZhcmlhYmxlcztcbiAgICAgICAgZm9yICh2YXIgaSBpbiB1KSB7XG4gICAgICAgICAgICBpZiAodS5oYXNPd25Qcm9wZXJ0eShpKSkge1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHNlbGYuZ2V0VmFsdWUodVtpXSwgc2VsZi5jb25maWcuZGF0YSk7XG4gICAgICAgICAgICAgICAgaHRtbCArPSAnLCBcXCcnICsgaSArICdcXCc6IFxcJycgKyB2YWx1ZSArICdcXCcnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGh0bWwgKz0gJ30pOyc7XG4gICAgaHRtbCArPSAnPC9zY3JpcHQ+JztcblxuICAgIHNlbGYuY3JlYXRlSWZyYW1lV2l0aENvbnRlbnQodGFnLmlkLCBodG1sLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYubG9nKCdJZnJhbWUgYWRkZWQgZm9yIHBpeGVsOiAnICsgdGFnLmlkKTtcbiAgICB9KTtcbn1cblxuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuZG91YmxlY2xpY2tGbG9vZGxpZ2h0U2FsZXMgPSBmdW5jdGlvbiAodGFnLCBpbmRleCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHRhZy5mbG9vZGxpZ2h0SWQgPSB0YWcuYWR2ZXJ0aXNlcklkO1xuXG4gICAgLy9mb3IgZXZlcnkgdGFnLCBsb2FkIGd0bSBhbmQgZmlyZSBndGFnIGNvbmZpZ1xuICAgIHZhciBodG1sID0gJzxzY3JpcHQgYXN5bmMgc3JjPVwiaHR0cHM6Ly93d3cuZ29vZ2xldGFnbWFuYWdlci5jb20vZ3RhZy9qcz9pZD1EQy0nICsgdGFnLmZsb29kbGlnaHRJZCArICdcIj48L3NjcmlwdD4nO1xuICAgIGh0bWwgKz0gJzxzY3JpcHQ+JztcbiAgICBodG1sICs9ICd3aW5kb3cuZGF0YUxheWVyID0gd2luZG93LmRhdGFMYXllciB8fCBbXTsnO1xuICAgIGh0bWwgKz0gJ2Z1bmN0aW9uIGd0YWcoKXtkYXRhTGF5ZXIucHVzaChhcmd1bWVudHMpO30nO1xuICAgIGh0bWwgKz0gJ2d0YWcoXFwnanNcXCcsIG5ldyBEYXRlKCkpOyc7XG4gICAgaHRtbCArPSAnZ3RhZyhcXCdjb25maWdcXCcsIFxcJ0RDLScgKyB0YWcuZmxvb2RsaWdodElkICsgJ1xcJyk7JztcblxuICAgIGh0bWwgKz0gJ2d0YWcoXFwnZXZlbnRcXCcsIFxcJ3B1cmNoYXNlXFwnLCB7XFwnc2VuZF90b1xcJzogXFwnREMtJyArIHRhZy5hZHZlcnRpc2VySWQgKyAnLydcbiAgICAgICAgKyB0YWcuZ3JvdXBUYWdTdHJpbmcgKyAnLycgKyB0YWcuYWN0aXZpdHlUYWdTdHJpbmcgKyAnKycgKyB0YWcuY291bnRpbmdNZXRob2QudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpICsgJ1xcJyc7XG4gICAgaHRtbCArPSAnLCBcXCdhbGxvd19jdXN0b21fc2NyaXB0c1xcJzogXFwnJyArICdmYWxzZScgKyAnXFwnJztcblxuICAgIGlmICggc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcsIHNlbGYuY29uZmlnLmRhdGEpICkge1xuICAgICAgICBodG1sICs9ICcsIFxcJ3ZhbHVlXFwnOicgKyBzZWxmLnRvRmxvYXQoc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udG90YWwuYmFzZVByaWNlJykgLCAwKTtcbiAgICAgICAgaHRtbCArPSAnLCBcXCdxdWFudGl0eVxcJzonO1xuICAgICAgICBodG1sICs9IHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLmF0dHJpYnV0ZXMudGlja2V0UXVhbnRpdHknLCBzZWxmLmNvbmZpZy5kYXRhKTtcbiAgICAgICAgaHRtbCArPSAnLCBcXCdjdXJyZW5jeVxcJzogXFwnJyArIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRvdGFsLmN1cnJlbmN5JykgKyAnXFwnJztcbiAgICAgICAgaHRtbCArPSAnLCBcXCd0cmFuc2FjdGlvbl9pZFxcJzogXFwnJyArIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnKSArICdcXCcnO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHRhZy5jdXN0b21WYXJpYWJsZXMgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHZhciB1ID0gdGFnLmN1c3RvbVZhcmlhYmxlcztcbiAgICAgICAgZm9yICh2YXIgaSBpbiB1KSB7XG4gICAgICAgICAgICBpZiAodS5oYXNPd25Qcm9wZXJ0eShpKSkge1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHNlbGYuZ2V0VmFsdWUodVtpXSwgc2VsZi5jb25maWcuZGF0YSk7XG4gICAgICAgICAgICAgICAgaHRtbCArPSAnLCBcXCcnICsgaSArICdcXCc6IFxcJycgKyB2YWx1ZSArICdcXCcnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGh0bWwgKz0gJ30pOyc7XG4gICAgaHRtbCArPSAnPC9zY3JpcHQ+JztcblxuICAgIHNlbGYuY3JlYXRlSWZyYW1lV2l0aENvbnRlbnQodGFnLmlkLCBodG1sLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYubG9nKCdJZnJhbWUgYWRkZWQgZm9yIHBpeGVsOiAnICsgdGFnLmlkKTtcbiAgICB9KTtcbn07XG5cblZlbmRvclNlcnZpY2UucHJvdG90eXBlLmRvdWJsZWNsaWNrR3RhZ0V2ZW50ID0gZnVuY3Rpb24gKHRhZywgaW5kZXgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB0YWcuZmxvb2RsaWdodElkID0gdGFnLnNlbmRUby5zcGxpdCgnLycpWzBdO1xuXG4gICAgLy9mb3IgZXZlcnkgdGFnLCBsb2FkIGd0bSBhbmQgZmlyZSBndGFnIGNvbmZpZ1xuICAgIHZhciBodG1sID0gJzxzY3JpcHQgYXN5bmMgc3JjPVwiaHR0cHM6Ly93d3cuZ29vZ2xldGFnbWFuYWdlci5jb20vZ3RhZy9qcz9pZD0nICsgdGFnLmZsb29kbGlnaHRJZCArICdcIj48L3NjcmlwdD4nO1xuICAgIGh0bWwgKz0gJzxzY3JpcHQ+JztcbiAgICBodG1sICs9ICd3aW5kb3cuZGF0YUxheWVyID0gd2luZG93LmRhdGFMYXllciB8fCBbXTsnO1xuICAgIGh0bWwgKz0gJ2Z1bmN0aW9uIGd0YWcoKXtkYXRhTGF5ZXIucHVzaChhcmd1bWVudHMpO30nO1xuICAgIGh0bWwgKz0gJ2d0YWcoXFwnanNcXCcsIG5ldyBEYXRlKCkpOyc7XG4gICAgaHRtbCArPSAnZ3RhZyhcXCdjb25maWdcXCcsIFxcJycgKyB0YWcuZmxvb2RsaWdodElkICsgJ1xcJyk7JztcbiAgICBcbiAgICBpZiAodGFnLnNlbmRUby5pbmRleE9mKCd0cmFuc2FjdGlvbnMnKSAhPT0gLTEgfHwgdGFnLnNlbmRUby5pbmRleE9mKCdpdGVtc19zb2xkJykgIT09IC0xKSB7XG4gICAgICAgIGh0bWwgKz0gJ2d0YWcoXFwnZXZlbnRcXCcsIFxcJ3B1cmNoYXNlXFwnLCB7XFwnc2VuZF90b1xcJzogXFwnJyArIHRhZy5zZW5kVG8gKyAnXFwnJztcbiAgICB9IGVsc2Uge1xuICAgICAgICBodG1sICs9ICdndGFnKFxcJ2V2ZW50XFwnLCBcXCdjb252ZXJzaW9uXFwnLCB7XFwnc2VuZF90b1xcJzogXFwnJyArIHRhZy5zZW5kVG8gKyAnXFwnJztcbiAgICB9XG4gICAgaHRtbCArPSAnLCBcXCdhbGxvd19jdXN0b21fc2NyaXB0c1xcJzogXFwnJyArICdmYWxzZScgKyAnXFwnJztcbiAgICBcbiAgICBpZiAoICh0YWcuc2VuZFRvLmluZGV4T2YoJ3RyYW5zYWN0aW9ucycpICE9PSAtMSB8fCB0YWcuc2VuZFRvLmluZGV4T2YoJ2l0ZW1zX3NvbGQnKSAhPT0gLTEpXG4gICAgICAgICYmIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnLCBzZWxmLmNvbmZpZy5kYXRhKSkge1xuICAgICAgICAgICAgaHRtbCArPSAnLCBcXCd2YWx1ZVxcJzonICsgc2VsZi50b0Zsb2F0KHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRvdGFsLmJhc2VQcmljZScpICwgMCk7XG4gICAgICAgICAgICBodG1sICs9ICcsIFxcJ3F1YW50aXR5XFwnOic7XG4gICAgICAgICAgICBodG1sICs9IHRhZy5zZW5kVG8uaW5kZXhPZigndHJhbnNhY3Rpb25zJykgIT09IC0xID8gMSA6IHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLmF0dHJpYnV0ZXMudGlja2V0UXVhbnRpdHknLCBzZWxmLmNvbmZpZy5kYXRhKTtcbiAgICAgICAgICAgIGh0bWwgKz0gJywgXFwnY3VycmVuY3lcXCc6IFxcJycgKyBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5jdXJyZW5jeScpICsgJ1xcJyc7XG4gICAgICAgICAgICBodG1sICs9ICcsIFxcJ3RyYW5zYWN0aW9uX2lkXFwnOiBcXCcnICsgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcpICsgJ1xcJyc7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgdGFnLmN1c3RvbVZhcmlhYmxlcyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdmFyIHUgPSB0YWcuY3VzdG9tVmFyaWFibGVzO1xuICAgICAgICBmb3IgKHZhciBpIGluIHUpIHtcbiAgICAgICAgICAgIGlmICh1Lmhhc093blByb3BlcnR5KGkpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gc2VsZi5nZXRWYWx1ZSh1W2ldLCBzZWxmLmNvbmZpZy5kYXRhKTtcbiAgICAgICAgICAgICAgICBodG1sICs9ICcsIFxcJycgKyBpICsgJ1xcJzogXFwnJyArIHZhbHVlICsgJ1xcJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgaHRtbCArPSAnfSk7JztcbiAgICBodG1sICs9ICc8L3NjcmlwdD4nO1xuXG4gICAgc2VsZi5jcmVhdGVJZnJhbWVXaXRoQ29udGVudCh0YWcuaWQsIGh0bWwsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2VsZi5sb2coJ0lmcmFtZSBhZGRlZCBmb3IgcGl4ZWw6ICcgKyB0YWcuaWQpO1xuICAgIH0pO1xufTtcblxuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuZG91YmxlY2xpY2tQdWJsaXNoZXJzQ29udmVyc2lvbiA9IGZ1bmN0aW9uIChpLCBpbmRleCkge1xuXHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0dmFyIGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuXHRpbWcuc3JjID0gJ2h0dHBzOi8vcHViYWRzLmcuZG91YmxlY2xpY2submV0L2FjdGl2aXR5O3hzcD0nICsgaS5wdWJsaXNoZXJJZDtcblxuXG5cdGlmIChzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50cmFuc2FjdGlvbklEJyxzZWxmLmNvbmZpZy5kYXRhKSkge1xuXHRcdGltZy5zcmMgKz0gJztvcmQ9JyArIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnLHNlbGYuY29uZmlnLmRhdGEpO1xuXHRcdGltZy5zcmMgKz0gJztjb3N0PScgKyBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5iYXNlUHJpY2UnLHNlbGYuY29uZmlnLmRhdGEpO1xuXHRcdGlmIChpLmNvdW50aW5nTWV0aG9kID09PSAnVFJBTlNBQ1RJT05TJykge1xuXHRcdFx0aW1nLnNyYyArPSAnO3F0eT0nICsgMTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aW1nLnNyYyArPSAnO3F0eT0nICsgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24uYXR0cmlidXRlcy50aWNrZXRRdWFudGl0eScsc2VsZi5jb25maWcuZGF0YSk7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdHZhciBheGVsID0gTWF0aC5yYW5kb20oKSArIFwiXCI7XG5cdFx0dmFyIGEgPSBheGVsICogMTAwMDAwMDAwMDAwMDA7XG5cdFx0aW1nLnNyYyArPSAnO29yZD0nICsgYTtcblx0fVxuXG5cdGltZy5zcmMgKz0gJz8nO1xuXG5cdGltZy53aWR0aCA9IDE7XG5cdGltZy5oZWlnaHQgPSAxO1xuXHRpbWcuYm9yZGVyID0gMDtcblxuXHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGltZyk7XG5cbn07XG5WZW5kb3JTZXJ2aWNlLnByb3RvdHlwZS5mYWNlYm9va0F1ZGllbmNlID0gZnVuY3Rpb24gKHRhZywgaW5kZXgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbi8vKioqKioqIEZhY2Vib29rIEF1ZGllbmNlICoqKioqKi8vXG4gICAgdmFyIGh0bWwgPSAnPHNjcmlwdCB0eXBlPVwidGV4dC9qYXZhc2NyaXB0XCI+JztcbiAgICBodG1sKz0gJyhmdW5jdGlvbiAoKSB7JztcbiAgICBodG1sKz0gJyAgICB2YXIgX2ZicSA9IHdpbmRvdy5fZmJxIHx8ICh3aW5kb3cuX2ZicSA9IFtdKTsnO1xuICAgIGh0bWwrPSAnICAgIGlmICggIV9mYnEubG9hZGVkICkgeyc7XG4gICAgaHRtbCs9ICcgICAgICAgIHZhciBmYmRzICAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFxcJ3NjcmlwdFxcJyk7JztcbiAgICBodG1sKz0gJyAgICAgICAgZmJkcy5hc3luYyA9IHRydWU7JztcbiAgICBodG1sKz0gJyAgICAgICAgZmJkcy5zcmMgICA9IFxcJy8vY29ubmVjdC5mYWNlYm9vay5uZXQvZW5fVVMvZmJkcy5qc1xcJzsnO1xuICAgIGh0bWwrPSAnICAgICAgICB2YXIgcyAgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXFwnc2NyaXB0XFwnKVswXTsnO1xuICAgIGh0bWwrPSAnICAgICAgICBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGZiZHMsIHMpOyc7XG4gICAgaHRtbCs9ICcgICAgICAgIF9mYnEubG9hZGVkID0gdHJ1ZTsnO1xuICAgIGh0bWwrPSAnICAgIH0nO1xuICAgIGh0bWwrPSAnICAgIHdpbmRvdy5fZmJxLnB1c2goW1xcJ2FkZFBpeGVsSWRcXCcsIHRhZy5waXhlbElkXSk7JztcbiAgICBodG1sKz0gJ30pKCk7JztcblxuICAgIGh0bWwrPSAnd2luZG93Ll9mYnEgPSB3aW5kb3cuX2ZicSB8fCBbXTsnO1xuICAgIGh0bWwrPSAnd2luZG93Ll9mYnEucHVzaChbXFwndHJhY2tcXCcsIFxcJ1BpeGVsSW5pdGlhbGl6ZWRcXCcsIHt9XSk7JztcblxuICAgIGlmICggc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcpICkge1xuICAgICAgICBodG1sKz0gJ3dpbmRvdy5fZmJxLnB1c2goW1xcJ3RyYWNrXFwnLCBcXCdQdXJjaGFzZVxcJywgeyc7XG4gICAgICAgIGh0bWwrPSAnICAgIGN1cnJlbmN5OiBcXCcnICsgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udG90YWwuY3VycmVuY3knKSArICdcXCcsJztcbiAgICAgICAgaHRtbCs9ICcgICAgdmFsdWU6ICAgIFxcJycgKyBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5iYXNlUHJpY2UnKSArICdcXCcnO1xuICAgICAgICBodG1sKz0gJ31dKTsnO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICBodG1sKz0gJ3dpbmRvdy5fZmJxLnB1c2goW1xcJ3RyYWNrXFwnLCBcXCdWaWV3Q29udGVudFxcJ10pOyc7XG4gICAgfVxuICAgIGh0bWwgKz0gJzwvc2NyaXB0Pic7XG5cbiAgICBzZWxmLmNyZWF0ZUlmcmFtZVdpdGhDb250ZW50KHRhZy5pZCwgaHRtbCwgZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLmxvZygnSWZyYW1lIGFkZGVkIGZvciBwaXhlbDogJyArIHRhZy5pZCk7XG4gICAgfSk7XG5cbi8vKioqKioqIEVuZCBGYWNlYm9vayBBdWRpZW5jZSAqKioqKiovL1xuXG59O1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuZmFjZWJvb2tDb252ZXJzaW9uID0gZnVuY3Rpb24gKHRhZywgaW5kZXgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbi8vKioqKioqIEZhY2Vib29rIENvbnZlcnNpb24gKioqKioqLy9cbiAgICB2YXIgaHRtbCA9ICc8c2NyaXB0IHR5cGU9XCJ0ZXh0L2phdmFzY3JpcHRcIj4nO1xuICAgIGh0bWwrPSAnKGZ1bmN0aW9uICgpIHsnO1xuICAgIGh0bWwrPSAnICAgIHZhciBfZmJxID0gd2luZG93Ll9mYnEgfHwgKHdpbmRvdy5fZmJxID0gW10pOyc7XG4gICAgaHRtbCs9ICcgICAgaWYgKCAhX2ZicS5sb2FkZWQgKSB7JztcbiAgICBodG1sKz0gJyAgICAgICAgdmFyIGZiZHMgICA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXFwnc2NyaXB0XFwnKTsnO1xuICAgIGh0bWwrPSAnICAgICAgICBmYmRzLmFzeW5jID0gdHJ1ZTsnO1xuICAgIGh0bWwrPSAnICAgICAgICBmYmRzLnNyYyAgID0gXFwnLy9jb25uZWN0LmZhY2Vib29rLm5ldC9lbl9VUy9mYmRzLmpzXFwnOyc7XG4gICAgaHRtbCs9ICcgICAgICAgIHZhciBzICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcXCdzY3JpcHRcXCcpWzBdOyc7XG4gICAgaHRtbCs9ICcgICAgICAgIHMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZmJkcywgcyk7JztcbiAgICBodG1sKz0gJyAgICAgICAgX2ZicS5sb2FkZWQgPSB0cnVlOyc7XG4gICAgaHRtbCs9ICcgICAgfSc7XG4gICAgaHRtbCs9ICd9KSgpOyc7XG4gICAgaHRtbCs9ICcoZnVuY3Rpb24gKCkgeyc7XG4gICAgaHRtbCs9ICcgICAgd2luZG93Ll9mYnEgPSB3aW5kb3cuX2ZicSB8fCBbXTsnO1xuICAgIGh0bWwrPSAnICAgICAgICB3aW5kb3cuX2ZicS5wdXNoKFtcXCd0cmFja1xcJywgXFwnJyArIHRhZy5waXhlbElkICsgJ1xcJywgeyc7XG4gICAgaHRtbCs9ICcgICAgY3VycmVuY3k6IFxcJycgKyBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5jdXJyZW5jeScpICsgJ1xcJywnO1xuICAgIGh0bWwrPSAnICAgIHZhbHVlOiAgICBcXCcnICsgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udG90YWwuYmFzZVByaWNlJykgKyAnXFwnJztcbiAgICBodG1sKz0gJyAgICAgICAgfV0pOyc7XG4gICAgaHRtbCs9ICd9KSgpOyc7XG4gICAgaHRtbCArPSAnPC9zY3JpcHQ+JztcblxuICAgIHNlbGYuY3JlYXRlSWZyYW1lV2l0aENvbnRlbnQodGFnLmlkLCBodG1sLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYubG9nKCdJZnJhbWUgYWRkZWQgZm9yIHBpeGVsOiAnICsgdGFnLmlkKTtcbiAgICB9KTtcblxuLy8qKioqKiogRW5kIEZhY2Vib29rIENvbnZlcnNpb24gKioqKioqLy9cbn07XG5cblZlbmRvclNlcnZpY2UucHJvdG90eXBlLmZhY2Vib29rID0gZnVuY3Rpb24gKHRhZywgaW5kZXgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAvL2xvYWQgdGhlIGxpYnJhcnkgaW4gdGhlIGlGcmFtZVxuICAgIHZhciBodG1sID0gJzxzY3JpcHQgdHlwZT1cInRleHQvamF2YXNjcmlwdFwiPic7XG4gICAgaHRtbCArPSAnIWZ1bmN0aW9uKGYsIGIsIGUsIHYsIG4sIHQsIHMpIHsnO1xuICAgIGh0bWwgKz0gJ2lmICggZi5mYnEgKSByZXR1cm47JztcbiAgICBodG1sICs9ICduID0gZi5mYnEgPSBmdW5jdGlvbigpIHsnO1xuICAgIGh0bWwgKz0gJ24uY2FsbE1ldGhvZCA/JztcbiAgICBodG1sICs9ICduLmNhbGxNZXRob2QuYXBwbHkobiwgYXJndW1lbnRzKSA6IG4ucXVldWUucHVzaChhcmd1bWVudHMpJztcbiAgICBodG1sICs9ICd9Oyc7XG4gICAgaHRtbCArPSAnaWYgKCAhZi5fZmJxICknO1xuICAgIGh0bWwgKz0gJ2YuX2ZicSA9IG47JztcbiAgICBodG1sICs9ICduLnB1c2ggPSBuOyc7XG4gICAgaHRtbCArPSAnbi5sb2FkZWQgPSAhMDsnO1xuICAgIGh0bWwgKz0gJ24udmVyc2lvbiA9IFxcJzIuMFxcJzsnO1xuICAgIGh0bWwgKz0gJ24uYWdlbnQgPSBcXCdQTFRJQ0tFVE1BU1RFUlxcJzsnO1xuICAgIGh0bWwgKz0gJ24ucXVldWUgPSBbXTsnO1xuICAgIGh0bWwgKz0gJ3QgPSBiLmNyZWF0ZUVsZW1lbnQoZSk7JztcbiAgICBodG1sICs9ICd0LmFzeW5jID0gITA7JztcbiAgICBodG1sICs9ICd0LnNyYyA9IHY7JztcbiAgICBodG1sICs9ICdzID0gYi5nZXRFbGVtZW50c0J5VGFnTmFtZShlKVsgMCBdO3MucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodCwgcyknO1xuICAgIGh0bWwgKz0gJ30od2luZG93LCc7XG4gICAgaHRtbCArPSAnZG9jdW1lbnQsIFxcJ3NjcmlwdFxcJywgXFwnLy9jb25uZWN0LmZhY2Vib29rLm5ldC9lbl9VUy9mYmV2ZW50cy5qc1xcJyk7JztcblxuICAgIC8vdHJhY2sgaW5pdCBhbmQgcGFnZVZpZXdcbiAgICBodG1sICs9ICdmYnEoXFwnc2V0XFwnLCBcXCdhdXRvQ29uZmlnXFwnLCBmYWxzZSwgXFwnJyArIHRhZy5waXhlbElkICsgJ1xcJyk7JztcbiAgICBodG1sICs9ICdmYnEoXFwnaW5pdFxcJywgXFwnJyArIHRhZy5waXhlbElkICsgJ1xcJyk7JztcbiAgICBodG1sICs9ICdmYnEoXFwndHJhY2tcXCcsIFxcJ1BhZ2VWaWV3XFwnKTsnO1xuXG4gICAgaHRtbCArPSAnPC9zY3JpcHQ+JztcblxuICAgIGh0bWwgKz0gJzxzY3JpcHQgdHlwZT1cInRleHQvamF2YXNjcmlwdFwiPic7XG5cbiAgICBpZiAoIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnLCBzZWxmLmNvbmZpZy5kYXRhKSApIHtcbiAgICAgICAgdmFyIGludmVudG9yeVR5cGUgPSAoIHBhcnNlSW50KHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLmF0dHJpYnV0ZXMuaXNSZXNhbGUnKSArIDApICE9PSAwICkgPyAncmVzYWxlJyA6ICdwcmltYXJ5JztcblxuICAgICAgICBodG1sICs9ICdmYnEoXFwndHJhY2tcXCcsIFxcJ1B1cmNoYXNlXFwnLCc7XG4gICAgICAgIGh0bWwgKz0gJ3snO1xuICAgICAgICBodG1sICs9ICd2YWx1ZTogJyArIHNlbGYudG9GbG9hdChzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5iYXNlUHJpY2UnKSAsIDApICsgJywnO1xuICAgICAgICBodG1sICs9ICdjdXJyZW5jeTogXFwnJyArIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRvdGFsLmN1cnJlbmN5JykgKyAnXFwnJztcbiAgICAgICAgaHRtbCArPSAnLGludmVudG9yeV90eXBlOiBcXCcnICsgaW52ZW50b3J5VHlwZSArICdcXCcsJztcbiAgICB9IGVsc2Uge1xuICAgICAgICBodG1sICs9ICdmYnEoXFwndHJhY2tcXCcsIFxcJ1ZpZXdDb250ZW50XFwnLCc7XG4gICAgICAgIGh0bWwgKz0gJ3snO1xuICAgIH1cblxuICAgICAgICBodG1sICs9ICdob3N0bmFtZTogd2luZG93LnBhcmVudC5sb2NhdGlvbi5ob3N0bmFtZSwnO1xuICAgICAgICBodG1sICs9ICdwYWdlX25hbWU6IFxcJycgKyBzZWxmLmdldFZhbHVlKCdwYWdlLnBhZ2VJbmZvLnBhZ2VOYW1lJykgKyAnXFwnLCc7XG4gICAgICAgIGh0bWwgKz0gJ2V2ZW50X25hbWU6IFxcJycgKyBzZWxmLmFkZFNsYXNoZXMoc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmV2ZW50TmFtZScpLnJlcGxhY2UoL1xceDI3L2csICdcXFxcXFx4MjcnKSkgKyAnXFwnLCc7XG4gICAgICAgIGh0bWwgKz0gJ2V2ZW50X2lkOiBcXCcnICsgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmV2ZW50SUQnKSArICdcXCcsJztcbiAgICAgICAgaHRtbCArPSAnZXZlbnRfY2F0X21ham9yOiBcXCcnICsgc2VsZi5hZGRTbGFzaGVzKHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuY2F0ZWdvcnkucHJpbWFyeUNhdGVnb3J5JykpICsgJ1xcJywnO1xuICAgICAgICBodG1sICs9ICdldmVudF9jYXRfbWlub3I6IFxcJycgKyBzZWxmLmFkZFNsYXNoZXMoc2VsZi5nZXRWYWx1ZSgncGFnZS5jYXRlZ29yeS5zdWJDYXRlZ29yeTEnKSkgKyAnXFwnLCc7XG5cbiAgICAgICAgLyogc3RhcnQgLSBhZGRlZCBmb3IgQVMtMjIyOSAoRmFjZWJvb2sgcGFyYW1ldGVycyBmb3IgRFBBKSAqL1xuICAgICAgICBodG1sICs9ICdjb250ZW50X2lkczogXFwnJyArIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudElEJykgKyAnXFwnLCc7XG4gICAgICAgIGh0bWwgKz0gJ2NvbnRlbnRfdHlwZTogXFwncHJvZHVjdFxcJywnO1xuICAgICAgICAvKiBlbmQgLSBhZGRlZCBmb3IgQVMtMjIyOSAoRmFjZWJvb2sgcGFyYW1ldGVycyBmb3IgRFBBKSAqL1xuXG4gICAgICAgIGh0bWwgKz0gJ2NoYW5uZWw6IFxcJycgKyAoc2VsZi5nZXRWYWx1ZSgnYWNjb3VudE1hbmFnZXInKSA9PSB0cnVlID8gJ0FjY291bnQgTWFuYWdlcicgOiAnVGlja2V0bWFzdGVyJykgKyAnXFwnLCc7XG5cbiAgICAgICAgaHRtbCArPSAnYXJ0aXN0X25hbWU6IFxcJycgKyBzZWxmLmFkZFNsYXNoZXMoc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmFydGlzdE5hbWUnKSkgKyAnXFwnLCc7XG4gICAgICAgIGh0bWwgKz0gJ2FydGlzdF9pZDogXFwnJyArIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5hcnRpc3RJRCcpICsgJ1xcJywnO1xuICAgICAgICBodG1sICs9ICd2ZW51ZV9uYW1lOiBcXCcnICsgc2VsZi5hZGRTbGFzaGVzKHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy52ZW51ZU5hbWUnKS5yZXBsYWNlKC9cXHgyNy9nLCAnXFxcXFxceDI3JykpICsgJ1xcJywnO1xuICAgICAgICBodG1sICs9ICd2ZW51ZV9pZDogXFwnJyArIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy52ZW51ZUlEJykgKyAnXFwnJztcblxuICAgICAgICBodG1sICs9ICd9JztcbiAgICAgICAgaHRtbCArPSAnKTsnO1xuXG4gICAgaHRtbCArPSAnPC9zY3JpcHQ+JztcblxuICAgIHNlbGYuY3JlYXRlSWZyYW1lV2l0aENvbnRlbnQodGFnLmlkLCBodG1sLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYubG9nKCdJZnJhbWUgYWRkZWQgZm9yIHBpeGVsOiAnICsgdGFnLmlkKTtcbiAgICB9KTtcblxufTtcblZlbmRvclNlcnZpY2UucHJvdG90eXBlLmdvb2dsZUFkd29yZHNDb252ZXJzaW9uID0gZnVuY3Rpb24gKHRhZywgaW5kZXgpIHtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXHR2YXIgcGl4ZWwgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRhZykpO1xuXG5cdHZhciBuZXh0ID0gZnVuY3Rpb24gKCkge1xuXG5cdFx0dmFyIHBhcmFtcyA9IHt9O1xuXHRcdHBhcmFtcy5nb29nbGVfY29udmVyc2lvbl9pZCA9IHBpeGVsLmNvbnZlcnNpb25JZDtcblx0XHRwYXJhbXMuZ29vZ2xlX2NvbnZlcnNpb25fbGFiZWwgPSB0eXBlb2YgcGl4ZWwuY29udmVyc2lvbkxhYmVsICE9PSAndW5kZWZpbmVkJyA/IHBpeGVsLmNvbnZlcnNpb25MYWJlbCA6ICcnO1xuXHRcdHBhcmFtcy5nb29nbGVfcmVtYXJrZXRpbmdfb25seSA9IGZhbHNlO1xuXHRcdHBhcmFtcy5nb29nbGVfY29udmVyc2lvbl92YWx1ZSA9IHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRvdGFsLmJhc2VQcmljZScpO1xuXHRcdHBhcmFtcy5nb29nbGVfY29udmVyc2lvbl9jdXJyZW5jeSA9IHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRvdGFsLmN1cnJlbmN5JykgfHwgJ1VTRCc7XG5cdFx0Z29vZ2xlX3RyYWNrQ29udmVyc2lvbihwYXJhbXMpO1xuXHR9O1xuXG5cblx0aWYgKHR5cGVvZiB3aW5kb3cuZ29vZ2xlX3RyYWNrQ29udmVyc2lvbiA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRzZWxmLmdldFNjcmlwdChsb2NhdGlvbi5wcm90b2NvbCArIFwiLy93d3cuZ29vZ2xlYWRzZXJ2aWNlcy5jb20vcGFnZWFkL2NvbnZlcnNpb25fYXN5bmMuanNcIiwgbnVsbCwgbnVsbCxcblx0XHRcdGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0bmV4dCgpO1xuXHRcdFx0fSk7XG5cblx0fSBlbHNlIHtcblx0XHRuZXh0KCk7XG5cdH1cblxufTtcblZlbmRvclNlcnZpY2UucHJvdG90eXBlLmdvb2dsZUFkd29yZHNHdGFnRXZlbnQgPSBmdW5jdGlvbiAodGFnLCBpbmRleCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIC8vY2hlY2sgZm9yIGEgc2VuZFRvIHBhcmFtZXRlclxuICAgIGlmKHRhZy5zZW5kVG8pIHtcbiAgICAgICAgdGFnLmNvbnZlcnNpb25JZCA9IHRhZy5zZW5kVG8uc3BsaXQoJy8nKVswXTtcbiAgICAgICAgdGFnLmNvbnZlcnNpb25MYWJlbCA9IHRhZy5zZW5kVG8uc3BsaXQoJy8nKVsxXTtcbiAgICB9XG5cbiAgICAvL2ZvciBldmVyeSB0YWcsIGxvYWQgZ3RtIGFuZCBmaXJlIGd0YWcgY29uZmlnXG4gICAgdmFyIGh0bWwgPSAnPHNjcmlwdCBhc3luYyBzcmM9XCJodHRwczovL3d3dy5nb29nbGV0YWdtYW5hZ2VyLmNvbS9ndGFnL2pzP2lkPScgKyB0YWcuY29udmVyc2lvbklkICsgJ1wiPjwvc2NyaXB0Pic7XG4gICAgaHRtbCArPSAnPHNjcmlwdD4nO1xuICAgIGh0bWwgKz0gJ3dpbmRvdy5kYXRhTGF5ZXIgPSB3aW5kb3cuZGF0YUxheWVyIHx8IFtdOyc7XG4gICAgaHRtbCArPSAnZnVuY3Rpb24gZ3RhZygpe2RhdGFMYXllci5wdXNoKGFyZ3VtZW50cyk7fSc7XG4gICAgaHRtbCArPSAnZ3RhZyhcXCdqc1xcJywgbmV3IERhdGUoKSk7JztcbiAgICBodG1sICs9ICdndGFnKFxcJ2NvbmZpZ1xcJywgXFwnJyArIHRhZy5jb252ZXJzaW9uSWQgKyAnXFwnKTsnO1xuICAgIFxuICAgIC8vZm9yIHRhZ3Mgd2l0aCBhIGNvbnZlcnNpb24gbGFiZWwsIGZpcmUgYSBjb252ZXJzaW9uIGV2ZW50ICh0aGVzZSB3b3VsZCBiZSB0aGUgXCJldmVudCB0YWdzXCIgKHZzLiBnbG9iYWwgc2l0ZSB0YWdzKSlcbiAgICBpZih0YWcuY29udmVyc2lvbkxhYmVsKSB7XG5cbiAgICAgICAgaWYgKHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnLCBzZWxmLmNvbmZpZy5kYXRhKSkge1xuICAgICAgICAgICAgaHRtbCArPSAnZ3RhZyhcXCdldmVudFxcJywgXFwncHVyY2hhc2VcXCcsIHtcXCdzZW5kX3RvXFwnOiBcXCcnICsgdGFnLmNvbnZlcnNpb25JZCArICcvJyArIHRhZy5jb252ZXJzaW9uTGFiZWwgKyAnXFwnJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGh0bWwgKz0gJ2d0YWcoXFwnZXZlbnRcXCcsIFxcJ2NvbnZlcnNpb25cXCcsIHtcXCdzZW5kX3RvXFwnOiBcXCcnICsgdGFnLmNvbnZlcnNpb25JZCArICcvJyArIHRhZy5jb252ZXJzaW9uTGFiZWwgKyAnXFwnJztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnLCBzZWxmLmNvbmZpZy5kYXRhKSkge1xuICAgICAgICAgICAgaHRtbCArPSAnLCBcXCd2YWx1ZVxcJzonICsgc2VsZi50b0Zsb2F0KHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRvdGFsLmJhc2VQcmljZScpICwgMCk7XG4gICAgICAgICAgICBodG1sICs9ICcsIFxcJ2N1cnJlbmN5XFwnOiBcXCcnICsgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udG90YWwuY3VycmVuY3knKSArICdcXCcnO1xuICAgICAgICAgICAgaHRtbCArPSAnLCBcXCd0cmFuc2FjdGlvbl9pZFxcJzogXFwnJyArIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnKSArICdcXCcnO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBodG1sICs9ICd9KTsnO1xuXG4gICAgfVxuICAgIFxuICAgIGh0bWwgKz0gJzwvc2NyaXB0Pic7XG5cbiAgICBzZWxmLmNyZWF0ZUlmcmFtZVdpdGhDb250ZW50KHRhZy5pZCwgaHRtbCwgZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLmxvZygnSWZyYW1lIGFkZGVkIGZvciBwaXhlbDogJyArIHRhZy5pZCk7XG4gICAgfSk7XG5cbn07XG5WZW5kb3JTZXJ2aWNlLnByb3RvdHlwZS5nb29nbGVBZHdvcmRzR3RhZ0dsb2JhbCA9IGZ1bmN0aW9uICh0YWcsIGluZGV4KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgLy9mb3IgZXZlcnkgdGFnLCBsb2FkIGd0bSBhbmQgZmlyZSBndGFnIGNvbmZpZ1xuICAgIHZhciBodG1sID0gJzxzY3JpcHQgYXN5bmMgc3JjPVwiaHR0cHM6Ly93d3cuZ29vZ2xldGFnbWFuYWdlci5jb20vZ3RhZy9qcz9pZD0nICsgdGFnLmFkV29yZHNJZCArICdcIj48L3NjcmlwdD4nO1xuICAgIGh0bWwgKz0gJzxzY3JpcHQ+JztcbiAgICBodG1sICs9ICd3aW5kb3cuZGF0YUxheWVyID0gd2luZG93LmRhdGFMYXllciB8fCBbXTsnO1xuICAgIGh0bWwgKz0gJ2Z1bmN0aW9uIGd0YWcoKXtkYXRhTGF5ZXIucHVzaChhcmd1bWVudHMpO30nO1xuICAgIGh0bWwgKz0gJ2d0YWcoXFwnanNcXCcsIG5ldyBEYXRlKCkpOyc7XG4gICAgaHRtbCArPSAnZ3RhZyhcXCdjb25maWdcXCcsIFxcJycgKyB0YWcuYWRXb3Jkc0lkICsgJ1xcJyk7JztcbiAgICBodG1sICs9ICc8L3NjcmlwdD4nO1xuXG4gICAgc2VsZi5jcmVhdGVJZnJhbWVXaXRoQ29udGVudCh0YWcuaWQsIGh0bWwsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2VsZi5sb2coJ0lmcmFtZSBhZGRlZCBmb3IgcGl4ZWw6ICcgKyB0YWcuaWQpO1xuICAgIH0pO1xuXG59O1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuZ29vZ2xlQWR3b3Jkc1JlbWFya2V0aW5nID0gZnVuY3Rpb24gKHRhZywgaW5kZXgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAvLyoqKioqKiBBZHdvcmRzIENvbnZlcnNpb24gKioqKioqLy9cbiAgICB2YXIgcGl4ZWwgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRhZykpO1xuXG4gICAgdmFyIG5leHQgPSBmdW5jdGlvbiAoYXJyKSB7XG4gICAgICAgIHZhciBwYXJhbXMgPSB7fTtcbiAgICAgICAgcGFyYW1zLmdvb2dsZV9jb252ZXJzaW9uX2lkID0gcGl4ZWwuY29udmVyc2lvbklkO1xuICAgICAgICBwYXJhbXMuZ29vZ2xlX2NvbnZlcnNpb25fbGFiZWwgPSB0eXBlb2YgcGl4ZWwuY29udmVyc2lvbkxhYmVsICE9PSAndW5kZWZpbmVkJyA/IHBpeGVsLmNvbnZlcnNpb25MYWJlbCA6ICcnO1xuICAgICAgICBwYXJhbXMuZ29vZ2xlX3JlbWFya2V0aW5nX29ubHkgPSB0cnVlO1xuICAgICAgICBwYXJhbXMuZ29vZ2xlX2NvbnZlcnNpb25fdmFsdWUgPSBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5iYXNlUHJpY2UnKTtcbiAgICAgICAgZ29vZ2xlX3RyYWNrQ29udmVyc2lvbihwYXJhbXMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvdy5nb29nbGVfdHJhY2tDb252ZXJzaW9uID09PSAndW5kZWZpbmVkJykge1xuXG4gICAgICAgIHNlbGYuZ2V0U2NyaXB0KGxvY2F0aW9uLnByb3RvY29sICsgJy8vd3d3Lmdvb2dsZWFkc2VydmljZXMuY29tL3BhZ2VhZC9jb252ZXJzaW9uX2FzeW5jLmpzJywgbnVsbCwgbnVsbCxcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgICAgICB9KTtcblxuICAgIH0gZWxzZSB7XG4gICAgICAgIG5leHQoKTtcbiAgICB9XG4gICAgLy8qKioqKiogRW5kIEFkd29yZHMgUmV0YXJnZXRpbmcgKioqKioqLy9cbn07XG4vLyoqKioqKiBHb29nbGUgQW5hbHl0aWNzICoqKioqKi8vXG4vLyBUaGlzIGxlZ2FjeSB0YWcgcnVucyBhbmFseXRpY3MuanMgaW4gdGhlIHRvcCBET00gb2YgdGhlIHBhZ2UsIGl0IHNob3VsZCBiZSBzZXF1ZXN0ZXJlZCBpbiBhbiBJRlJBTUUgYXMgb2YgMjAxOSBJbmZvU2VjIHByYWN0aWNlc1xuLy8gSG93ZXZlciBHQTMgd2lsbCBiZSBzdW5zZXQgYnkgR29vZ2xlIG9uIEp1bHkgMSwgMjAyMyBzbyB0aGlzIGlzIGxlZnQgYXMtaXMgdG8gYmUgZGVwcmVjYXRlZCB3aGlsZSBtYWludGFpbmluZyBjb25zaXN0ZW5jeVxuLy8gSW5wdXQgOlxuLy9cdCogdGFnIFx0OiB0aGUgb2JqZWN0IGRlc2VyaWFsaXplZCBmcm9tIHRoZSBqc29uIHBpeGVsIFRNMSBtYXJrZXRpbmcgaGFzIGdlbmVyYXRlZFxuLy9cdCogaW5kZXggOiBpbmRleCBvZiB0aGUgY3VycmVudCB0YWcgaW4gdGhlIHBhZ2UuIFBhcnQgb2YgdGhlIGdlbmVyYWwgdmVuZG9yIGludGVyZmFjZSB0aGF0IGlzIGNhbGxlZCBpbiBzcmMvbGliL3Byb3RvdHlwZXMvcHJvY2Vzc1BpeGVscy5qcyBMMTRcblxuZnVuY3Rpb24gbG9hZEdvb2dsZUFuYWx5dGljc0xpYnJhcnkoKSB7XG5cdC8vIHRoaXMgX3Nob3VsZF8gYmUgbG9hZGVkIG9uIGFsbCBwYWdlcyBieSB3YXkgb2YgVE0gQW5hbHl0aWNzIFBsYXRmb3JtLCBidXQganVzdCBpbiBjYXNlXG5cdHZhciB3aW5kb3dPYmplY3QgPSB3aW5kb3csIGRvbURvY3VtZW50ID0gZG9jdW1lbnQsIHNjcmlwdFRhZyA9ICdzY3JpcHQnLCBnYUVuZHBvaW50VXJsID0gJy8vd3d3Lmdvb2dsZS1hbmFseXRpY3MuY29tL2FuYWx5dGljcy5qcycsIGxpYktleSA9ICdnYSc7XG5cdHdpbmRvd09iamVjdFsnR29vZ2xlQW5hbHl0aWNzT2JqZWN0J10gPSBsaWJLZXk7XG5cdHdpbmRvd09iamVjdFtsaWJLZXldID0gd2luZG93T2JqZWN0W2xpYktleV0gfHwgZnVuY3Rpb24gKCkge1xuXHRcdCh3aW5kb3dPYmplY3RbbGliS2V5XS5xID0gd2luZG93T2JqZWN0W2xpYktleV0ucSB8fCBbXSkucHVzaChhcmd1bWVudHMpXG5cdH0sIHdpbmRvd09iamVjdFtsaWJLZXldLmwgPSAxICogbmV3IERhdGUoKTtcblxuXHR2YXIgc2NyaXB0RWxlbWVudCA9IGRvbURvY3VtZW50LmNyZWF0ZUVsZW1lbnQoc2NyaXB0VGFnKSwgZmlyc3RTY3JpcHRUYWdJbkRvbSA9IGRvbURvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKHNjcmlwdFRhZylbMF07XG5cdHNjcmlwdEVsZW1lbnQuYXN5bmMgPSAxO1xuXHRzY3JpcHRFbGVtZW50LnNyYyA9IGdhRW5kcG9pbnRVcmw7XG5cdGZpcnN0U2NyaXB0VGFnSW5Eb20ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2NyaXB0RWxlbWVudCwgZmlyc3RTY3JpcHRUYWdJbkRvbSk7XG59XG5cbi8vIEhlbHBlcjogQnVpbGQgUHJvZHVjdCBhY3Rpb25GaWVsZE9iamVjdCBmb3IgZWNvbW1lcmNlIHRvIHRoaXMgbmFtZWQgdHJhY2tlclxuLy8gTmFtZWQgdHJhY2tlciBkb2N1bWVudGF0aW9uIDogaHR0cHM6Ly9zdXBwb3J0Lmdvb2dsZS5jb20vdGFnbWFuYWdlci9hbnN3ZXIvMjU3NDM3MiNUcmFja2VyTmFtZVxuY29uc3QgaHRtbFNpbmdsZVF1b3RlID0gJ1xcXFxcXHgyNyc7XG52YXIgYnVpbGRBbmRTZW5kRWNvbW1lcmNlRXZlbnRzID0gZnVuY3Rpb24gKGdhVmVuZG9yU2VydmljZSwgdHJhY2tlck5hbWUsIHRhZykge1xuXHR2YXIgcmVxdWlyZSA9IHRyYWNrZXJOYW1lICsgXCIucmVxdWlyZVwiO1xuXHR2YXIgZWNvbSA9IHRyYWNrZXJOYW1lICsgXCIuZWNcIjtcblx0Z2EocmVxdWlyZSwgJ2VjJyk7XG5cblx0Ly8gRmlyc3QsIGdldCBhbGwgdGhlIGdlbmVyaWMgUHJvZHVjdCBzdHVmZiB3aXRoIHZhbHVlcyB3ZSBrbm93IGFyZSBwcmVzZW50IGluIGZhbmJ1aWxkZXJcblx0dmFyIHByb2R1Y3RJbmZvID0ge1xuXHRcdGlkOiBnYVZlbmRvclNlcnZpY2UuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudElEJyksXG5cdFx0bmFtZTogZ2FWZW5kb3JTZXJ2aWNlLmdldFZhbHVlKCdnb29nbGVBbmFseXRpY3MucHJvZHVjdEluZm8ubmFtZScpIHx8IGdhVmVuZG9yU2VydmljZS5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmV2ZW50TmFtZScpLnJlcGxhY2UoL1xceDI3L2csIGh0bWxTaW5nbGVRdW90ZSksXG5cdFx0Y2F0ZWdvcnk6IGdhVmVuZG9yU2VydmljZS5nZXRWYWx1ZSgnZ29vZ2xlQW5hbHl0aWNzLnByb2R1Y3RJbmZvLmNhdGVnb3J5JykgfHwgZ2FWZW5kb3JTZXJ2aWNlLmdldFZhbHVlKCdwYWdlLmNhdGVnb3J5LnByaW1hcnlDYXRlZ29yeScpIHx8IGdhVmVuZG9yU2VydmljZS5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmV2ZW50VHlwZScpIHx8IFwiXCIsXG5cdFx0YnJhbmQ6IGdhVmVuZG9yU2VydmljZS5nZXRWYWx1ZSgnYWNjb3VudE1hbmFnZXInKSA/ICdBY2NvdW50IE1hbmFnZXInIDogJ1RpY2tldG1hc3Rlcidcblx0fTtcblxuXHQvLyBTZWNvbmQsIEFkZCBQcm9kdWN0IGN1c3RvbSBkaW1lbnNpb25zIChjYW4ndCB0ZWxsIGlmIGl0IGlzIGhpdC9zZXNzaW9uL3Byb2R1Y3Qgc2NvcGVkIHNvIGFkZCB0byBib3RoLCBHQSB3aWxsIGlnbm9yZSBpbnZhbGlkIHNjb3Blcylcblx0aWYgKHR5cGVvZiB0YWcuY3VzdG9tVmFyaWFibGVzICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGZvciAodmFyIGtleSBpbiB0YWcuY3VzdG9tVmFyaWFibGVzKSB7XG5cdFx0XHRwcm9kdWN0SW5mb1trZXldID0gZ2FWZW5kb3JTZXJ2aWNlLmdldFZhbHVlKHRhZy5jdXN0b21WYXJpYWJsZXNba2V5XSk7XG5cdFx0fVxuXHR9XG5cblx0Ly8gVGhpcmQsIGFkZCBlYyBQcm9kdWN0cyBBY3Rpb25zIHRvIHRoZSBoaXQsIGlmIGl0cyBhIGNvbmZpcm1hdGlvbiBwYWdlLCBhZGQgcHJvZHVjdHMgYW5kIHB1cmNoYXNlIGFjdGlvblxuXHQvLyBPZmZpY2lhbCBkb2N1bWVudGF0aW9uIDpcblx0Ly8gXHQqIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2FuYWx5dGljcy9kZXZndWlkZXMvY29sbGVjdGlvbi9hbmFseXRpY3Nqcy9lY29tbWVyY2Vcblx0Ly9cdCogaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vYW5hbHl0aWNzL2Rldmd1aWRlcy9jb2xsZWN0aW9uL2FuYWx5dGljc2pzL2VuaGFuY2VkLWVjb21tZXJjZVxuXHQvLyBBIGdvb2Qgc3RlcCBieSBzdGVwIGd1aWRlIDogaHR0cHM6Ly93d3cub3B0aW1pemVzbWFydC5jb20vaW1wbGVtZW50aW5nLWVuaGFuY2VkLWVjb21tZXJjZS10cmFja2luZy11bml2ZXJzYWwtYW5hbHl0aWNzL1xuXHRpZihnYVZlbmRvclNlcnZpY2UuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnKSl7XG5cdFx0Ly8gQXVnbWVudCBwcm9kdWN0SW5mbyBhYm92ZSB3aXRoIHByb2Nlc3NlZEl0ZW1zIHRoYXQgZXhwYW5kIHRyYW5zYWN0aW9uIGRhdGEgZm9yIGNhdC92YXJpYW50L2V0Y1xuXHRcdC8vIFx0IFwicHJvY2Vzc2VkSXRlbXNcIiBpcyBhIGNvbnN0cnVjdCBpbiBHb29nbGUgVGFnIE1hbmFnZXIgdGhhdCBoYW5kbGVzIHBsYXRmb3JtIGZpeGVzL2lzc3Vlc1xuXHRcdHZhciBwcm9jZXNzZWRJdGVtc0xlbmd0aCA9IGdhVmVuZG9yU2VydmljZS5nZXRWYWx1ZSgnZ29vZ2xlQW5hbHl0aWNzLnByb2R1Y3RJbmZvLnByb2Nlc3NlZEl0ZW1zJykubGVuZ3RoIHx8IDE7XG5cdFx0Zm9yKHZhciBpPTA7IGk8cHJvY2Vzc2VkSXRlbXNMZW5ndGg7IGkrKyl7XG5cdFx0XHQvLyBIZXJlIHdlIHRha2UgdGhhdCBpbmZvIGFuZCBhcHBseSBcInNhZmVcIiBiYWNrdXBzIGluIGNhc2UgaXQgaXMgbWlzc2luZyBmb3IgY3JpdGljYWwgdHJhbnNhY3Rpb24gYXR0cmlidXRlc1xuXHRcdFx0dmFyIHByb2Nlc3NlZEl0ZW1zRGVmaW5lZCA9IGdhVmVuZG9yU2VydmljZS5nZXRWYWx1ZSgnZ29vZ2xlQW5hbHl0aWNzLnByb2R1Y3RJbmZvLnByb2Nlc3NlZEl0ZW1zJykgJiYgZ2FWZW5kb3JTZXJ2aWNlLmdldFZhbHVlKCdnb29nbGVBbmFseXRpY3MucHJvZHVjdEluZm8ucHJvY2Vzc2VkSXRlbXMnKVtpXTtcblx0XHRcdHByb2R1Y3RJbmZvLmlkID0gcHJvY2Vzc2VkSXRlbXNEZWZpbmVkID8gZ2FWZW5kb3JTZXJ2aWNlLmdldFZhbHVlKCdnb29nbGVBbmFseXRpY3MucHJvZHVjdEluZm8ucHJvY2Vzc2VkSXRlbXMnKVtpXS5nYUlkIDogZ2FWZW5kb3JTZXJ2aWNlLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMuZXZlbnRJRCcpO1xuXHRcdFx0cHJvZHVjdEluZm8ubmFtZSA9IHByb2Nlc3NlZEl0ZW1zRGVmaW5lZCA/IGdhVmVuZG9yU2VydmljZS5nZXRWYWx1ZSgnZ29vZ2xlQW5hbHl0aWNzLnByb2R1Y3RJbmZvLnByb2Nlc3NlZEl0ZW1zJylbaV0uZ2FOYW1lIDogKCBnYVZlbmRvclNlcnZpY2UuZ2V0VmFsdWUoJ2dvb2dsZUFuYWx5dGljcy5wcm9kdWN0SW5mby5uYW1lJykgfHwgZ2FWZW5kb3JTZXJ2aWNlLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMuZXZlbnROYW1lJykucmVwbGFjZSgvXFx4MjcvZywgaHRtbFNpbmdsZVF1b3RlKSB8fCBcIlwiICk7XG5cdFx0XHRwcm9kdWN0SW5mby5jYXRlZ29yeSA9IHByb2Nlc3NlZEl0ZW1zRGVmaW5lZCA/IGdhVmVuZG9yU2VydmljZS5nZXRWYWx1ZSgnZ29vZ2xlQW5hbHl0aWNzLnByb2R1Y3RJbmZvLnByb2Nlc3NlZEl0ZW1zJylbaV0uZ2FDYXRlZ29yeSA6ICggZ2FWZW5kb3JTZXJ2aWNlLmdldFZhbHVlKCdwYWdlLmNhdGVnb3J5LnByaW1hcnlDYXRlZ29yeScpIHx8IGdhVmVuZG9yU2VydmljZS5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmV2ZW50VHlwZScpIHx8IFwiXCIgKTtcblx0XHRcdHByb2R1Y3RJbmZvLnZhcmlhbnQgPSBwcm9jZXNzZWRJdGVtc0RlZmluZWQgPyBnYVZlbmRvclNlcnZpY2UuZ2V0VmFsdWUoJ2dvb2dsZUFuYWx5dGljcy5wcm9kdWN0SW5mby5wcm9jZXNzZWRJdGVtcycpW2ldLmdhVmFyaWFudCA6ICggZ2FWZW5kb3JTZXJ2aWNlLmdldFZhbHVlKCdnb29nbGVBbmFseXRpY3MucHJvZHVjdEluZm8udmFyaWFudCcpIHx8IFwiXCIgKTtcblx0XHRcdHByb2R1Y3RJbmZvLnF1YW50aXR5ID0gcHJvY2Vzc2VkSXRlbXNEZWZpbmVkID8gZ2FWZW5kb3JTZXJ2aWNlLmdldFZhbHVlKCdnb29nbGVBbmFseXRpY3MucHJvZHVjdEluZm8ucHJvY2Vzc2VkSXRlbXMnKVtpXS5xdWFudGl0eSA6IGdhVmVuZG9yU2VydmljZS5nZXRWYWx1ZSgndHJhbnNhY3Rpb24uYXR0cmlidXRlcy50aWNrZXRRdWFudGl0eScpO1xuXHRcdFx0cHJvZHVjdEluZm8ucHJpY2UgPSBwcm9jZXNzZWRJdGVtc0RlZmluZWQgPyBnYVZlbmRvclNlcnZpY2UuZ2V0VmFsdWUoJ2dvb2dsZUFuYWx5dGljcy5wcm9kdWN0SW5mby5wcm9jZXNzZWRJdGVtcycpW2ldLnByaWNlLmJhc2VQcmljZSA6ICggZ2FWZW5kb3JTZXJ2aWNlLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5iYXNlUHJpY2UnKS9nYVZlbmRvclNlcnZpY2UuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLmF0dHJpYnV0ZXMudGlja2V0UXVhbnRpdHknKSApO1xuXHRcdFx0cHJvZHVjdEluZm8uYnJhbmQgPSBnYVZlbmRvclNlcnZpY2UuZ2V0VmFsdWUoJ2FjY291bnRNYW5hZ2VyJykgPyAnQWNjb3VudCBNYW5hZ2VyJyA6IGdhVmVuZG9yU2VydmljZS5nZXRWYWx1ZSgnZ29vZ2xlQW5hbHl0aWNzLnByb2R1Y3RJbmZvLmNvbmZpcm1hdGlvbkJyYW5kJyk7XG5cdFx0XHRnYShlY29tICsgJzphZGRQcm9kdWN0JywgcHJvZHVjdEluZm8pO1xuXHRcdH1cblx0XHQvL3RoZW4sIGNhbGwgYSBzaW5nbGUgcHVyY2hhc2UgZXZlbnQgd2l0aCB0b3RhbHMgaW5jbHVkZWQgKHNlbnQgd2l0aCBwYWdldmlldyBiZWxvdyB0byBuYW1lZCB0cmFja2VyIG9iamVjdClcblx0XHRnYShlY29tICsgJzpzZXRBY3Rpb24nLCAncHVyY2hhc2UnLCB7XG5cdFx0XHRpZDogZ2FWZW5kb3JTZXJ2aWNlLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50cmFuc2FjdGlvbklEJyksXG5cdFx0XHRhZmZpbGlhdGlvbjogJ1RpY2tldG1hc3RlcicsXG5cdFx0XHRyZXZlbnVlOiBnYVZlbmRvclNlcnZpY2UuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRvdGFsLmJhc2VQcmljZScpLFxuXHRcdFx0Y3VycmVuY3k6IGdhVmVuZG9yU2VydmljZS5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udG90YWwuY3VycmVuY3knKVxuXHRcdH0pO1xuXHR9IGVsc2UgaWYgKCBnYVZlbmRvclNlcnZpY2UuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudElEJykgKXsgLy9pZiB5b3UgYXJlIG9uIGFuIEVEUCBhbmQgaGF2ZSBldmVudCBpbmZvLCBBZGQgYSBQcm9kdWN0IEltcHJlc3Npb25cblx0XHRnYShlY29tICsgJzphZGRQcm9kdWN0JywgcHJvZHVjdEluZm8gKTtcblx0XHRnYShlY29tICsgJzpzZXRBY3Rpb24nLCAnZGV0YWlsJyk7XG5cdH1cbn07XG5cblZlbmRvclNlcnZpY2UucHJvdG90eXBlLmdvb2dsZUFuYWx5dGljc1YyID0gZnVuY3Rpb24gKHRhZywgaW5kZXgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cblx0aWYoICF3aW5kb3cuZ2EgKSB7XG5cdFx0bG9hZEdvb2dsZUFuYWx5dGljc0xpYnJhcnkoKTtcblx0fVxuXG5cdC8vIFByZXBhcmUgdHJhY2tlciBvYmplY3QgYW5kIHNlbmQgcGFnZSBoaXRcblx0aWYgKHR5cGVvZiB0YWcudHJhY2tpbmdJZCAhPT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdHZhciB0cmFja2VyTmFtZSA9ICd0cmFja2VyJyArIHRhZy5pZDtcblx0XHRnYSgnY3JlYXRlJywgdGFnLnRyYWNraW5nSWQsICdhdXRvJywgeyduYW1lJzogdHJhY2tlck5hbWUsICdhbGxvd0xpbmtlcic6IHRydWV9KTtcblx0XHQvLyBBZGQgSGl0L1Nlc3Npb24gQ3VzdG9tIERpbWVuc2lvbnMgKHNlcGFyYXRlIGZ1bmN0aW9uIGZvciBqZXN0IHRlc3RzLCBjb3VsZCBiZSBkb25lIGhlcmUgYXMgd2l0aCBwcm9kdWN0cylcblx0XHRzZWxmLmFkZEdBMkN1c3RvbURpbWVuc2lvbnMoZ2EsIHRyYWNrZXJOYW1lLCB0YWcuY3VzdG9tVmFyaWFibGVzKTtcblx0XHRidWlsZEFuZFNlbmRFY29tbWVyY2VFdmVudHMoc2VsZiwgdHJhY2tlck5hbWUsIHRhZyk7XG5cdFx0Z2EodHJhY2tlck5hbWUgKyAnLnNlbmQnLCAncGFnZXZpZXcnKTtcblx0fVxufTtcblxuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuZ29vZ2xlQW5hbHl0aWNzVjQgPSBmdW5jdGlvbiAodGFnLCBpbmRleCkge1xuICAgIC8qXG4gICAgIFRoaXMgdmVuZG9yIHVzZXMgc29tZSB1bnVzdWFsIGFkYXB0YXRpb25zIHRvIG1hbmFnZSBHQTQgZGF0YSBpbnRlZ3JpdHlcbiAgICAgIDEgLSBSZW5hbWUgYm90aCB0aGUgZGF0YUxheWVyIGFuZCBndGFnIG9iamVjdCB0byBwcmV2ZW50IGNsaWVudCB0YWdzIGZyb20gXCJoZWFyaW5nXCJcbiAgICAgICAgICAgIG90aGVyIHB1c2hlcy4gIFNob3VsZG4ndCBoYXBwZW4gaW4gdGhlIElGUkFNRSBidXQgZ3RhZyBoYXMgc2hvd24gaXQgY2FuIGRvIHRoaXNcbiAgICAgICAgICAgIHdoZW4gc2ltaWxhciBhcHByb2FjaCB1c2VkIGluIEdUTVxuICAgICAgICAgICAgICAgIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL3RhZy1wbGF0Zm9ybS9kZXZndWlkZXMvZGF0YUxheWVyI3JlbmFtZV90aGVfZGF0YV9sYXllclxuICAgICAgICAgICAgICAgIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2FuYWx5dGljcy9kZXZndWlkZXMvY29sbGVjdGlvbi9ndGFnanMvcmVuYW1pbmctdGhlLWd0YWctb2JqZWN0XG4gICAgICAyIC0gSGFyZCBkaXNhYmxlIHRvIHRoZSB0cmFja2VyIHdpdGggc2V0VGltZW91dCgpIGFzIG5vcm1hbGx5IGl0IHdpbGwgY29udGludWUgdG8gdHJ5IHRvIGxpc3RlbiBmb3JcbiAgICAgICAgICAgIEVuaGFuY2VkIE1lYXN1cmVtZW50IGV2ZW50cyB3aGljaCB3ZSBjYW5ub3QgY29udHJvbCBidXQgY2xpZW50cyBjYW4gc2V0IGluIHRoZWlyIGNvbmZpZy5cbiAgICAgICAgICAgICAgICBodHRwczovL3N1cHBvcnQuZ29vZ2xlLmNvbS9hbmFseXRpY3MvYW5zd2VyLzkyMTYwNjFcbiAgICAgIDMgLSBVc2UgdGhlIG5ldyB0b2tlbiBmcm9tIEdUTSBvdmVycmlkZSBwcm9kdWN0RGF0YUpzb24sIGFuIGVuaGFuY2VkIGFuZCBmb3JtYXR0ZWQgSlNPTiBvYmplY3QgZm9yIEdBL0NDViB2ZW5kb3JzXG4gICAgKi9cbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICBpZiAoaXNUcmFja2luZ0lkVmFsaWQodGFnKSkge1xuICAgICAgICB2YXIgaHRtbCA9IHNlbGYuZ2VuZXJhdGVHQTRIdG1sU2NyaXB0VGFnKHRhZyk7XG5cbiAgICAgICAgc2VsZi5jcmVhdGVJZnJhbWVXaXRoQ29udGVudCh0YWcuaWQsIGh0bWwsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYubG9nKCdJZnJhbWUgYWRkZWQgZm9yIHBpeGVsOiAnICsgdGFnLmlkKTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgc2VsZi5sb2coJ0ludmFsaWQgR0E0IElEOiAnICsgdGFnLnRyYWNraW5nSWQpO1xuICAgIH1cbn07XG5cbnZhciBpc1RyYWNraW5nSWRWYWxpZCA9ICBmdW5jdGlvbih0YWcpIHtcbiAgICB2YXIgZ2FUcmFja2luZ0lkUHJlZml4ID0gJ0ctJztcbiAgICByZXR1cm4gISF0YWcudHJhY2tpbmdJZCAmJiB0YWcudHJhY2tpbmdJZC5pbmRleE9mKGdhVHJhY2tpbmdJZFByZWZpeCkgIT09IC0xO1xufVxuXG5WZW5kb3JTZXJ2aWNlLnByb3RvdHlwZS5nb29nbGVBbmFseXRpY3MgPSBmdW5jdGlvbiAodGFnLCBpbmRleCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuLy8qKioqKiogR29vZ2xlIEFuYWx5dGljcyAqKioqKiovL1xuXG4gICAgICAgIChmdW5jdGlvbiAoaSwgcywgbywgZywgciwgYSwgbSkge1xuICAgICAgICAgICAgaVsnR29vZ2xlQW5hbHl0aWNzT2JqZWN0J10gPSByO1xuICAgICAgICAgICAgaVtyXSA9IGlbcl0gfHwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAoaVtyXS5xID0gaVtyXS5xIHx8IFtdKS5wdXNoKGFyZ3VtZW50cylcbiAgICAgICAgICAgICAgICB9LCBpW3JdLmwgPSAxICogbmV3IERhdGUoKTtcbiAgICAgICAgICAgIGEgPSBzLmNyZWF0ZUVsZW1lbnQobyksXG4gICAgICAgICAgICAgICAgbSA9IHMuZ2V0RWxlbWVudHNCeVRhZ05hbWUobylbMF07XG4gICAgICAgICAgICBhLmFzeW5jID0gMTtcbiAgICAgICAgICAgIGEuc3JjID0gZztcbiAgICAgICAgICAgIG0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYSwgbSlcbiAgICAgICAgfSkod2luZG93LCBkb2N1bWVudCwgJ3NjcmlwdCcsICcvL3d3dy5nb29nbGUtYW5hbHl0aWNzLmNvbS9hbmFseXRpY3MuanMnLCAnZ2EnKTtcblxuICAgICAgICB2YXIgY29sbGVjdFByb2R1Y3RJbmZvID0gZnVuY3Rpb24gKCl7XG4gICAgICAgIFx0dmFyIHByb2R1Y3RJbmZvID0ge1xuICAgICAgICBcdCAgICAnaWQnOiBzZWxmLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMuZXZlbnRJRCcpLFxuICAgICAgICBcdCAgICAnbmFtZSc6IHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudE5hbWUnKS5yZXBsYWNlKC9cXHgyNy9nLCAnXFxcXFxceDI3JykgKyAnIG9uICcgKyBzZWxmLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMuZXZlbnREYXRlJykgKyAnIGF0ICcgKyBzZWxmLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMudmVudWVOYW1lJykucmVwbGFjZSgvXFx4MjcvZywgJ1xcXFxcXHgyNycpLFxuICAgICAgICBcdCAgICAnY2F0ZWdvcnknOiBzZWxmLmdldFZhbHVlKCdwYWdlLmNhdGVnb3J5LnByaW1hcnlDYXRlZ29yeScpIHx8IHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudFR5cGUnKVxuICAgICAgICBcdH07XG5cbiAgICAgICAgXHRpZihzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50cmFuc2FjdGlvbklEJykpe1xuICAgICAgICBcdFx0cHJvZHVjdEluZm8udmFyaWFudCA9IHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLmF0dHJpYnV0ZXMuaXNSZXNhbGUnKSA/ICdSZXNhbGUnIDogJ1ByaW1hcnknO1xuICAgICAgICBcdCAgICBwcm9kdWN0SW5mby5xdWFudGl0eSA9IHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLmF0dHJpYnV0ZXMudGlja2V0UXVhbnRpdHknKTtcbiAgICAgICAgXHQgICAgcHJvZHVjdEluZm8ucHJpY2UgPSBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5iYXNlUHJpY2UnKS9zZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi5hdHRyaWJ1dGVzLnRpY2tldFF1YW50aXR5Jyk7XG4gICAgICAgIFx0fVxuICAgICAgICBcdFxuICAgICAgICBcdHJldHVybiBwcm9kdWN0SW5mbztcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHZhciBlY29tbWVyY2UgPSBmdW5jdGlvbiAoYWNjdCkge1xuICAgICAgICAgICAgXG5cdCAgICAgICAgdmFyIHJlcXVpcmUgPSBhY2N0ICsgXCIucmVxdWlyZVwiO1xuXHQgICAgICAgIHZhciBlY29tID0gYWNjdCArIFwiLmVjXCI7XG5cdCAgICAgICAgZ2EocmVxdWlyZSwgJ2VjJyk7XG4gICAgICAgICAgICAgICAgXG5cdCAgICAgICAgLy9pZiBpdHMgYSBjb25maXJtYXRpb24gcGFnZSwgYWRkIHByb2R1Y3RzIGFuZCBwdXJjaGFzZSBhY3Rpb25cblx0ICAgICAgICBpZihzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50cmFuc2FjdGlvbklEJykpe1xuXHQgICAgICAgIFx0Z2EoZWNvbSArICc6YWRkUHJvZHVjdCcsIGNvbGxlY3RQcm9kdWN0SW5mbygpKTtcblx0ICAgICAgICBcdGdhKGVjb20gKyAnOnNldEFjdGlvbicsICdwdXJjaGFzZScsIHtcblx0ICAgICAgICBcdFx0ICAnaWQnOiBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50cmFuc2FjdGlvbklEJyksXG5cdCAgICAgICAgXHRcdCAgJ2FmZmlsaWF0aW9uJzogJ1RpY2tldG1hc3RlcicsXG5cdCAgICAgICAgXHRcdCAgJ3JldmVudWUnOiBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5iYXNlUHJpY2UnKVxuXHQgICAgICAgIFx0fSk7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIC8vaWYgeW91IGFyZSBvbiBhbiBFRFAgYW5kIGhhdmUgZXZlbnQgaW5mbywgY291bnQgYW4gaW1wcmVzc2lvblxuXHQgICAgICAgIGVsc2UgaWYgKHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudElEJykpe1xuXHQgICAgICAgIFx0Z2EoZWNvbSArICc6YWRkSW1wcmVzc2lvbicsIGNvbGxlY3RQcm9kdWN0SW5mbygpKTtcblx0ICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICBcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGFnLnRyYWNraW5nSWQgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9ICd0cmFja2VyJyArIHRhZy5pZDtcbiAgICAgICAgICAgICAgICBnYSgnY3JlYXRlJywgdGFnLnRyYWNraW5nSWQsICdhdXRvJywgeyduYW1lJzogbmFtZSwgJ2FsbG93TGlua2VyJzogdHJ1ZX0pO1xuICAgICAgICAgICAgICAgIGVjb21tZXJjZShuYW1lKTtcbiAgICAgICAgICAgICAgICBnYShuYW1lICsgJy5zZW5kJywgJ3BhZ2V2aWV3Jyk7XG4gICAgICAgICAgICB9XG5cbiAgICBcbi8vKioqKioqIEVuZCBHb29nbGUgQW5hbHl0aWNzICoqKioqKi8vXG59O1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUubG90YW1lID0gZnVuY3Rpb24gKHRhZywgaW5kZXgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgICAgICAgICAgIGltZy5zcmMgPSAnaHR0cHM6Ly9iY3AuY3J3ZGNudHJsLm5ldC81L2M9JyArIHRhZy5jbGllbnRJZDtcbiAgICAgICAgICAgIGltZy5zcmMgKz0gJy9iPScgKyB0YWcuYmVoYXZpb3JJZDtcbiAgICAgICAgICAgIGltZy53aWR0aCA9IDE7XG4gICAgICAgICAgICBpbWcuaGVpZ2h0ID0gMTtcblxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChpbWcpO1xuXG59O1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUubWFya2V0byA9IGZ1bmN0aW9uICh0YWcsIGluZGV4KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHZhciBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTtcbiAgICAgICAgaWZyYW1lLnN0eWxlLmNzc1RleHQgPSAnd2lkdGg6MXB4OyBoZWlnaHQ6MXB4OyBkaXNwbGF5Om5vbmU7JztcbiAgICAgICAgaWZyYW1lLmZyYW1lYm9yZGVyID0gMDtcbiAgICAgICAgaWZyYW1lLmlkID0gdGFnLmlkO1xuICAgICAgICB2YXIgaHRtbCA9ICc8c2NyaXB0IHR5cGU9XCJ0ZXh0L2phdmFzY3JpcHRcIiBzcmM9XCIvL211bmNoa2luLm1hcmtldG8ubmV0L211bmNoa2luLmpzXCI+PC9zY3JpcHQ+JztcblxuICAgICAgICBodG1sICs9ICc8c2NyaXB0IHR5cGU9XCJ0ZXh0L2phdmFzY3JpcHRcIj4nO1xuICAgICAgICBodG1sICs9ICdNdW5jaGtpbi5pbml0KFwiJyArIHRhZy5tdW5jaGtpbklkICsgJ1wiKTsnO1xuICAgICAgICBodG1sICs9ICdNdW5jaGtpbi5tdW5jaGtpbkZ1bmN0aW9uKFwidmlzaXRXZWJQYWdlXCIsIHsgdXJsOiBcIicgKyBzZWxmLmdldFZhbHVlKCdwYWdlLnBhZ2VJbmZvLnBhZ2VOYW1lJykgKyAnXCIgfSApOyc7XG4gICAgICAgIGh0bWwgKz0gJzwvc2NyaXB0Pic7XG5cbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChpZnJhbWUpO1xuICAgICAgICB2YXIgZG9jID0gKGlmcmFtZS5jb250ZW50V2luZG93IHx8IGlmcmFtZS5jb250ZW50RG9jdW1lbnQpO1xuXHRcdGlmIChkb2MuZG9jdW1lbnQpZG9jID0gZG9jLmRvY3VtZW50O1xuICAgIFx0ZG9jLm9wZW4oKTtcbiAgICAgICAgZG9jLndyaXRlKGh0bWwpO1xuICAgICAgICBkb2MuY2xvc2UoKTtcblxuICAgICAgICBcbn07XG5WZW5kb3JTZXJ2aWNlLnByb3RvdHlwZS5tZWRpYW1hdGggPSBmdW5jdGlvbiAodGFnLCBpbmRleCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICAgICAgICAgICAgaW1nLnNyYyA9ICcvL3BpeGVsLm1hdGh0YWcuY29tL2V2ZW50L2ltZz9tdF9pZD0nICsgdGFnLnBpeGVsSWQ7XG4gICAgICAgICAgICBpbWcuc3JjICs9ICcmbXRfYWRpZD0nICsgdGFnLmFkdmVydGlzZXJJZDtcbiAgICAgICAgICAgIGltZy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgICAgaW1nLndpZHRoID0gMTtcbiAgICAgICAgICAgIGltZy5oZWlnaHQgPSAxO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIHRhZy5jdXN0b21WYXJpYWJsZXMgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgdmFyIHUgPSB0YWcuY3VzdG9tVmFyaWFibGVzO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodS5oYXNPd25Qcm9wZXJ0eShpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW1nLnNyYyArPSAnJicgKyBpICsgJz0nICsgc2VsZi5nZXRWYWx1ZSh1W2ldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaW1nKTtcblxufTtcblxuVmVuZG9yU2VydmljZS5wcm90b3R5cGUub3JhY2xlQmx1ZWthaSA9IGZ1bmN0aW9uICh0YWcsIGluZGV4KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgLy9sb2FkIHRoZSBsaWJyYXJ5IGluIHRoZSBpRnJhbWVcbiAgICB2YXIgaHRtbCA9ICc8c2NyaXB0Pic7XG4gICAgaHRtbCs9ICd3aW5kb3cuYmtfYXN5bmMgPSBmdW5jdGlvbigpIHsnO1xuICAgIGh0bWwrPSAnYmtfYWRkUGFnZUN0eChcXCcnICsgdGFnLnBoaW50S2V5ICsgJ1xcJywgXFwnJyArIHRhZy5waGludFZhbHVlICsgJ1xcJyk7JztcbiAgICBodG1sKz0gJ0JLVEFHLmRvVGFnKCcgKyB0YWcuc2l0ZUlkICsgJywgMSk7JztcbiAgICBodG1sKz0gJ307JztcblxuICAgIGh0bWwrPSAnKGZ1bmN0aW9uKCkgeyc7XG4gICAgaHRtbCs9ICd2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFxcJ3NjcmlwdFxcJylbMF07JztcbiAgICBodG1sKz0gJ3ZhciBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcXCdzY3JpcHRcXCcpOyc7XG4gICAgaHRtbCs9ICdzLmFzeW5jID0gdHJ1ZTsnO1xuICAgIGh0bWwrPSAncy5zcmMgPSBcImh0dHBzOi8vdGFncy5ia3J0eC5jb20vanMvYmstY29yZXRhZy5qc1wiOyc7XG4gICAgaHRtbCs9ICdzY3JpcHRzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHMsIHNjcmlwdHMpOyc7XG4gICAgaHRtbCs9ICd9KCkpOyc7XG4gICAgaHRtbCs9ICc8L3NjcmlwdD4nO1xuXG4gICAgc2VsZi5jcmVhdGVJZnJhbWVXaXRoQ29udGVudCh0YWcuaWQsIGh0bWwsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2VsZi5sb2coJ0lmcmFtZSBhZGRlZCBmb3IgcGl4ZWw6ICcgKyB0YWcuaWQpO1xuICAgIH0pO1xufVxuXG5cblZlbmRvclNlcnZpY2UucHJvdG90eXBlLm9yYWNsZUVsb3F1YSA9IGZ1bmN0aW9uKHRhZywgaW5kZXgpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgc3JjID0gJy8vcycgKyB0YWcuc2l0ZUlkICsgJy50LmVsb3F1YS5jb20vdmlzaXRvci92MjAwL3N2ckdQP3Bwcz0zJnNpdGVpZD0nICsgdGFnLnNpdGVJZDtcbiAgc2VsZi5jcmVhdGVFbGVtKCdpbWcnLCBzcmMsIHRhZy5pZCk7XG5cbn07XG5WZW5kb3JTZXJ2aWNlLnByb3RvdHlwZS5waW50ZXJlc3QgPSBmdW5jdGlvbiAodGFnLCBpbmRleCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIC8vbG9hZCB0aGUgbGlicmFyeSBpbiB0aGUgaUZyYW1lXG4gICAgdmFyIGh0bWwgPSAnPHNjcmlwdD4nO1xuICAgIGh0bWwgKz0gJyFmdW5jdGlvbihlKXtpZighd2luZG93LnBpbnRyayl7d2luZG93LnBpbnRyayA9IGZ1bmN0aW9uICgpIHsnO1xuICAgIGh0bWwgKz0gJ3dpbmRvdy5waW50cmsucXVldWUucHVzaChBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpKX07JztcbiAgICBodG1sICs9ICd2YXIgbj13aW5kb3cucGludHJrO24ucXVldWU9W10sbi52ZXJzaW9uPVwiMy4wXCI7JztcbiAgICBodG1sICs9ICd2YXIgdD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO3QuYXN5bmM9ITAsdC5zcmM9ZTsnO1xuICAgIGh0bWwgKz0gJ3ZhciByPWRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpWzBdOyc7XG4gICAgaHRtbCArPSAnci5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0LHIpfX0nO1xuICAgIGh0bWwgKz0gJyhcImh0dHBzOi8vcy5waW5pbWcuY29tL2N0L2NvcmUuanNcIik7JztcblxuICAgIGh0bWwgKz0gJ3BpbnRyayhcXCdsb2FkXFwnLCBcXCcnICsgdGFnLmNvbnZlcnNpb25UYWdJZCArICdcXCcpOyc7XG4gICAgaHRtbCArPSAncGludHJrKFxcJ3BhZ2VcXCcpOyc7XG5cbiAgICBpZiAoIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnLCBzZWxmLmNvbmZpZy5kYXRhKSApIHtcbiAgICAgICAgaHRtbCArPSAncGludHJrKFxcJ3RyYWNrXFwnLCBcXCdjaGVja291dFxcJywgeyc7XG4gICAgICAgIGh0bWwgKz0gJ3ZhbHVlOiAnICsgc2VsZi50b0Zsb2F0KHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRvdGFsLmJhc2VQcmljZScpICwgMCkgKyAnLCc7XG4gICAgICAgIGh0bWwgKz0gJ29yZGVyX3F1YW50aXR5OiAnICsgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24uYXR0cmlidXRlcy50aWNrZXRRdWFudGl0eScsIHNlbGYuY29uZmlnLmRhdGEpICsgJywnO1xuICAgICAgICBodG1sICs9ICdjdXJyZW5jeTogXFwnJyArIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRvdGFsLmN1cnJlbmN5JykgKyAnXFwnLCc7XG4gICAgICAgIGh0bWwgKz0gJ2xpbmVfaXRlbXM6IFt7JztcbiAgICAgICAgaHRtbCArPSAncHJvZHVjdF9uYW1lOiBcXCcnICsgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmV2ZW50TmFtZScpICsgJ1xcJywnO1xuICAgICAgICBodG1sICs9ICdwcm9kdWN0X2lkOiBcXCcnICsgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmV2ZW50SUQnKSArICdcXCcsJztcbiAgICAgICAgaHRtbCArPSAncHJvZHVjdF9jYXRlZ29yeTogXFwnJyArIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5hcnRpc3RJRCcpICsgJ1xcJyc7XG4gICAgICAgIGh0bWwgKz0gJ31dJztcbiAgICAgICAgaHRtbCArPSAnfSk7JztcbiAgICB9XG5cbiAgICBodG1sKz0gJzwvc2NyaXB0Pic7XG5cbiAgICBzZWxmLmNyZWF0ZUlmcmFtZVdpdGhDb250ZW50KHRhZy5pZCwgaHRtbCwgZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLmxvZygnSWZyYW1lIGFkZGVkIGZvciBwaXhlbDogJyArIHRhZy5pZCk7XG4gICAgfSk7XG59XG5cblZlbmRvclNlcnZpY2UucHJvdG90eXBlLnF1YW50Y2FzdCA9IGZ1bmN0aW9uICh0YWcsIGluZGV4KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgd2luZG93Ll9xZXZlbnRzID0gd2luZG93Ll9xZXZlbnRzIHx8IFtdO1xuXG4gICAgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGVsZW0gICA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgICAgICBlbGVtLnNyYyAgID1cbiAgICAgICAgICAgIChkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCA9PT0gJ2h0dHBzOicgPyAnaHR0cHM6Ly9zZWN1cmUnIDogJ2h0dHA6Ly9lZGdlJylcbiAgICAgICAgICAgICsgJy5xdWFudHNlcnZlLmNvbS9xdWFudC5qcyc7XG4gICAgICAgIGVsZW0uYXN5bmMgPSB0cnVlO1xuICAgICAgICBlbGVtLnR5cGUgID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgICAgIHZhciBzY3B0ICAgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07XG4gICAgICAgIHNjcHQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZWxlbSwgc2NwdCk7XG4gICAgfSkoKTtcblxuICAgIHZhciBjdXN0ID0gW107XG4gICAgaWYgKCB0eXBlb2YgdGFnLmN1c3RvbUxhYmVscyAhPT0gJ3VuZGVmaW5lZCcgKSB7XG4gICAgICAgIHZhciB1ID0gdGFnLmN1c3RvbUxhYmVscztcbiAgICAgICAgZm9yICggdmFyIGkgaW4gdSApIHtcbiAgICAgICAgICAgIGlmICggdS5oYXNPd25Qcm9wZXJ0eShpKSApIHtcbiAgICAgICAgICAgICAgICBpZiAoIHVbaV0gPT09ICdDVVNUT01fU0VHTUVOVCcgKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1c3QucHVzaCgnX2ZwLmNoYW5uZWwuJyArIGkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICggdVtpXSA9PT0gJ1ZBUklBQkxFJyApIHtcbiAgICAgICAgICAgICAgICAgICAgY3VzdC5wdXNoKCdfZnAuY2hhbm5lbC4nICsgc2VsZi5nZXRWYWx1ZShpKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGN1c3QucHVzaCgnX2ZwLmV2ZW50LicgKyBzZWxmLmdldFZhbHVlKCdwYWdlLnBhZ2VJbmZvLnBhZ2VOYW1lJykpO1xuICAgIGN1c3QucHVzaCgnX2ZwLnBjYXQuJyArIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudE5hbWUnKS5yZXBsYWNlKC9cXHgyNy9nLCAnXFxcXFxceDI3JykpO1xuICAgIHZhciBsYWJlbFN0cmluZyA9IGN1c3Quam9pbignLCAnKTtcbiAgICBpZiAoIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnKSApIHtcbiAgICAgICAgX3FldmVudHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHFhY2N0OiAgIHRhZy5wY29kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxzOiAgbGFiZWxTdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyaWQ6IHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2ZW51ZTogc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udG90YWwuYmFzZVByaWNlJykudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgX3FldmVudHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHFhY2N0OiAgdGFnLnBjb2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbHM6IGxhYmVsU3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgfVxuXG59O1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUucm9ja2V0ZnVlbCA9IGZ1bmN0aW9uICh0YWcsIGluZGV4KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4vLzwhLS0gQmVnaW4gUm9ja2V0IEZ1ZWwgQ29udmVyc2lvbiBBY3Rpb24gVHJhY2tpbmcgQ29kZSBWZXJzaW9uIDkgLS0+XG4gICAgICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdyA9IHdpbmRvdywgZCA9IGRvY3VtZW50O1xuICAgICAgICAgICAgdmFyIHMgPSBkLmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgICAgICAgICAgcy5zZXRBdHRyaWJ1dGUoJ2FzeW5jJywgJ3RydWUnKTtcbiAgICAgICAgICAgIHMuc2V0QXR0cmlidXRlKCd0eXBlJywgJ3RleHQvamF2YXNjcmlwdCcpO1xuICAgICAgICAgICAgcy5zZXRBdHRyaWJ1dGUoJ3NyYycsICcvL2MxLnJmaWh1Yi5uZXQvanMvdGMubWluLmpzJyk7XG4gICAgICAgICAgICB2YXIgZiA9IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdO1xuICAgICAgICAgICAgZi5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzLCBmKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygd1snX3JmaSddICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgd1snX3JmaSddID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB3WydfcmZpJ10uY29tbWFuZHMgPSB3WydfcmZpJ10uY29tbWFuZHMgfHwgW107XG4gICAgICAgICAgICAgICAgICAgIHdbJ19yZmknXS5jb21tYW5kcy5wdXNoKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfcmZpKCdzZXRBcmdzJywgJ3ZlcicsICc5Jyk7XG4gICAgICAgICAgICAgICAgX3JmaSgnc2V0QXJncycsICdyYicsIHRhZy5hY2NvdW50SWQpO1xuICAgICAgICAgICAgICAgIF9yZmkoJ3NldEFyZ3MnLCAnY2EnLCB0YWcuY29udmVyc2lvbklkKTtcbiAgICAgICAgICAgICAgICBfcmZpKCd0cmFjaycpO1xuICAgICAgICB9KSgpO1xuXG59O1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUucnViaWNvbkNvbnZlcnNpb24gPSBmdW5jdGlvbiAodGFnLCBpbmRleCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIGlmICggc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcpICkge1xuICAgICAgICB2YXIgc3JjID0gJy8vYXMuY2hhbmdvLmNvbS9jb252L2k/JyArIHRhZy5jb252ZXJzaW9uSWQgKyAnJmNvc3Q9JyArIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRvdGFsLmJhc2VQcmljZScpICsgJyZvcmRlcl9pZD0nICsgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcpICsgJyZxdWFudGl0eT0nICsgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24uYXR0cmlidXRlcy50aWNrZXRRdWFudGl0eScpO1xuICAgICAgICBzZWxmLmNyZWF0ZUVsZW0oJ2ltZycsIHNyYywgdGFnLmlkKTtcbiAgICB9XG59O1xuXG5WZW5kb3JTZXJ2aWNlLnByb3RvdHlwZS5ydWJpY29uUmV0YXJnZXRpbmcgPSBmdW5jdGlvbiAodGFnLCBpbmRleCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciBzcmMgPSAnLy9jYy5jaGFuZ28uY29tL2Mvbz9waWQ9JyArIHRhZy5zZWdtZW50SWQ7XG4gICAgc2VsZi5jcmVhdGVFbGVtKCdpbWcnLCBzcmMsIHRhZy5pZCk7XG5cbn07XG5WZW5kb3JTZXJ2aWNlLnByb3RvdHlwZS5zaXRlc2NvdXQgPSBmdW5jdGlvbiAodGFnLCBpbmRleCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgc3JjICA9IHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnKSA/ICcvL2NsaWNrc2Vydi5zaXRlc2NvdXQuY29tL2NvbnYvJyArIHRhZy5jb252ZXJzaW9uSWQgKyAnLycgKyBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5iYXNlUHJpY2UnKSA6ICgnLy9waXhlbC5zaXRlc2NvdXQuY29tL2lhcC8nICsgdGFnLmNvbnZlcnNpb25JZCk7XG5cbiAgICBzZWxmLmNyZWF0ZUVsZW0oJ2ltZycsIHNyYywgdGFnLmlkKTtcblxufTtcblZlbmRvclNlcnZpY2UucHJvdG90eXBlLnNpem1la1YyID0gZnVuY3Rpb24gKHRhZywgaW5kZXgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAvLyoqKioqKiBTdGFydCBTaXptZWsgKioqKioqLy9cbiAgICB2YXIgcm5kID0gTWF0aC5yYW5kb20oKSAqIDEwMDAwMDA7XG5cbiAgICB2YXIgZXAgPSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCArICcvL2JzLnNlcnZpbmctc3lzLmNvbS9CdXJzdGluZ1BpcGUvQWN0aXZpdHlTZXJ2ZXIuYnM/aWZybT0xJmNuPWFzJnJuZD0nICsgcm5kICsgJyYnO1xuXG4gICAgdmFyIHN0YW5kYXJkUGFyYW1zID0gW1xuICAgICAgICBbJ1Byb2R1Y3RJRCcsIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudElEJyldLFxuICAgICAgICBbJ1Byb2R1Y3RJbmZvJywgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmV2ZW50TmFtZScpLnJlcGxhY2UoL1xceDI3L2csICdcXFxcXFx4MjcnKV1cbiAgICBdO1xuXG4gICAgdmFyIGVuaGFuY2VkUGFyYW1zID0gW1xuICAgICAgICBbJ0FydGlzdElEJywgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmFydGlzdElEJyldLFxuICAgICAgICBbJ0FydGlzdE5hbWUnLCBzZWxmLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMuYXJ0aXN0TmFtZScpXSxcbiAgICAgICAgWydDb3VudHJ5Jywgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmNvdW50cnknKV0sXG4gICAgICAgIFsnRXZlbnREYXRlJywgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmV2ZW50RGF0ZScpXSxcbiAgICAgICAgWydFdmVudFN0YXRlJywgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLnN0YXRlJyldLFxuICAgICAgICBbJ0V2ZW50VGltZScsIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudFRpbWUnKV0sXG4gICAgICAgIFsnRXZlbnRaaXAnLCBzZWxmLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMuemlwJyldLFxuICAgICAgICBbJ01ham9yY2F0SUQnLCBzZWxmLmdldFZhbHVlKCdwYWdlLmNhdGVnb3J5LnByaW1hcnlDYXRlZ29yeUlEJyldLFxuICAgICAgICBbJ01pbm9yY2F0SUQnLCBzZWxmLmdldFZhbHVlKCdwYWdlLmNhdGVnb3J5LnN1YkNhdGVnb3J5MUlEJyldLFxuICAgICAgICBbJ1BhZ2VOYW1lJywgc2VsZi5nZXRWYWx1ZSgncGFnZS5wYWdlSW5mby5wYWdlTmFtZScpXSxcbiAgICAgICAgWydWZW51ZUlEJywgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLnZlbnVlSUQnKV0sXG4gICAgICAgIFsnVmVudWVOYW1lJywgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLnZlbnVlTmFtZScpLnJlcGxhY2UoL1xceDI3L2csICdcXFxcXFx4MjcnKV0sXG4gICAgICAgIFsnVmVudWVaaXAnLCBzZWxmLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMuemlwJyldXG4gICAgXTtcblxuICAgIGlmICggc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcpICkge1xuXG4gICAgICAgIHZhciB2YWx1ZSA9IHBhcnNlRmxvYXQoc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udG90YWwuYmFzZVByaWNlJykpLnRvRml4ZWQoMik7XG4gICAgICAgIHN0YW5kYXJkUGFyYW1zLnB1c2goWydPcmRlcklEJywgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcpXSk7XG4gICAgICAgIHN0YW5kYXJkUGFyYW1zLnB1c2goWydWYWx1ZScsIHZhbHVlXSk7XG4gICAgICAgIHN0YW5kYXJkUGFyYW1zLnB1c2goWydRdWFudGl0eScsIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLmF0dHJpYnV0ZXMudGlja2V0UXVhbnRpdHknKV0pO1xuXG4gICAgICAgIHZhciBpbnZlbnRvcnlUeXBlID0gKCBwYXJzZUludChzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi5hdHRyaWJ1dGVzLmlzUmVzYWxlJykgKyAwKSAhPT0gMCApID8gJ3Jlc2FsZScgOiAncHJpbWFyeSc7XG4gICAgICAgIGVuaGFuY2VkUGFyYW1zLnB1c2goWydJbnZlbnRvcnlUeXBlJywgaW52ZW50b3J5VHlwZV0pO1xuICAgICAgICBlbmhhbmNlZFBhcmFtcy5wdXNoKFsnUHVyY2hhc2VEYXRlJywgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24uYXR0cmlidXRlcy5vcmRlckRhdGUnKV0pO1xuICAgICAgICBlbmhhbmNlZFBhcmFtcy5wdXNoKFsnUHVyY2hhc2VUaW1lJywgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24uYXR0cmlidXRlcy5vcmRlclRpbWUnKV0pO1xuXG4gICAgfVxuXG4gICAgdmFyIHByZWZpeGVkUGFyYW1zID0gW10sXG4gICAgICAgIGFjdGl2aXR5SWQgICAgID0gdHlwZW9mIHRhZy5hY3Rpdml0eUlkICE9PSAndW5kZWZpbmVkJyA/IHRhZy5hY3Rpdml0eUlkIDogJzAwMDAwJztcblxuICAgIHZhciBwcmVmaXggPSAnJztcbiAgICBpZiAoIHR5cGVvZiB0YWcucHJlZml4ICE9PSAndW5kZWZpbmVkJyApIHtcbiAgICAgICAgcHJlZml4ID0gdGFnLnByZWZpeDtcbiAgICB9XG5cbiAgICAvL2FsbCB0YWdzIGdldCB0aGUgc3RhbmRhcmQgcGFyYW1zXG4gICAgZm9yICggdmFyIGogPSAwOyBqIDwgc3RhbmRhcmRQYXJhbXMubGVuZ3RoOyBqKysgKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHN0YW5kYXJkUGFyYW1zW2pdO1xuICAgICAgICBwcmVmaXhlZFBhcmFtcy5wdXNoKFtwcmVmaXggKyBwYXJhbVswXSwgcGFyYW1bMV1dKTtcbiAgICB9XG5cbiAgICAvL2FkZCBleHRyYSB2YXJpYWJsZXMgZm9yIGVuaGFuY2VkIHRhZ3NcbiAgICBpZiAoIHRhZy5lbmhhbmNlZERhdGEgJiYgdGFnLmVuaGFuY2VkRGF0YSA9PT0gdHJ1ZSApIHtcbiAgICAgICAgZm9yICggdmFyIGsgPSAwOyBrIDwgZW5oYW5jZWRQYXJhbXMubGVuZ3RoOyBrKysgKSB7XG4gICAgICAgICAgICB2YXIgcGFyYW0gPSBlbmhhbmNlZFBhcmFtc1trXTtcbiAgICAgICAgICAgIHByZWZpeGVkUGFyYW1zLnB1c2goW3ByZWZpeCArIHBhcmFtWzBdLCBwYXJhbVsxXV0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgKGZ1bmN0aW9uIChlcCwgcCwgZCkge1xuXG4gICAgICAgIHZhciBzaXptZWtGcmFtZSAgICAgICAgICAgPSBkLmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpO1xuICAgICAgICBzaXptZWtGcmFtZS5zdHlsZS5jc3NUZXh0ID0gJ3dpZHRoOjFweDsgaGVpZ2h0OjFweDsgZGlzcGxheTpub25lOyc7XG4gICAgICAgIHZhciB1cmwgICAgICAgICAgICAgICAgICAgPSBlcCArICdBY3Rpdml0eUlEPScgKyBhY3Rpdml0eUlkICsgJyYnO1xuICAgICAgICBwLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XG4gICAgICAgICAgICB1cmwgKz0gaXRlbVswXSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudChpdGVtWzFdKSArICcmJztcbiAgICAgICAgfSk7XG4gICAgICAgIHNpem1la0ZyYW1lLnNyYyAgICAgICAgID0gdXJsO1xuICAgICAgICBzaXptZWtGcmFtZS53aWR0aCAgICAgICA9IDA7XG4gICAgICAgIHNpem1la0ZyYW1lLmhlaWdodCAgICAgID0gMDtcbiAgICAgICAgc2l6bWVrRnJhbWUuZnJhbWVib3JkZXIgPSAwO1xuICAgICAgICBzaXptZWtGcmFtZS5oc3BhY2UgICAgICA9IDA7XG4gICAgICAgIHNpem1la0ZyYW1lLnZzcGFjZSAgICAgID0gMDtcbiAgICAgICAgc2l6bWVrRnJhbWUuc2Nyb2xsaW5nICAgPSAnbm8nO1xuICAgICAgICBzaXptZWtGcmFtZS50aXRsZSAgICAgICA9ICdBZHZlcnRpc2VtZW50IENvbnRlbnQnO1xuICAgICAgICBzaXptZWtGcmFtZS5ib3JkZXJjb2xvciA9ICcjMDAwMDAwJztcblxuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNpem1la0ZyYW1lKTtcblxuICAgIH0pKGVwLCBwcmVmaXhlZFBhcmFtcywgZG9jdW1lbnQpO1xuXHRcbn07XG5WZW5kb3JTZXJ2aWNlLnByb3RvdHlwZS5zaXptZWsgPSBmdW5jdGlvbiAodGFnLCBpbmRleCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuLy8qKioqKiogU3RhcnQgU2l6bWVrICoqKioqKi8vXG4gICAgdmFyIHJuZCA9IE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwO1xuXG4gICAgdmFyIGVwICAgICA9IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sXG4gICAgICAgICAgICAgICAgICsgJy8vYnMuc2VydmluZy1zeXMuY29tL0J1cnN0aW5nUGlwZS9BY3Rpdml0eVNlcnZlci5icz9pZnJtPTEmY249YXMmcm5kPScgKyBybmQgKyAnJicsXG4gICAgICAgIHBhcmFtcyA9IFtcbiAgICAgICAgICAgIFsnQXJ0aXN0SUQnLCBzZWxmLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMuYXJ0aXN0SUQnKV0sXG4gICAgICAgICAgICBbJ1ZlbnVlSUQnLCBzZWxmLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMudmVudWVJRCcpXSxcbiAgICAgICAgICAgIFsnTWlub3JjYXRJRCcsIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuY2F0ZWdvcnkuc3ViQ2F0ZWdvcnkxSUQnKV0sXG4gICAgICAgICAgICBbJ01ham9yY2F0SUQnLCBzZWxmLmdldFZhbHVlKCdwYWdlLmNhdGVnb3J5LnByaW1hcnlDYXRlZ29yeUlEJyldLFxuICAgICAgICAgICAgWydFdmVudElEJywgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLmV2ZW50SUQnKV0sXG4gICAgICAgICAgICBbJ0V2ZW50TmFtZScsIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudE5hbWUnKS5yZXBsYWNlKC9cXHgyNy9nLCAnXFxcXFxceDI3JyldLFxuICAgICAgICAgICAgWydWZW51ZVppcCcsIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy56aXAnKV0sXG4gICAgICAgICAgICBbJ0RtYUlEJywgc2VsZi5nZXRWYWx1ZSgnRE1BIElEJyldLFxuICAgICAgICAgICAgWydFdmVudFRpbWUnLCBzZWxmLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMuZXZlbnRUaW1lJyldLFxuICAgICAgICAgICAgWydFdmVudFN0YXRlJywgc2VsZi5nZXRWYWx1ZSgncGFnZS5hdHRyaWJ1dGVzLnN0YXRlJyldLFxuICAgICAgICAgICAgWydFdmVudFppcCcsIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy56aXAnKV0sXG4gICAgICAgICAgICBbJ0V2ZW50RGF0ZScsIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudERhdGUnKV0sXG4gICAgICAgICAgICBbJ0NvdW50cnknLCBzZWxmLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMuY291bnRyeScpXSxcbiAgICAgICAgICAgIFsnRXZlbnRUaW1lWm9uZScsICcnXSxcbiAgICAgICAgICAgIFsnUHJvbW90ZXInLCBzZWxmLmdldFZhbHVlKCdwYWdlLnBhZ2VJbmZvLnByb21vdGVySUQnKV0sXG4gICAgICAgICAgICBbJ1Byb2R1Y3RJRCcsIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudElEJyldLFxuICAgICAgICAgICAgWydQcm9kdWN0SW5mbycsIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudE5hbWUnKS5yZXBsYWNlKC9cXHgyNy9nLCAnXFxcXFxceDI3JyldXG4gICAgICAgIF07XG5cbiAgICBpZiAoIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnKSApIHtcblxuICAgICAgICB2YXIgdmFsdWUgPSBwYXJzZUZsb2F0KHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRvdGFsLmJhc2VQcmljZScpKS50b0ZpeGVkKDIpO1xuXG4gICAgICAgIHBhcmFtcy5wdXNoKFsnUHVyY2hhc2VUaW1lJywgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24uYXR0cmlidXRlcy5vcmRlclRpbWUnKV0pO1xuICAgICAgICBwYXJhbXMucHVzaChbJ1B1cmNoYXNlRGF5JywgJyddKTtcbiAgICAgICAgcGFyYW1zLnB1c2goWydQdXJjaGFzZURhdGUnLCBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi5hdHRyaWJ1dGVzLm9yZGVyRGF0ZScpXSk7XG4gICAgICAgIHBhcmFtcy5wdXNoKFsnQ29uZkNvZGUnLFxuICAgICAgICAgICAgICAgICAgICAgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcpXSk7XG4gICAgICAgIHBhcmFtcy5wdXNoKFsnT3JkZXJJRCcsXG4gICAgICAgICAgICAgICAgICAgICBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50cmFuc2FjdGlvbklEJyldKTtcbiAgICAgICAgcGFyYW1zLnB1c2goWydGVmFsdWUnLCB2YWx1ZV0pO1xuICAgICAgICBwYXJhbXMucHVzaChbJ1ZhbHVlJywgdmFsdWVdKTtcbiAgICAgICAgcGFyYW1zLnB1c2goWydUaXhQJywgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24uYXR0cmlidXRlcy50aWNrZXRRdWFudGl0eScpXSk7XG4gICAgICAgIHBhcmFtcy5wdXNoKFsnUXVhbnRpdHknLCBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi5hdHRyaWJ1dGVzLnRpY2tldFF1YW50aXR5JyldKTtcbiAgICAgICAgLy90b2RvOmZpeCB0aGlzIGZvciBldmVyeW9uZVxuICAgICAgICBpZiAoIHdpbmRvdy50bV9vbW4gJiYgd2luZG93LnRtX29tbi5lVmFyMzMgKSB7XG4gICAgICAgICAgICBwYXJhbXMucHVzaChbJ1RpY2tldFR5cGUnLCB3aW5kb3cudG1fb21uLmVWYXIzM10pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGFyYW1zLnB1c2goWydUaWNrZXRUeXBlJywgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24uYXR0cmlidXRlcy50aWNrZXRUeXBlJyldKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCAvXFwvcmVzYWxlXFwvY2hlY2tvdXRcXC9vcmRlci8udGVzdChkb2N1bWVudC5sb2NhdGlvbi5wYXRobmFtZSkgKSB7XG4gICAgICAgICAgICBwYXJhbXMucHVzaChbJ1BhZ2UnLCAnY2hlY2tvdXRfcmVzYWxlJ10pO1xuICAgICAgICAgICAgcGFyYW1zLnB1c2goWydQYWdlTmFtZScsIHNlbGYuZ2V0VmFsdWUoJ3BhZ2UucGFnZUluZm8ucGFnZU5hbWUnKV0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGFyYW1zLnB1c2goWydQYWdlTmFtZScsICdjb25maXJtYXRpb24nXSk7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBwYXJhbXMucHVzaChbJ1BhZ2VOYW1lJywgc2VsZi5nZXRWYWx1ZSgncGFnZS5wYWdlSW5mby5wYWdlTmFtZScpXSk7XG4gICAgfVxuICAgIHZhciBpID0gMDtcblxuICAgIHZhciBwcmVmaXhlZFBhcmFtcyA9IFtdLFxuICAgICAgICBhY3Rpdml0eUlkICAgICA9IHR5cGVvZiB0YWcuYWN0aXZpdHlJZCAhPT0gJ3VuZGVmaW5lZCcgPyB0YWcuYWN0aXZpdHlJZCA6ICcwMDAwMCc7XG4gICAgaWYgKCB0eXBlb2YgdGFnLnByZWZpeCAhPT0gJ3VuZGVmaW5lZCcgKSB7XG4gICAgICAgIGZvciAoIHZhciBqID0gMDsgaiA8IHBhcmFtcy5sZW5ndGg7IGorKyApIHtcbiAgICAgICAgICAgIHBhcmFtID0gcGFyYW1zW2pdO1xuICAgICAgICAgICAgcHJlZml4ZWRQYXJhbXMucHVzaChbdGFnLnByZWZpeCArIHBhcmFtWzBdLCBwYXJhbVsxXV0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCB0eXBlb2YgdGFnLnR5cGUubmFtZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdGFnLnR5cGUubmFtZS5pbmRleE9mKCc6UmV0YXJnZXRpbmcnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICE9PSAtMSApIHtcbiAgICAgICAgdmFyIHVybCA9ICdodHRwczovL2JzLnNlcnZpbmctc3lzLmNvbS9TZXJ2aW5nP0NOPW50dCZUSUQ9JyArIGFjdGl2aXR5SWRcbiAgICAgICAgICAgICAgICAgICsgJyZUVkFMPXomcm5kPScgKyBlYlJhbmQ7XG4gICAgICAgIHNlbGYuYWpheCh1cmwpO1xuXG4gICAgfSBlbHNlIHtcblxuICAgICAgICAoZnVuY3Rpb24gKGVwLCBwLCBkKSB7XG5cbiAgICAgICAgICAgIHZhciBzaXptZWtGcmFtZSAgICAgICAgICAgPSBkLmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpO1xuICAgICAgICAgICAgc2l6bWVrRnJhbWUuc3R5bGUuY3NzVGV4dCA9ICd3aWR0aDoxcHg7IGhlaWdodDoxcHg7IGRpc3BsYXk6bm9uZTsnO1xuICAgICAgICAgICAgdmFyIHVybCAgICAgICAgICAgICAgICAgICA9IGVwICsgJ0FjdGl2aXR5SUQ9JyArIGFjdGl2aXR5SWQgKyAnJic7XG4gICAgICAgICAgICBwLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgdXJsICs9IGl0ZW1bMF0gKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQoaXRlbVsxXSkgKyAnJic7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNpem1la0ZyYW1lLnNyYyAgICAgICAgID0gdXJsO1xuICAgICAgICAgICAgc2l6bWVrRnJhbWUud2lkdGggICAgICAgPSAwO1xuICAgICAgICAgICAgc2l6bWVrRnJhbWUuaGVpZ2h0ICAgICAgPSAwO1xuICAgICAgICAgICAgc2l6bWVrRnJhbWUuZnJhbWVib3JkZXIgPSAwO1xuICAgICAgICAgICAgc2l6bWVrRnJhbWUuaHNwYWNlICAgICAgPSAwO1xuICAgICAgICAgICAgc2l6bWVrRnJhbWUudnNwYWNlICAgICAgPSAwO1xuICAgICAgICAgICAgc2l6bWVrRnJhbWUuc2Nyb2xsaW5nICAgPSAnbm8nO1xuICAgICAgICAgICAgc2l6bWVrRnJhbWUudGl0bGUgICAgICAgPSAnQWR2ZXJ0aXNlbWVudCBDb250ZW50JztcbiAgICAgICAgICAgIHNpem1la0ZyYW1lLmJvcmRlcmNvbG9yID0gJyMwMDAwMDAnO1xuXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNpem1la0ZyYW1lKTtcblxuICAgICAgICB9KShlcCwgcHJlZml4ZWRQYXJhbXMubGVuZ3RoID4gMCA/IHByZWZpeGVkUGFyYW1zIDogcGFyYW1zLCBkb2N1bWVudCk7XG4gICAgfVxuXG4vLyoqKioqKiBFbmQgU2l6bWVrICoqKioqKi8vXG59O1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUuc25hcCA9IGZ1bmN0aW9uICh0YWcsIGluZGV4KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgLy9sb2FkIHRoZSBsaWJyYXJ5IGluIHRoZSBpRnJhbWVcbiAgICB2YXIgaHRtbCA9ICc8c2NyaXB0Pic7XG4gICAgaHRtbCArPSAnKGZ1bmN0aW9uKHdpbiwgZG9jLCBzZGtfdXJsKXsnICtcbiAgICAgICAgJ2lmKHdpbi5zbmFwdHIpIHJldHVybjsnICtcbiAgICAgICAgJ3ZhciB0cj13aW4uc25hcHRyPWZ1bmN0aW9uKCl7JyArXG4gICAgICAgICd0ci5oYW5kbGVSZXF1ZXN0PyB0ci5oYW5kbGVSZXF1ZXN0LmFwcGx5KHRyLCBhcmd1bWVudHMpOnRyLnF1ZXVlLnB1c2goYXJndW1lbnRzKTsnICtcbiAgICAgICAgJ307JyArXG4gICAgICAgICd0ci5xdWV1ZSA9IFtdO3YnICtcbiAgICAgICAgJ2FyIHM9XFwnc2NyaXB0XFwnOycgK1xuICAgICAgICAndmFyIG5ld19zY3JpcHRfc2VjdGlvbj1kb2MuY3JlYXRlRWxlbWVudChzKTsnICtcbiAgICAgICAgJ25ld19zY3JpcHRfc2VjdGlvbi5hc3luYz0hMDsnICtcbiAgICAgICAgJ25ld19zY3JpcHRfc2VjdGlvbi5zcmM9c2RrX3VybDsnICtcbiAgICAgICAgJ3ZhciBpbnNlcnRfcG9zPWRvYy5nZXRFbGVtZW50c0J5VGFnTmFtZShzKVswXTsnICtcbiAgICAgICAgJ2luc2VydF9wb3MucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobmV3X3NjcmlwdF9zZWN0aW9uLCBpbnNlcnRfcG9zKTt9KScgK1xuICAgICAgICAnKHdpbmRvdywgZG9jdW1lbnQsIFxcJ2h0dHBzOi8vc2Mtc3RhdGljLm5ldC9zY2V2ZW50Lm1pbi5qc1xcJyk7JztcbiAgICBodG1sICs9ICdzbmFwdHIoXFwnaW5pdFxcJyxcXCcnICsgdGFnLnBpeGVsSWQgKyAnXFwnKTsnO1xuICAgIGh0bWwgKz0gJ3NuYXB0cihcXCd0cmFja1xcJyxcXCdQQUdFX1ZJRVdcXCcpOyc7XG5cbiAgICBpZiAoIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnLCBzZWxmLmNvbmZpZy5kYXRhKSApIHtcbiAgICAgICAgaHRtbCArPSAnc25hcHRyKFxcJ3RyYWNrXFwnLFxcJ1BVUkNIQVNFXFwnLCAgeyc7XG4gICAgICAgIGh0bWwgKz0gJ1xcJ2N1cnJlbmN5XFwnOlxcJycgKyBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5jdXJyZW5jeScpICsgJ1xcJywnO1xuICAgICAgICBodG1sICs9ICdcXCdwcmljZVxcJzonICsgc2VsZi50b0Zsb2F0KHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRvdGFsLmJhc2VQcmljZScpICwgMCkgKyAnLCc7XG4gICAgICAgIGh0bWwgKz0gJ1xcJ251bWJlcl9pdGVtc1xcJzpcXCcnICsgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24uYXR0cmlidXRlcy50aWNrZXRRdWFudGl0eScsIHNlbGYuY29uZmlnLmRhdGEpICsgJ1xcJywnO1xuICAgICAgICBodG1sICs9ICdcXCd0cmFuc2FjdGlvbl9pZFxcJzpcXCcnICsgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcsIHNlbGYuY29uZmlnLmRhdGEpICsgJ1xcJyc7XG4gICAgICAgIGh0bWwgKz0gJ30pOyc7XG4gICAgfVxuXG4gICAgaHRtbCs9ICc8L3NjcmlwdD4nO1xuXG4gICAgc2VsZi5jcmVhdGVJZnJhbWVXaXRoQ29udGVudCh0YWcuaWQsIGh0bWwsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2VsZi5sb2coJ0lmcmFtZSBhZGRlZCBmb3IgcGl4ZWw6ICcgKyB0YWcuaWQpO1xuICAgIH0pO1xufVxuXG5WZW5kb3JTZXJ2aWNlLnByb3RvdHlwZS5zcG9ydHNEZXNrID0gZnVuY3Rpb24gKHRhZywgaW5kZXgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB2YXIgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAgaW1nLnNyYyA9ICcvL3NlY2ZsZC52bW1weGwuY29tLz9ia3Q9JyArIHRhZy5waXhlbElkO1xuXG4gICAgaWYgKCB0eXBlb2YgdGFnLmN1c3RvbVZhcmlhYmxlcyAhPT0gJ3VuZGVmaW5lZCcgKSB7XG4gICAgICAgIHZhciB1ID0gdGFnLmN1c3RvbVZhcmlhYmxlcztcbiAgICAgICAgZm9yICggdmFyIGkgaW4gdSApIHtcbiAgICAgICAgICAgIGlmICggdS5oYXNPd25Qcm9wZXJ0eShpKSApIHtcbiAgICAgICAgICAgICAgICBpbWcuc3JjICs9ICcmJyArIGkgKyAnPScgKyBzZWxmLmdldFZhbHVlKHVbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaW1nKTtcbn07XG5cblZlbmRvclNlcnZpY2UucHJvdG90eXBlLnRoZVRyYWRlRGVza1VuaXZlcnNhbCA9IGZ1bmN0aW9uICh0YWcsIGluZGV4KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgLy9sb2FkIHRoZSBsaWJyYXJ5IGluIHRoZSBpRnJhbWVcbiAgICB2YXIgaHRtbCA9ICc8c2NyaXB0IHNyYz1cImh0dHBzOi8vanMuYWRzcnZyLm9yZy91cF9sb2FkZXIuMS4xLjAuanNcIj48L3NjcmlwdD4nO1xuICAgIGh0bWwgKz0gJzxzY3JpcHQ+JztcbiAgICBodG1sICs9ICd2YXIgZHluUGFyYW0gPSB7fTsnO1xuXG4gICAgaWYgKCBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50cmFuc2FjdGlvbklEJywgc2VsZi5jb25maWcuZGF0YSkgKSB7XG4gICAgICAgIGh0bWwgKz0gJ2R5blBhcmFtLm9yZGVyaWQgPSBcXCcnICsgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcsIHNlbGYuY29uZmlnLmRhdGEpICsgJ1xcJzsnO1xuICAgICAgICBodG1sICs9ICdkeW5QYXJhbS52ID0gXFwnJyArIHNlbGYudG9GbG9hdChzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5iYXNlUHJpY2UnKSAsIDApICsgJ1xcJzsnO1xuICAgICAgICBodG1sICs9ICdkeW5QYXJhbS52ZiA9IFxcJycgKyBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5jdXJyZW5jeScpICsgJ1xcJzsnO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdGFnLmN1c3RvbVZhcmlhYmxlcyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdmFyIHUgPSB0YWcuY3VzdG9tVmFyaWFibGVzO1xuICAgICAgICBmb3IgKHZhciBpIGluIHUpIHtcbiAgICAgICAgICAgIGlmICh1Lmhhc093blByb3BlcnR5KGkpKSB7XG4gICAgICAgICAgICAgICAgaHRtbCArPSAnZHluUGFyYW0uJyArIGkgKyAnID0gXFwnJyArIHNlbGYuZ2V0VmFsdWUodVtpXSwgc2VsZi5jb25maWcuZGF0YSkgKyAnXFwnOyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBodG1sICs9ICd0dGRfZG9tX3JlYWR5KCBmdW5jdGlvbigpIHsnO1xuICAgIGh0bWwgKz0gJ2lmICh0eXBlb2YgVFREVW5pdmVyc2FsUGl4ZWxBcGkgPT09IFxcJ2Z1bmN0aW9uXFwnKSB7JztcbiAgICBodG1sICs9ICd2YXIgdW5pdmVyc2FsUGl4ZWxBcGkgPSBuZXcgVFREVW5pdmVyc2FsUGl4ZWxBcGkoKTsnO1xuICAgIGh0bWwgKz0gJ3VuaXZlcnNhbFBpeGVsQXBpLmluaXQoXCInICsgdGFnLmFkdmVydGlzZXJJZCArICdcIiwgW1wiJyArIHRhZy50YWdJZCArICdcIl0sIFwiaHR0cHM6Ly9pbnNpZ2h0LmFkc3J2ci5vcmcvdHJhY2svdXBcIiwgZHluUGFyYW0pOyc7XG4gICAgaHRtbCArPSAnfSc7XG4gICAgaHRtbCArPSAnfSk7JztcblxuICAgIGh0bWwrPSAnPC9zY3JpcHQ+JztcblxuICAgIHNlbGYuY3JlYXRlSWZyYW1lV2l0aENvbnRlbnQodGFnLmlkLCBodG1sLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYubG9nKCdJZnJhbWUgYWRkZWQgZm9yIHBpeGVsOiAnICsgdGFnLmlkKTtcbiAgICB9KTtcbn1cblxuVmVuZG9yU2VydmljZS5wcm90b3R5cGUudGhlVHJhZGVEZXNrID0gZnVuY3Rpb24odGFnLCBpbmRleCkge1xuXHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHR2YXIgc3JjID0gJy8vaW5zaWdodC5hZHNydnIub3JnL3RyYWNrL2V2bnQvP2Fkdj0nICsgdGFnLmFkdmVydGlzZXJJZCArICcmY3Q9JyArIHRhZy5jb250ZW50SWQgKyAnJmZtdD0zJztcblxuXHRcdGlmICggc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udHJhbnNhY3Rpb25JRCcpICkge1xuXHRcdFx0c3JjID0gJy8vaW5zaWdodC5hZHNydnIub3JnL3RyYWNrL2NvbnYvP2Fkdj0nICsgdGFnLmFkdmVydGlzZXJJZCArICcmY3Q9JyArIHRhZy5jb250ZW50SWQgKyAnJmZtdD0zJztcblx0XHRcdHNyYyA9IHNyYyArICcmdj0nICsgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udG90YWwuYmFzZVByaWNlJykgKyAnJnZmPScgKyBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5jdXJyZW5jeScpICsgJyZvcmRlcmlkPScgKyBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50cmFuc2FjdGlvbklEJyk7XG5cdFx0fVxuXG5cdFx0aWYgKCB0eXBlb2YgdGFnLmN1c3RvbVZhcmlhYmxlcyAhPT0gJ3VuZGVmaW5lZCcgKSB7XG5cdFx0XHR2YXIgdSA9IHRhZy5jdXN0b21WYXJpYWJsZXM7XG5cdFx0XHRmb3IgKCB2YXIgaiBpbiB1ICkge1xuXHRcdFx0XHRpZiAoIHUuaGFzT3duUHJvcGVydHkoaikgKSB7XG5cdFx0XHRcdFx0c3JjICs9ICcmJyArIGogKyAnPScgKyBzZWxmLmdldFZhbHVlKHVbIGogXSwgc2VsZi5jb25maWcuZGF0YSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRzZWxmLmNyZWF0ZUVsZW0oJ2ltZycsIHNyYywgdGFnLmlkKTtcbn07XG5WZW5kb3JTZXJ2aWNlLnByb3RvdHlwZS50aWt0b2sgPSBmdW5jdGlvbiAodGFnLCBpbmRleCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIGlmIChpc1BpeGVsSWRWYWxpZCh0YWcpKSB7XG4gICAgICAgIHZhciBodG1sID0gc2VsZi5nZW5lcmF0ZVRpa3Rva0h0bWxTY3JpcHRUYWcodGFnKTtcbiAgICAgICAgc2VsZi5jcmVhdGVJZnJhbWVXaXRoQ29udGVudCh0YWcuaWQsIGh0bWwsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYubG9nKCdJZnJhbWUgYWRkZWQgZm9yIHBpeGVsOiAnICsgdGFnLmlkKTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgc2VsZi5sb2coJ0ludmFsaWQgVGlrVG9rIElEOiAnICsgdGFnLnBpeGVsSWQpO1xuICAgIH1cbn07XG5cbnZhciBpc1BpeGVsSWRWYWxpZCA9ICBmdW5jdGlvbih0YWcpIHtcbiAgICByZXR1cm4gISF0YWcucGl4ZWxJZDtcbn1cblxuVmVuZG9yU2VydmljZS5wcm90b3R5cGUudHdpdHRlclVuaXZlcnNhbCA9IGZ1bmN0aW9uICh0YWcsIGluZGV4KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIFxuICAgICFmdW5jdGlvbiAoZSwgdCwgbiwgcywgdSwgYSkge1xuICAgICAgICBlLnR3cSB8fCAocyA9IGUudHdxID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcy5leGUgPyBzLmV4ZS5hcHBseShzLCBhcmd1bWVudHMpIDogcy5xdWV1ZS5wdXNoKGFyZ3VtZW50cyk7XG4gICAgICAgIH0sIHMudmVyc2lvbiA9ICcxLjEnLCBzLnF1ZXVlID0gW10sIHUgPSB0LmNyZWF0ZUVsZW1lbnQobiksIHUuYXN5bmMgPSAhMCwgdS5zcmMgPSAnLy9zdGF0aWMuYWRzLXR3aXR0ZXIuY29tL3V3dC5qcycsXG4gICAgICAgICAgICBhID0gdC5nZXRFbGVtZW50c0J5VGFnTmFtZShuKVswXSwgYS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh1LCBhKSlcbiAgICB9KHdpbmRvdywgZG9jdW1lbnQsICdzY3JpcHQnKTtcblxuXG4gICAgdHdxKCdpbml0JywgdGFnLnBpZCk7XG5cbiAgICBpZiAoIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnKSApIHtcbiAgICAgICAgdHdxKCd0cmFjaycsICdQdXJjaGFzZScsXG4gICAgICAgICAgICAvL05vdGUsIGFsbCB2YWx1ZXMgc2VudCBhcyBzdHJpbmdzIGluIHNpbmdsZSBxdW90ZXMpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6ICAgICAgICBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5iYXNlUHJpY2UnKS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGN1cnJlbmN5OiAgICAgc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udG90YWwuY3VycmVuY3knKSxcbiAgICAgICAgICAgICAgICBvcmRlcl9pZDogICAgIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnKSxcbiAgICAgICAgICAgICAgICBjb250ZW50X3R5cGU6ICd0aWNrZXRzJyxcbiAgICAgICAgICAgICAgICBjb250ZW50X2lkczogIFtzZWxmLmdldFZhbHVlKCdwYWdlLmF0dHJpYnV0ZXMuZXZlbnRJRCcpXSxcbiAgICAgICAgICAgICAgICBjb250ZW50X25hbWU6IHNlbGYuZ2V0VmFsdWUoJ3BhZ2UuYXR0cmlidXRlcy5ldmVudE5hbWUnKS5yZXBsYWNlKC9cXHgyNy9nLCAnXFxcXFxceDI3JyksXG4gICAgICAgICAgICAgICAgbnVtX2l0ZW1zOiAgICBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi5hdHRyaWJ1dGVzLnRpY2tldFF1YW50aXR5JykudG9TdHJpbmcoKVxuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHR3cSgndHJhY2snLCAnUGFnZVZpZXcnKTtcbiAgICB9XG59O1xuVmVuZG9yU2VydmljZS5wcm90b3R5cGUudHdpdHRlciA9IGZ1bmN0aW9uICh0YWcsIGluZGV4KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuLy8qKioqKiogVHdpdHRlciAqKioqKiovL1xuICAgIChmdW5jdGlvbiAodywgZCwgdCwgdSwgZiwgYykge1xuICAgICAgICBpZihmKXtcbiAgICAgICAgICAgIGMoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgeCA9IGZhbHNlLFxuICAgICAgICBwLCBzID0gZC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgICAgcy50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgICAgIHMuc3JjID0gdTtcbiAgICAgICAgcy5hc3luYyA9IDE7XG4gICAgICAgIHMub25sb2FkID0gcy5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIXggJiYgKCF0aGlzLnJlYWR5U3RhdGUgfHwgdGhpcy5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKSkge1xuICAgICAgICAgICAgICAgIHggPSB0cnVlO1xuICAgICAgICAgICAgICAgIHNlbGYudHdpdHRlckxvYWRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBwID0gZC5nZXRFbGVtZW50c0J5VGFnTmFtZSh0KVswXTtcbiAgICAgICAgcC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzLCBwKTtcbiAgICB9KSh3aW5kb3csIGRvY3VtZW50LCAnc2NyaXB0JywgJy8vcGxhdGZvcm0udHdpdHRlci5jb20vb2N0LmpzJywgc2VsZi50d2l0dGVyTG9hZGVkLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjb252ZXJzaW9uID0ge307XG4gICAgICAgIGlmIChzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50cmFuc2FjdGlvbklEJykpIHtcbiAgICAgICAgICAgIGNvbnZlcnNpb24udHdfc2FsZV9hbW91bnQgPSBzZWxmLmdldFZhbHVlKCd0cmFuc2FjdGlvbi50b3RhbC5iYXNlUHJpY2UnKTtcbiAgICAgICAgICAgIGNvbnZlcnNpb24udHdfb3JkZXJfcXVhbnRpdHkgPVxuICAgICAgICAgICAgICAgIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLmF0dHJpYnV0ZXMudGlja2V0UXVhbnRpdHknKTtcbiAgICAgICAgfVxuICAgICAgICB3aW5kb3cudHd0dHIuY29udmVyc2lvbi50cmFja1BpZCh0YWcucGlkLCBjb252ZXJzaW9uKTtcblxuICAgIH0pO1xuXG4vLyoqKioqKiBFbmQgVHdpdHRlciAqKioqKiovL1xufTtcblZlbmRvclNlcnZpY2UucHJvdG90eXBlLnZlcml6b25NZWRpYU9hdXRoID0gZnVuY3Rpb24gKHRhZywgaW5kZXgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAvL2xvYWQgdGhlIGxpYnJhcnkgaW4gdGhlIGlGcmFtZVxuICAgIHZhciBodG1sID0gJzxzY3JpcHQ+JztcbiAgICBodG1sICs9ICcoZnVuY3Rpb24odyxkLHQscix1KXt3W3VdPXdbdV18fFtdO3dbdV0ucHVzaChcXG4nICtcbiAgICAgICAgJ3twcm9qZWN0SWQ6XCInICsgdGFnLnByb2plY3RJZCArICdcIixwcm9wZXJ0aWVzOntwaXhlbElkOlwiJyArIHRhZy5waXhlbElkICsgJ1wifX0pO1xcbicgK1xuICAgICAgICAndmFyIHM9ZC5jcmVhdGVFbGVtZW50KHQpO3Muc3JjPXI7cy5hc3luYz10cnVlO3Mub25sb2FkPVxcbicgK1xuICAgICAgICAncy5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oKXt2YXIgeSxycz10aGlzLnJlYWR5U3RhdGUsYz13W3VdO1xcbicgK1xuICAgICAgICAnaWYocnMmJnJzIT1cImNvbXBsZXRlXCImJnJzIT1cImxvYWRlZFwiKXtyZXR1cm59dHJ5e3k9WUFIT08ueXdhLkkxM04uZmlyZUJlYWNvbjtcXG4nICtcbiAgICAgICAgJ3dbdV09W107d1t1XS5wdXNoPWZ1bmN0aW9uKHApe3koW3BdKX07eShjKX1jYXRjaChlKXt9fTtcXG4nICtcbiAgICAgICAgJ3ZhciBzY3I9ZC5nZXRFbGVtZW50c0J5VGFnTmFtZSh0KVswXSxwYXI9c2NyLnBhcmVudE5vZGU7cGFyLmluc2VydEJlZm9yZShzLHNjcil9KSh3aW5kb3csZG9jdW1lbnQsXCJzY3JpcHRcIixcImh0dHBzOi8vcy55aW1nLmNvbS93aS95dGMuanNcIixcImRvdHFcIik7ICc7XG5cbiAgICBpZiAoIHNlbGYuZ2V0VmFsdWUoJ3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uSUQnLCBzZWxmLmNvbmZpZy5kYXRhKSApIHtcbiAgICAgICAgaHRtbCArPSAnd2luZG93LmRvdHEgPSB3aW5kb3cuZG90cSB8fCBbXTt3aW5kb3cuZG90cS5wdXNoKHsgXFwnZ3ZcXCc6ICcgKyBzZWxmLnRvRmxvYXQoc2VsZi5nZXRWYWx1ZSgndHJhbnNhY3Rpb24udG90YWwuYmFzZVByaWNlJykgLCAwKSArICcgfSk7JztcbiAgICB9XG5cbiAgICBodG1sKz0gJzwvc2NyaXB0Pic7XG5cbiAgICBzZWxmLmNyZWF0ZUlmcmFtZVdpdGhDb250ZW50KHRhZy5pZCwgaHRtbCwgZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLmxvZygnSWZyYW1lIGFkZGVkIGZvciBwaXhlbDogJyArIHRhZy5pZCk7XG4gICAgfSk7XG59XG5cbiJdfQ=="}